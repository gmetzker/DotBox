var Observer=function(){function a(a,b){return b.priority-a.priority}function b(a){return void 0===a?!0:null===a}var d;d=function f(){if(!(this instanceof f))return new f;this._channelSubscribers={}};d.prototype.subscribe=function(f,g,c){var e=this._channelSubscribers[f];b(e)&&(e=[]);if(b(c)){c=e;var m,h,d=0;if(!b(c))for(h=c.length,m=0;m<h;m++)0>c[m].priority&&c[m].priority<d&&(d=c[m].priority);c=d-1}e.push({priority:c,callback:g});e=e.sort(a);this._channelSubscribers[f]=e};d.prototype.unsubscribe=
function(a,g){var c,e=this._channelSubscribers[a];if(!b(e)){for(c=0;c<e.length;c++)if(e[c].callback===g){e.splice(c,1);break}0===e.length&&delete this._channelSubscribers[a]}};d.prototype.publish=function(a,g,c,e){var m,h,d,l=null;if(0===arguments.length||b(a))throw Error("channelId argument required.");1<arguments.length&&(l=Array.prototype.slice.call(arguments,1));d=this._channelSubscribers[a];h={channelId:a,cancel:!1};if(b(d))return!0;for(m=0;m<d.length;m++)if(d[m].callback.apply(h,l),h.cancel)return!1;
return!0};return d}();var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};
(function(a){function b(a){return void 0===a?!0:null===a}a.isNullOrUndefined=b;a.areSameDot=function(a,k){return b(a)&&b(k)?!0:b(a)!==b(k)?!1:a.x===k.x&&a.y===k.y};a.getRandom=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};a.getRandomItem=function(b){var k;k=a.getRandom(0,b.length-1);return b[k]};a.inherit=function(){var a=function(){};return function(b,f){a.prototype=f.prototype;b.prototype=new a;b.uber=f.prototype;b.prototype.constructor=b}}();a.isCanvasSupported=function(){var a=document.createElement("canvas");
return!(!a.getContext||!a.getContext("2d"))}})(dotBox.utility);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.line=dotBox.utility.line||{};
(function(a){function b(a){return 0<Math.abs(a.d1.x-a.d2.x)}a.isHLine=b;a.getBoxesFromLine=function(a,k,f){var g=k-1,c=[],e,m;b(a)?(e=a.d1.y,m=Math.min(a.d1.x,a.d2.x),0!==a.d1.y&&(a.d1.y!==f-1&&c.push(e*g+m),e-=1)):(m=a.d1.x,e=Math.min(a.d1.y,a.d2.y),0!==a.d1.x&&(a.d1.x!==k-1&&c.push(e*g+m),m-=1));c.push(e*g+m);return c};a.getLinesFromBox=function(a,b){var f=b-1,g=[],c;c=a%f;f=(a-c)/f;g.push({d1:{x:c,y:f},d2:{x:c+1,y:f}});g.push({d1:{x:c+1,y:f},d2:{x:c+1,y:f+1}});g.push({d1:{x:c,y:f+1},d2:{x:c+1,
y:f+1}});g.push({d1:{x:c,y:f},d2:{x:c,y:f+1}});return g}})(dotBox.utility.line);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.iterators=dotBox.utility.iterators||{};
(function(a){a.hLineIterator=function(a,d){function k(){return c?!1:{d1:{x:f,y:g},d2:{x:f+1,y:g}}}var f=-1,g=0,c=!1;return{next:function(){if(c)return null;if(g===d-1&&f===a-2)return c=!0,null;f===a-2?(g+=1,f=0):f+=1;return k()},current:k}};a.vLineIterator=function(a,d){function k(){return c?!1:{d1:{x:f,y:g},d2:{x:f,y:g+1}}}var f=-1,g=0,c=!1;return{next:function(){if(c)return null;if(g===d-2&&f===a-1)return c=!0,null;f===a-1?(g+=1,f=0):f+=1;return k()},current:k}}})(dotBox.utility.iterators);dotBox=dotBox||{};
dotBox.boxState=function(a,b){function d(){return c.length}function k(a){var b=d();if(0>a)throw new RangeError("boxIndex must be greater or equal to 0.");if(a>=b)throw new RangeError("boxIndex must be less than the box count ("+b+").");}function f(a){k(a);return null!==c[a]}function g(a){k(a);return c[a]}var c;(function(a,b){var h,g=(a-1)*(b-1);c=[];for(h=0;h<g;h++)c[h]=null})(a,b);return{getBoxCount:d,areAllBoxesScored:function(){return c.every(function(a){return null!==a})},isBoxScored:f,isBoxNotScored:function(a){return!f(a)},
whichPlayerScoredBox:g,scoreBox:function(a,b){k(a);c[a]=b},getCurrentScores:function(a){var b,h=[],c;for(b=0;b<a;b++)h[b]=0;a=d();for(b=0;b<a;b++)f(b)&&(c=g(b),h[c]+=1);return h},getPlayerBoxes:function(a){var b,h,c=[],f;h=d();for(b=0;b<h;b++)f=g(b),f===a&&c.push(b);return c}}};dotBox=dotBox||{};
dotBox.lineState=function(a,b){function d(b,h){var e,l;if(f.isNullOrUndefined(b))throw Error("line is null or undefined");k(b.d1,"line.d1");k(b.d2,"line.d2");l=Math.abs(b.d1.x-b.d2.x);e=Math.abs(b.d1.y-b.d2.y);if(1<l)throw new RangeError("Move appears to be too long on x-axis.  Line must only connect adjacent points.");if(1<e)throw new RangeError("Move appears to be too long on y-axis.  Line must only connect adjacent points.");if(1<l+e)throw new RangeError("Movement appears to be diagonal this is not allowed.");var p;
f.line.isHLine(b)?(l=g,e=b.d1.y,p=Math.min(b.d1.x,b.d2.x),e=e*(a-1)+p):(l=c,e=Math.min(b.d1.y,b.d2.y),p=b.d1.x,e=e*a+p);f.isNullOrUndefined(h)||h&&(l[e]=!0);return l[e]}function k(c,h){if(f.isNullOrUndefined(c))throw Error(h+" is null or undefined.");if(0>c.x)throw new RangeError(h+".x must be > 0.");if(c.x>=a)throw new RangeError(h+".x must be < "+a);if(0>c.y)throw new RangeError(h+".y must be > 0.");if(c.y>=b)throw new RangeError(h+".y must be < "+b);}var f=dotBox.utility,g=[],c=[],e;e={connected:d,
isBoxClosed:function(b){var h;h=f.line.getLinesFromBox(b,a);for(b=0;4>b;b++)if(!d(h[b]))return!1;return!0},getAllLinesForDot:function(c){var h=[],g,e;g=function(){return{x:c.x,y:c.y}};e=function(a,b){h.push({d1:g(),d2:{x:a,y:b}})};0<c.y&&e(c.x,c.y-1);c.x<a-1&&e(c.x+1,c.y);c.y<b-1&&e(c.x,c.y+1);0<c.x&&e(c.x-1,c.y);return h},getOpenLinesForDot:function(a){return e.getAllLinesForDot(a).filter(function(a){return!e.connected(a)})},getTotalLineCount:function(){return c.length+g.length},getLineStatesForBox:function(b){var c=
[],g=[],f,d;b=dotBox.utility.line.getLinesFromBox(b,a);for(f=0;4>f;f++)d=b[f],e.connected(d)?g.push(d):c.push(d);return{open:c,closed:g}}};(function(a,b){var e,f,d;f=(a-1)*b;d=(b-1)*a;for(e=0;e<f;e++)g[e]=!1;for(e=0;e<d;e++)c[e]=!1})(a,b);return e};dotBox=dotBox||{};
dotBox.gameEngine=function(a){function b(){return d()?null:h}function d(){return l.areAllBoxesScored()}var k=dotBox.utility,f,g,c,e,m,h,n,l=null;(function(a){a||(a={});g=k.isNullOrUndefined(a.dotCountLength)?10:parseInt(a.dotCountLength,10);c=k.isNullOrUndefined(a.dotCountWidth)?10:parseInt(a.dotCountWidth,10);f=k.isNullOrUndefined(a.playerCount)?2:parseInt(a.playerCount,10);h=k.isNullOrUndefined(a.startPlayer)?0:parseInt(a.startPlayer,10);if(isNaN(g))throw new TypeError("dotCountLength is not a number.");if(isNaN(c))throw new TypeError("dotCountWidth is not a number.");
if(isNaN(f))throw new TypeError("playerCount is not a number.");if(isNaN(h))throw new TypeError("startPlayer is not a number.");if(3>g)throw new RangeError("dotCountLength must be three or more");if(3>c)throw new RangeError("dotCountWidth must be three or more");if(2>f)throw new RangeError("playerCount must two or more");if(0>h||h>=f)throw new RangeError("startPlayer must be between 0 and playerCount-1");e=g-1;m=c-1;l=k.isNullOrUndefined(a.boxState)?dotBox.boxState(g,c):a.boxState;n=k.isNullOrUndefined(a.lineState)?
dotBox.lineState(g,c):a.lineState})(a);return{getDotCountLength:function(){return g},getBoxCountLength:function(){return e},getDotCountWidth:function(){return c},getBoxCountWidth:function(){return m},getBoxCount:function(){return e*m},getPlayerCount:function(){return f},getCurrentPlayer:b,getCurrentScores:function(){return l.getCurrentScores(f)},isLineConnected:function(a){return n.connected(a)},connectLine:function(a){var e={},m;if(d())throw Error("Cannot make a move when the game is over.");if(n.connected(a))throw Error("This line is already connected.");
m=b();n.connected(a,!0);a=k.line.getBoxesFromLine(a,g,c).filter(n.isBoxClosed).filter(l.isBoxNotScored);a.forEach(function(a){l.scoreBox(a,m)});e.boxesScored=a;e.gameOver=d();0===e.boxesScored.length?(a=d()?null:h=h===f-1?0:h+1,e.nextPlayer=a):e.nextPlayer=b();return e},isGameOver:d,hasAnyOpenLines:function(a){if(void 0===a)throw Error("dot argument was not supplied.");if(null===a)throw Error("dot argument was null.");return 0<n.getOpenLinesForDot(a).length},canConnectDots:function(a,b){var c,h,e;
if(k.isNullOrUndefined(a))throw Error("dot1 argument was null or undefined.");if(k.isNullOrUndefined(b))throw Error("dot2 argument was null or undefined.");h=n.getOpenLinesForDot(a);for(c=0;c<h.length;c++)if(e=h[c].d2,k.areSameDot(e,b))return!0;return!1},getPlayerBoxes:function(){return l.getPlayerBoxes.apply(l,arguments)},getOpenLinesForDot:function(){return n.getOpenLinesForDot.apply(n,arguments)},getTotalLineCount:function(){return n.getTotalLineCount.apply(n,arguments)},isBoxScored:function(){return l.isBoxScored.apply(l,
arguments)},getLineStatesForBox:function(){return n.getLineStatesForBox.apply(n,arguments)}}};dotBox=dotBox||{};
dotBox.model=function(a,b){var d=dotBox.utility,k;return k={selectedDot:null,hoveredDot:null,isSelectedDot:function(a){return null!==k.selectedDot&&d.areSameDot(a,k.selectedDot)},isHoveredDot:function(a){return null!==k.hoveredDot&&d.areSameDot(a,k.hoveredDot)},getDotColCount:function(){return a.getDotCountLength()},canConnectDots:function(b){return null!==k.selectedDot&&a.canConnectDots(k.selectedDot,b)},getDotRowCount:function(){return a.getDotCountWidth()},hasAnyOpenLines:function(b){return a.hasAnyOpenLines(b)},getCurrentScores:function(){return a.getCurrentScores()},
getCurrentPlayer:function(){return a.getCurrentPlayer()},getPlayerBoxes:function(){return a.getPlayerBoxes.apply(a,arguments)},gameConfig:b,isQuickStarting:!1,isTouchSupported:function(){return createjs.Touch.isSupported()}}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};dotBox.views.constants={P1_COLOR:"#A4E402",P2_COLOR:"#BF7AFF",PX_COLOR:"#5B5B5B",SCORE_TXT_COLOR:"#E7F8F2",BOARD_BACK_COLOR:"#272822",FONT:"'Open Sans', Helvetica, Arial, sans-serif"};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.viewContext=function(a,b,d){var k,f;function g(a){for(var c in a)a.hasOwnProperty(c)&&(a[c]=a[c]*b*d);return a}var c=dotBox.utility,e,m;if(c.isNullOrUndefined(a))throw Error("observer parameter is required.");if(c.isNullOrUndefined(b))throw Error("pixelRatio is required.");f=k=0;m=g({DOT_RADIUS:5,DOT_MARGIN:20,POINT_FONT_SIZE:13,SCORE_BOARD_HEIGHT:65});a.subscribe("view.reserveCanvasSize",function(a){c.isNullOrUndefined(a)||(c.isNullOrUndefined(a.height)||(k+=a.height),c.isNullOrUndefined(a.width)||
(f+=a.width))});return e={observer:a,pixelRatio:b,stage:null,boxShapes:{},pixelSizes:m,initCanvasStage:function(a){var c;c=0;for(var g=null,d,m;null===g;)d="dotBoxCanvas_"+c,m=$("#"+d),0===m.length&&(g=d),c+=1;c=g;a.append('<canvas id="'+c+'" width='+f+" height="+k+' style="width: '+1/b*f+"px; height: "+1/b*k+'px;"></canvas>');e.stage=new createjs.Stage(c)},scalePixel:function(a){return a*b*d},scaleAllPixelProps:g,setDrawColors:function(a){var b=a.fillColor;a=a.strokeColor;dotBox.utility.isNullOrUndefined(b)||
(this.fillStyle=b.toString());dotBox.utility.isNullOrUndefined(a)||(this.strokeStyle=a.toString())},width:function(){if(null===e.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return e.stage.canvas.width},height:function(){if(null===e.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return e.stage.canvas.height},getPlayerColor:function(a){switch(a){case 0:return dotBox.views.constants.P1_COLOR;case 1:return dotBox.views.constants.P2_COLOR;
default:return dotBox.views.constants.PX_COLOR}}}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.Color=function(){function a(a){var b,e,d;b=parseInt(a.slice(1,3),16);e=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);d=new f;d.red=b;d.green=e;d.blue=a;return d}function b(a){var b,e,d,h;a=a.trim();a=a.toLowerCase();a=a.slice(5,a.length-1);a=a.trim();d=a.split(",");if(4!==d.length)throw Error("Could not parse rgba() color string.");a=parseInt(d[0].trim(),10);b=parseInt(d[1].trim(),10);e=parseInt(d[2].trim(),10);d=parseFloat(d[3].trim());h=new f;h.red=a;h.green=b;h.blue=e;h.alpha=
d;return h}function d(a){var b,e,d;a=a.trim();a=a.toLowerCase();a=a.slice(4,a.length-1);a=a.trim();e=a.split(",");if(3!==e.length)throw Error("Could not parse rgb() color string.");a=parseInt(e[0].trim(),10);b=parseInt(e[1].trim(),10);e=parseInt(e[2].trim(),10);d=new f;d.red=a;d.green=b;d.blue=e;return d}function k(f){f=f.trim();if(0===f.lastIndexOf("#",0)&&7===f.length)return a(f);if(0===f.lastIndexOf("rgba(",0))return b(f);if(0===f.lastIndexOf("rgb(",0))return d(f);throw Error("Invalid arguments.");
}var f;f=function c(a){var b;if(!(this instanceof c))return c.apply(new c,arguments);this.green=this.blue=this.red=255;this.alpha=1;if(1===arguments.length)return b=a.toString(),k(b);if(4===arguments.length){var h=arguments,d,l,p;b=Math.round(parseFloat(h[0]));d=Math.round(parseFloat(h[1]));l=Math.round(parseFloat(h[2]));p=parseFloat(h[3]);h=new f;h.red=b;h.green=d;h.blue=l;h.alpha=p;return h}if(3===arguments.length)return l=arguments,b=Math.round(parseFloat(l[0])),d=Math.round(parseFloat(l[1])),
h=Math.round(parseFloat(l[2])),l=new f,l.red=b,l.green=d,l.blue=h,l;if(0!==arguments.length)throw Error(arguments.length+" number of arguments not supported.");};f.parseHexColorString=a;f.parseColorString=k;f.parseRgbaColorString=b;f.parseRgbColorString=d;f.prototype.toString=function(){var a,b,f;a=Math.round(this.red);b=Math.round(this.green);f=Math.round(this.blue);return"rgba("+[a,b,f,this.alpha].join()+")"};f.prototype.clone=function(){var a=new f;a.red=this.red;a.green=this.green;a.blue=this.blue;
a.alpha=this.alpha;return a};return f}();dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.board=function(a,b){function d(){var a=r(2.5*u.DOT_RADIUS);a&&!B&&c(a)}function k(b){s.isNullOrUndefined(b)||a.observer.publish("dotRollOver",b)}function f(b){s.isNullOrUndefined(b)||a.observer.publish("dotRollOut",b)}function g(){B||c(this.dot)}function c(b){a.observer.publish("dotClick",b)}function e(){var a=G,c=r(2.5*u.DOT_RADIUS);s.areSameDot(a,c)||(B||(!s.isNullOrUndefined(c)&&b.hasAnyOpenLines(c)?m("pointer"):m("")),G=c,B||(f(a),k(c)))}function m(b){a.stage.canvas.style.cursor=
b}function h(){a.stage.update()}function n(c){var e,f;c instanceof createjs.Shape?(e=c,c=e.dot,f=!0):(e=l(c),f=!1);c=b.isSelectedDot(c)?C:b.isHoveredDot(c)&&b.canConnectDots(c)?D:b.isHoveredDot(c)?J:K;c=new H(c);f?(e.fillColor=c,e.graphics.beginFill(c).inject(a.setDrawColors,e).drawCircle(0,0,u.DOT_RADIUS).endFill()):createjs.Tween.get(e.fillColor,{override:!0}).to(c,250);return e}function l(a){return E[a.y][a.x]}function p(c,e,f){var d,h=l(c.d1),g=l(c.d2),k=!1,m=a.scalePixel(1),n=null,p;d=y(c);s.isNullOrUndefined(d)?
(d=new createjs.Shape,x(c,d),k=!0):d.graphics.clear();d.graphics.setStrokeStyle(m).beginStroke(e).moveTo(h.x,h.y).lineTo(g.x,g.y);p=b.isQuickStarting;k&&(z.isHLine(c)?(d.scaleX=0.1,d.x=h.x-0.1*h.x,n={scaleX:1,x:0}):(d.scaleY=0.1,d.y=h.y-0.1*h.y,n={scaleY:1,y:0}),d.on("click",w),a.stage.addChild(d),createjs.Tween.get(d,{override:!0}).to(n,300).call(function(){var b;p||f||(b=new createjs.Shape,b.graphics.setStrokeStyle(a.scalePixel(1)).beginStroke(I).drawCircle(0,0,a.pixelSizes.DOT_RADIUS),b.x=g.x,
b.y=g.y,b.scaleX=0,b.scaleY=0,a.stage.addChild(b),createjs.Tween.get(b).to({scaleX:1.5,scaleY:1.5},150).to({scaleX:5,scaleY:5,alpha:0},1E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(b)}))}))}function w(b){b=a.stage.getObjectsUnderPoint(b.stageX,b.stageY).filter(function(a){return!s.isNullOrUndefined(a.dot)});0<b.length&&g.apply(b[0])}function v(c,e){var d,f,h,g;b.isQuickStarting||(f=l(c.lines[0].d1),g=l(c.lines[0].d2),d=f.x+(g.x-f.x)/2,f=l(c.lines[1].d1),g=l(c.lines[1].d2),f=f.y+(g.y-
f.y)/2,h=new createjs.Text("+"+e,u.POINT_FONT_SIZE+"px "+F.FONT,F.SCORE_TXT_COLOR),h.x=d,h.y=f,h.textAlign="center",h.textBaseline="middle",h.alpha=0,a.stage.addChild(h),createjs.Tween.get(h,{override:!1}).wait(550).to({alpha:1},0).to({alpha:0,y:a.height()+a.scalePixel(50)},3E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(h)}),createjs.Tween.get(h,{override:!1}).wait(550).to({scaleX:1.5,scaleY:1.5},200,createjs.Ease.elasticInOut))}function x(a,b){var c,e;c=q(a);e=c.store[c.y];s.isNullOrUndefined(e)&&
(e={},c.store[c.y]=e);e[c.x]=b}function y(a){var b;a=q(a);if(!a.store.hasOwnProperty(a.y))return null;b=a.store[a.y];return b.hasOwnProperty(a.x)?b[a.x]:null}function q(a){var b,c;s.line.isHLine(a)?(c=L,b=a.d1.y,a=Math.min(a.d1.x,a.d2.x)):(c=M,b=Math.min(a.d1.y,a.d2.y),a=a.d1.x);return{x:a,y:b,store:c}}function t(a,b){var c;c=Math.floor((a-u.DOT_MARGIN/2)/(2*u.DOT_RADIUS+u.DOT_MARGIN));return 0>c||c>=b?null:c}function r(c){var e,f,d,h;e=a.stage.mouseX;f=a.stage.mouseY;if(!a.stage.mouseInBounds)return null;
d=t(e,b.getDotColCount());if(null===d)return null;h=t(f,b.getDotRowCount());if(null===h)return null;d={x:d,y:h};h=l(d);var g=h.y;e=Math.pow(h.x-e,2)+Math.pow(g-f,2);c=Math.pow(c,2);e<=c||(d=null);return d}var s=dotBox.utility,z=dotBox.utility.line,F=dotBox.views.constants,H=dotBox.views.Color;if(s.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(s.isNullOrUndefined(b))throw Error("model is null or undefined.");var u=a.pixelSizes,K="#53d2f1",J="#89E0F5",C="#fc1f70",D="#E20355",
I="white",E,L={},M={},A,G=null,B=!1;(function(){var c,e,d;c={height:0,width:0};e=2*b.getDotColCount()*u.DOT_RADIUS;d=(b.getDotColCount()+1)*u.DOT_MARGIN;c.width=e+d;e=2*b.getDotRowCount()*u.DOT_RADIUS;d=(b.getDotRowCount()+1)*u.DOT_MARGIN;c.height=e+d;a.observer.publish("view.reserveCanvasSize",c)})();a.observer.subscribe("startGame",function(){var c,f,l,k=b.getDotRowCount(),m=b.getDotColCount(),s;c=new createjs.Shape;c.graphics.beginFill(F.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height());c.on("click",
d);a.stage.addChild(c);E=[];for(f=0;f<k;f++)for(c=0;c<m;c++)0===c&&(s=[],E.push(s)),l=new createjs.Shape,l.dot={x:c,y:f},n(l),l.x=c*(u.DOT_MARGIN+2*u.DOT_RADIUS)+(u.DOT_MARGIN+u.DOT_RADIUS),l.y=f*(u.DOT_MARGIN+2*u.DOT_RADIUS)+(u.DOT_MARGIN+u.DOT_RADIUS),l.on("click",g),s.push(l),a.stage.addChild(l);a.stage.update();if(!b.isTouchSupported())a:{k=20;A&&(clearInterval(A),A=null);if(null===k)k=20;else if(0>=k)break a;A=setInterval(e,1E3/Math.min(50,k))}createjs.Ticker.addEventListener("tick",h);createjs.Ticker.setFPS(60);
createjs.Touch.enable(a.stage,!0)});a.observer.subscribe("view.dotRollOver",function(a){a=n(a);createjs.Tween.get(a,{override:!0}).to({scaleX:2,scaleY:2},150)});a.observer.subscribe("view.dotRollOut",function(a){a=n(a);createjs.Tween.get(a,{override:!0}).to({scaleX:1,scaleY:1},150)});a.observer.subscribe("view.dotSelectionChanged",function(a,b){var c;null!==a&&n(a);null!==b&&n(b);a!==b&&(c=l(null!==b?b:a),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150).call(function(){var a=r(u.DOT_RADIUS);
s.isNullOrUndefined(a)&&m("")}))});a.observer.subscribe("view.lineConnected",function(a,b){var c;n(a.d1);c=n(a.d2);createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150);p(a,I,b)});a.observer.subscribe("view.boxesScored",function(b,c){var e;for(e=0;e<b.length;e++){var f=b[e],d=c,h=void 0,g=void 0,k=h=void 0,m=void 0,n=void 0,s=void 0,k=void 0,p=a.scalePixel(10),z=a.scalePixel(1),s=a.getPlayerColor(d),n=new H(s);n.alpha=0.33;n=n.toString();g=l(f.lines[0].d1);h=l(f.lines[1].d2);k=h.x-g.x;m=
h.y-g.y;h=new createjs.Shape;h.graphics.setStrokeStyle(z).beginStroke(s).beginFill(n).drawRect(g.x,g.y,k,m);k=(k+p)/k;h.scaleX=k;h.scaleY=k;h.x=-1*(g.x*k-g.x)-p/2;h.y=-1*(g.y*k-g.y)-p/2;h.upperLeft={x:g.x,y:g.y};h.alpha=0;h.on("click",w);a.stage.addChild(h);a.boxShapes[f.box]=h;createjs.Tween.get(h,{override:!0}).wait(350).to({alpha:1},0).to({x:0,y:0,scaleX:1,scaleY:1},350)}v(b[0],b.length)});a.observer.subscribe("startRemoteTurn",function(a){m("wait");B=!0});a.observer.subscribe("endRemoteTurn",
function(a,b){var e=s.getRandom(700,1250),h=s.getRandom(170,750),d=s.getRandom(500,750),g=s.getRandom(Math.floor(75),750);setTimeout(function(){k(b.d1);setTimeout(function(){c(b.d1);f(b.d1);setTimeout(function(){k(b.d2);setTimeout(function(){B=!1;m(null);c(b.d2);f(b.d2)},g)},d)},h)},e)});a.observer.subscribe("stopGame",function(){createjs.Ticker.removeEventListener("tick",h);createjs.Touch.disable(a.stage);A&&(clearInterval(A),A=null)});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.score=function(a,b){function d(b,f){var d=new createjs.Container,g,k=a.scalePixel(1),v=a.scalePixel(2),r=a.scalePixel(9),C=a.scalePixel(6),D=a.scalePixel(13);g=new createjs.Shape;g.graphics.setStrokeStyle(k).beginStroke(w).beginFill(p).drawRoundRect(0,0,t.SCORE_BOX_W,f,v);d.addChild(g);g=new createjs.Text("0",t.SCORE_FONT_SIZE+"px "+c.FONT,c.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=C+f/2;g.textAlign="center";g.textBaseline="middle";d.addChild(g);m.push(g);g=new createjs.Shape;g.graphics.setStrokeStyle(k).beginFill(x).beginStroke(y).arc(t.SCORE_BOX_W/
2,f+D,t.SCORE_BOX_W/4,Math.PI+0.25*Math.PI,1.75*Math.PI);g.alpha=0;h.push(g);d.addChild(g);k=g=new createjs.Shape;v=Math.round(0.3*f);C=a.scalePixel(2);D=a.scalePixel(2);k.fillColor=new e(q);k.strokeColor=new e(q);k.graphics.setStrokeStyle(C).beginStroke(q).beginFill(q).inject(a.setDrawColors,k).drawRoundRect(0,0,t.SCORE_BOX_W,v,D).endFill();d.addChild(g);n.push(g);g=new createjs.Text(b,t.P_NAME_FONT_SIZE+"px "+c.FONT,c.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=r;g.textAlign="center";g.textBaseline=
"middle";l.push(g);d.addChild(g);return d}function k(a){var b,e,d,g,k;for(b=0;b<h.length;b++)e=h[b],b===a?(createjs.Tween.get(e,{override:!0}).to({alpha:1},250,createjs.Ease.sineIn),e=c.SCORE_TXT_COLOR):(createjs.Tween.get(e,{override:!0}).to({alpha:0},250,createjs.Ease.sineOut),e=v),k=n[b],d=f("fill",b,a),g=f("stroke",b,a),createjs.Tween.get(k.fillColor,{override:!0}).to(d,200),createjs.Tween.get(k.strokeColor,{override:!0}).to(g,200),l[b].color=e}function f(a,b,d){b===d?(b=0===b?new e(c.P1_COLOR):
new e(c.P2_COLOR),"fill"===a&&(b.alpha=0.33)):b=new e(q);return b}var g=dotBox.utility,c=dotBox.views.constants,e=dotBox.views.Color,m=[],h=[],n=[],l=[],p="#272822",w="#3b3d38",v="#a69b9d",x="#fc1f70",y="#E20355",q="#40403d",t=a.scaleAllPixelProps({SCORE_BOX_W:75,SCORE_FONT_SIZE:25,P_NAME_FONT_SIZE:10}),r=a.pixelSizes.SCORE_BOARD_HEIGHT;if(g.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(g.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.publish("view.reserveCanvasSize",
{height:r});a.observer.subscribe("startGame",function(){var c,e,f=a.scalePixel(10);e=a.scalePixel(5);var g=r-2*e;c=a.height()-r;e=c+e+1;m=[];h=[];n=[];l=[];var p,v=a.scalePixel(1),w=a.height(),q=a.width();p=new createjs.Shape;p.graphics.beginLinearGradientFill(["#5b5b5b","#545454"],[0,1],0,c,0,w).drawRect(0,c,q,w).endFill();p.graphics.setStrokeStyle(v).beginStroke("#323232").moveTo(0,c).lineTo(q,c).endStroke();p.graphics.setStrokeStyle(v).beginStroke("#7d7d7d").moveTo(0,c+v).lineTo(q,c+v).endStroke();
a.stage.addChild(p);c=d(b.gameConfig.playerNames[0],g);c.x=f;c.y=e;a.stage.addChild(c);c=d(b.gameConfig.playerNames[1],g);c.x=a.width()-f-t.SCORE_BOX_W;c.y=e;a.stage.addChild(c);k(b.getCurrentPlayer())});a.observer.subscribe("gameOver",function(a){k(a)});a.observer.subscribe("view.boxesScored",function(){var a,c;c=b.getCurrentScores();for(a=0;a<c.length;a++)m[a].text=c[a]});a.observer.subscribe("views.playerTurnChanged",function(){k(b.getCurrentPlayer())});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.gameOver=function(a,b){function d(b,d,f){var g,k,m,q,t,r=a.scalePixel(10),s=a.scalePixel(2),z;g=new createjs.Container;m=a.height()-n.SCORE_BOARD_HEIGHT;q=a.width();k=new createjs.Text(b,h+"px "+e.FONT,e.SCORE_TXT_COLOR);k.textAlign="center";k.textBaseline="middle";t=k.getBounds();b=t.height+2*r+2*s;r=t.width+2*r+2*s;t=new createjs.Shape;t.graphics.beginFill(e.BOARD_BACK_COLOR).drawRect(0,0,r,b);g.addChild(t);z=new c(d);z.alpha=0.2;t=new createjs.Shape;t.graphics.setStrokeStyle(s).beginStroke(d).beginFill(z.toString()).drawRect(0,
0,r,b);g.addChild(t);k.x=r/2;k.y=b/2;g.addChild(k);g.x=q/2;g.y=m/2;d=(q-r)/2;m=(m-b)/2;g.alpha=0;g.scaleX=0;g.scaleY=0;a.stage.addChild(g);createjs.Tween.get(g,{override:!0}).wait(f).to({alpha:1,scaleX:1,scaleY:1,x:d,y:m},1E3,createjs.Ease.quadIn).wait(2500).to({x:q+r/2},500,createjs.Ease.quadOut).call(function(){a.stage.removeChild(g)})}function k(b,e,d){var f,h,g=a.scalePixel(1);b=a.boxShapes[b];h=a.getPlayerColor(e);f=new c(h);f.alpha=0.33;f=f.toString();e=new createjs.Shape;e.graphics.setStrokeStyle(g).beginStroke(h).beginFill(f).drawRect(b.upperLeft.x,
b.upperLeft.y,d,d);e.upperLeft={x:b.upperLeft.x,y:b.upperLeft.y};return e}function f(c,e){var d,h,x,y,q,t,r;m||(d=b.getPlayerBoxes(c),0!==d.length&&(q=2*n.DOT_RADIUS+n.DOT_MARGIN,d=d[g.getRandom(0,d.length-1)],r=k(d,c,q),h=a.scalePixel(15),d=(q+h)/q,x=-1*(r.upperLeft.x*d-r.upperLeft.x)-h/2,h=-1*(r.upperLeft.y*d-r.upperLeft.y)-h/2,y=a.scalePixel(45),q=(q+y)/q,t=-1*(r.upperLeft.x*q-r.upperLeft.x)-y/2,y=-1*(r.upperLeft.y*q-r.upperLeft.y)-y/2,r.alpha=0,e.addChild(r),createjs.Tween.get(r,{override:!1}).wait(1E3).to({alpha:0.5},
0).to({alpha:1,scaleX:d,scaleY:d,x:x,y:h},500).to({alpha:0,scaleX:q,scaleY:q,x:t,y:y},1500,createjs.Ease.sineOut).call(function(){e.removeChild(r);f(c,e)})))}var g=dotBox.utility,c=dotBox.views.Color,e=dotBox.views.constants,m=!1,h=a.scalePixel(18),n=a.pixelSizes;if(g.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(g.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.subscribe("gameOver",function(c){var h,g,k,m;m=0===c?1:0;h=b.gameConfig.playerNames[c];
g=b.gameConfig.playerNames[m];k=a.getPlayerColor(c);m=a.getPlayerColor(m);var n,q;q=new createjs.Container;n=new createjs.Shape;n.graphics.beginFill(e.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()-a.scalePixel(65));n.alpha=0.15;q.addChild(n);a.stage.addChild(q);createjs.Tween.get(n,{override:!0}).to({alpha:0.5},600,createjs.Ease.sineIn);f(c,q);d("=) "+h+" wins!",k,30);d("='(  Sorry "+g,m,4030)});a.observer.subscribe("stopGame",function(){m=!0});return{}};dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.utility=dotBox.ai.utility||{};
(function(a){function b(a,b){return 3<=b.getLineStatesForBox(a).open.length}function d(a){var b=[],e,d;d=function(e){for(var d;d=e.next();)a.isLineConnected(d)||b.push(d)};e=f.hLineIterator(a.getDotCountLength(),a.getDotCountWidth());d(e);e=f.vLineIterator(a.getDotCountLength(),a.getDotCountWidth());d(e);return b}var k=dotBox.utility,f=dotBox.utility.iterators;a.findCloseableBoxes=function(a){var b=[],e,d=a.getBoxCount(),h;for(e=0;e<d;e++)a.isBoxScored(e)||(h=a.getLineStatesForBox(e),1===h.open.length&&
b.push({boxIndex:e,openLine:h.open[0]}));return b};a.boxHasThreeOrMoreOpen=b;a.getAllOpenLines=d;a.findNonThirdSideLines=function(a){var c,e,f,h,n=a.getDotCountLength(),l=a.getDotCountWidth(),p=[],w;e=d(a);w=function(c){return b(c,a)};for(c=0;c<e.length;c++)h=e[c],f=k.line.getBoxesFromLine(h,n,l),f.every(w)&&p.push(h);return p}})(dotBox.ai.utility);dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AiPlayer=function AiPlayer(b,d){if(!(this instanceof AiPlayer))return AiPlayer.apply(new AiPlayer,arguments);this.playerIndex=b;this.gameEngine=d};
dotBox.ai.AiPlayer.prototype=function(){var a=dotBox.utility;return{getRandomDot:function(){var b,d;b=a.getRandom(0,this.gameEngine.getDotCountLength()-1);d=a.getRandom(0,this.gameEngine.getDotCountWidth()-1);return{x:b,y:d}},getRandomOpenLine:function(){var b=null;if(this.gameEngine.isGameOver())return null;for(;null===b;)b=this.getRandomDot(),b=this.gameEngine.getOpenLinesForDot(b),null!==b&&0===b.length&&(b=null);return a.getRandomItem(b)},move:function(){return this.getRandomOpenLine()},makeMove:function(a){var d=
this;if(void 0===a)return this.move();setTimeout(function(){a(d.move())},10)}}}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AvoidThirdSide=function(){var a=dotBox.utility,b=dotBox.ai.utility,d;d=function f(a,b){if(!(this instanceof f))return f.apply(new f,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(d,dotBox.ai.AiPlayer);d.prototype.move=function(){var f;f=b.findNonThirdSideLines(this.gameEngine);return 0<f.length?f=a.getRandomItem(f):d.uber.move.apply(this)};return d}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.SingleBoxCloser=function(){var a=dotBox.utility,b;b=function k(a,b){if(!(this instanceof k))return k.apply(new k,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(b,dotBox.ai.AvoidThirdSide);b.prototype.move=function(){var k;k=dotBox.ai.utility.findCloseableBoxes(this.gameEngine);return 0<k.length?(k=a.getRandomItem(k),k.openLine):b.uber.move.apply(this)};return b}();dotBox=dotBox||{};
dotBox.controller=function(a,b){function d(d,m){var l,p,w,v;w=c.getCurrentPlayer();p={d1:d,d2:m};l=c.connectLine(p);v=0<l.boxesScored.length;e.selectedDot=null;e.hoveredDot=null;a.publish("view.lineConnected",p,v);l=l.boxesScored;var x;if(0<l.length){v=[];for(p=0;p<l.length;p++)x=l[p],v.push({box:x,lines:g.line.getLinesFromBox(x,c.getDotCountLength())});a.publish("view.boxesScored",v,w)}c.isGameOver()?a.publish("gameOver",k()):(l=c.getCurrentPlayer(),null!==l&&l!==w&&a.publish("views.playerTurnChanged"),!e.isQuickStarting&&
b.useAi&&1===l&&f(l))}function k(){var a,b=0,c=0,d;d=e.getCurrentScores();for(a=0;a<d.length;a++)d[a]>=c&&(c=d[a],b=a);return b}function f(b){a.publish("startRemoteTurn",b);m.makeMove(function(c){a.publish("endRemoteTurn",b,c)})}var g=dotBox.utility,c,e=null,m;c=dotBox.gameEngine({dotCountLength:b.dotColCount,dotCountWidth:b.dotRowCount});(function(){var a=[];g.isNullOrUndefined(b.playerNames)&&(b.playerNames=[]);1>b.playerNames.length||g.isNullOrUndefined(b.playerNames[0])||0===b.playerNames[0].length?
a.push("PLAYER 1"):a.push(b.playerNames[0]);2>b.playerNames.length||g.isNullOrUndefined(b.playerNames[1])||0===b.playerNames[1].length?b.useAi?a.push("HAL9000"):a.push("PLAYER 2"):a.push(b.playerNames[1]);b.playerNames=a})();b.useAi&&(m=new dotBox.ai.SingleBoxCloser(1,c));e=dotBox.model(c,b);a.subscribe("dotRollOver",function(b){c.hasAnyOpenLines(b)&&(e.hoveredDot=b,a.publish("view.dotRollOver",b))});a.subscribe("dotRollOut",function(b){e.hoveredDot=null;a.publish("view.dotRollOut",b)});a.subscribe("dotClick",
function(b){var f=e.selectedDot;if(!c.hasAnyOpenLines(b))return null;e.isSelectedDot(b)?(e.selectedDot=null,a.publish("view.dotSelectionChanged",f,null)):null!==e.selectedDot&&e.canConnectDots(b)?d(f,b):(e.selectedDot=b,a.publish("view.dotSelectionChanged",f,b))});return{startGame:function(){a.publish("startGame",e);if(!g.isNullOrUndefined(b.preMovePercent)){var h=b.preMovePercent,k,l;if(0>h||1<h)throw Error("percent must be between 0 and 1");if(0!==h){k=c.getTotalLineCount();k=Math.floor(k*h);0<
k&&(e.isQuickStarting=!0);for(var m=new dotBox.ai.AvoidThirdSide(-1,c),h=0;h<k;h++)l=m.move(),d(l.d1,l.d2);e.isQuickStarting=!1;h=c.getCurrentPlayer();b.useAi&&1===h&&f(c.getCurrentPlayer())}}},model:e}};dotBox=dotBox||{};
dotBox.game=function(a,b){var d,k,f=[],g,c;d=new Observer;k=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth);k=dotBox.views.viewContext(d,k,b.uiScale);g=dotBox.controller(d,b);c=g.model;f.push(dotBox.views.board(k,c));f.push(dotBox.views.score(k,c));f.push(dotBox.views.gameOver(k,c));k.initCanvasStage(function(a){if(a instanceof jQuery)return $(a[0]);"string"===typeof a&&0!==a.lastIndexOf("#",0)&&(a="#"+a);return $(a)}(a));g.startGame();return{stopGame:function(){d.publish("stopGame")}}};
(function(a){a.fn.dotBox=function(a){return dotBox.game(this,a)}})(jQuery);dotBox=dotBox||{};
dotBox.viewModel=function(){function a(a){return void 0===a||null===a||0===a.length||10<a.length?!1:!0}var b={playerMode:ko.observable("pvc"),playerName1:ko.observable("PLAYER 1"),playerName2Custom:ko.observable("PLAYER 2"),dotCols:ko.observable(10),dotRows:ko.observable(6),quickGame:ko.observable(!0),fillPercentCustom:ko.observable(30),uiScale:ko.observable(1.25),game:null};b.useAi=ko.computed(function(){return"pvc"===b.playerMode()});b.playerName2=ko.computed({read:function(){return b.useAi()?"HAL9000":
b.playerName2Custom()},write:function(a){b.useAi()||b.playerName2Custom(a)}});b.fillPercent=ko.computed({read:function(){return b.quickGame()?b.fillPercentCustom():0},write:function(a){b.quickGame()&&b.fillPercentCustom(a)}});b.toGameConfig=function(){return{dotColCount:b.dotCols(),dotRowCount:b.dotRows(),useAi:b.useAi(),preMovePercent:b.fillPercent()/100,playerNames:[b.playerName1(),b.playerName2()],uiScale:b.uiScale()}};b.newGame=function(){if(!b.isValid())return $("#globalError").removeClass("hidden"),
!1;$("#globalError").addClass("hidden");var a=$("#canvasContainer"),k=b.toGameConfig();null!==b.game&&b.game.stopGame();a.empty();b.game=a.dotBox(k);return!0};b.isP1NameValid=ko.computed(function(){return a(b.playerName1())});b.isP2NameValid=ko.computed(function(){return a(b.playerName2())});b.isDotColsValid=ko.computed(function(){return 6>b.dotCols()||20<b.dotCols()?!1:!0});b.isDotRowsValid=ko.computed(function(){return 3>b.dotRows()||20<b.dotRows()?!1:!0});b.isFillPercentValid=ko.computed(function(){return 1>
b.fillPercentCustom()||100<b.fillPercentCustom()?!1:!0});b.isValid=ko.computed(function(){return b.isP1NameValid()&&b.isP2NameValid()&&b.isDotColsValid()&&b.isDotRowsValid()&&b.isFillPercentValid()?!0:!1});return b}();dotBox=dotBox||{};dotBox.ko=dotBox.ko||{};dotBox.ko.addCustomBindings=function(){ko.bindingHandlers.slider={init:function(a,b,d){d=d().sliderOptions||{};$(a).slider(d);ko.utils.registerEventHandler(a,"slidechange",function(a,d){b()(d.value)});ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")});ko.utils.registerEventHandler(a,"slide",function(a,d){b()(d.value)})},update:function(a,b){var d=ko.utils.unwrapObservable(b());isNaN(d)&&(d=0);$(a).slider("value",d)}}};$(document).ready(function(){$(".alert .close").on("click",function(){$(this).parent().addClass("hidden")});dotBox.utility.isCanvasSupported()?($("#newGameBtn").on("click",function(){dotBox.viewModel.newGame()&&$("html, body").animate({scrollTop:$("#canvasContainer").offset().top-50},300)}),dotBox.ko.addCustomBindings(),ko.applyBindings(dotBox.viewModel),dotBox.viewModel.newGame()):($("#mainContainer").addClass("hidden"),$("#failContainer").removeClass("hidden"))}); //@ sourceMappingURL=./dotBox-min.js.map
