var Observer=function(){function a(a,b){return b.priority-a.priority}function b(a){return void 0===a?!0:null===a}var l;l=function e(){if(!(this instanceof e))return new e;this._channelSubscribers={}};l.prototype.subscribe=function(e,h,f){var d=this._channelSubscribers[e];b(d)&&(d=[]);if(b(f)){f=d;var c,k,n=0;if(!b(f))for(k=f.length,c=0;c<k;c++)0>f[c].priority&&f[c].priority<n&&(n=f[c].priority);f=n-1}d.push({priority:f,callback:h});d=d.sort(a);this._channelSubscribers[e]=d};l.prototype.unsubscribe=
function(a,h){var f,d=this._channelSubscribers[a];if(!b(d)){for(f=0;f<d.length;f++)if(d[f].callback===h){d.splice(f,1);break}0===d.length&&delete this._channelSubscribers[a]}};l.prototype.publish=function(a,h,f,d){var c,k,n,m=null;if(0===arguments.length||b(a))throw Error("channelId argument required.");1<arguments.length&&(m=Array.prototype.slice.call(arguments,1));n=this._channelSubscribers[a];k={channelId:a,cancel:!1};if(b(n))return!0;for(c=0;c<n.length;c++)if(n[c].callback.apply(k,m),k.cancel)return!1;
return!0};return l}();var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};
(function(a){function b(a){return void 0===a?!0:null===a}a.isNullOrUndefined=b;a.areSameDot=function(a,g){return b(a)&&b(g)?!0:b(a)!==b(g)?!1:a.x===g.x&&a.y===g.y};a.getRandom=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};a.getRandomItem=function(b){var g;g=a.getRandom(0,b.length-1);return b[g]};a.inherit=function(){var a=function(){};return function(b,e){a.prototype=e.prototype;b.prototype=new a;b.uber=e.prototype;b.prototype.constructor=b}}()})(dotBox.utility);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.line=dotBox.utility.line||{};
(function(a){function b(a){return 0<Math.abs(a.d1.x-a.d2.x)}a.isHLine=b;a.getBoxesFromLine=function(a,g,e){var h=g-1,f=[],d,c;b(a)?(d=a.d1.y,c=Math.min(a.d1.x,a.d2.x),0!==a.d1.y&&(a.d1.y!==e-1&&f.push(d*h+c),d-=1)):(c=a.d1.x,d=Math.min(a.d1.y,a.d2.y),0!==a.d1.x&&(a.d1.x!==g-1&&f.push(d*h+c),c-=1));f.push(d*h+c);return f};a.getLinesFromBox=function(a,b){var e=b-1,h=[],f;f=a%e;e=(a-f)/e;h.push({d1:{x:f,y:e},d2:{x:f+1,y:e}});h.push({d1:{x:f+1,y:e},d2:{x:f+1,y:e+1}});h.push({d1:{x:f,y:e+1},d2:{x:f+1,
y:e+1}});h.push({d1:{x:f,y:e},d2:{x:f,y:e+1}});return h}})(dotBox.utility.line);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.iterators=dotBox.utility.iterators||{};
(function(a){a.hLineIterator=function(a,l){function g(){return f?!1:{d1:{x:e,y:h},d2:{x:e+1,y:h}}}var e=-1,h=0,f=!1;return{next:function(){if(f)return null;if(h===l-1&&e===a-2)return f=!0,null;e===a-2?(h+=1,e=0):e+=1;return g()},current:g}};a.vLineIterator=function(a,l){function g(){return f?!1:{d1:{x:e,y:h},d2:{x:e,y:h+1}}}var e=-1,h=0,f=!1;return{next:function(){if(f)return null;if(h===l-2&&e===a-1)return f=!0,null;e===a-1?(h+=1,e=0):e+=1;return g()},current:g}}})(dotBox.utility.iterators);dotBox=dotBox||{};
dotBox.boxState=function(a,b){function l(){return f.length}function g(a){var c=l();if(0>a)throw new RangeError("boxIndex must be greater or equal to 0.");if(a>=c)throw new RangeError("boxIndex must be less than the box count ("+c+").");}function e(a){g(a);return null!==f[a]}function h(a){g(a);return f[a]}var f;(function(a,c){var k,b=(a-1)*(c-1);f=[];for(k=0;k<b;k++)f[k]=null})(a,b);return{getBoxCount:l,areAllBoxesScored:function(){return f.every(function(a){return null!==a})},isBoxScored:e,isBoxNotScored:function(a){return!e(a)},
whichPlayerScoredBox:h,scoreBox:function(a,c){g(a);f[a]=c},getCurrentScores:function(a){var c,k=[],b;for(c=0;c<a;c++)k[c]=0;a=l();for(c=0;c<a;c++)e(c)&&(b=h(c),k[b]+=1);return k},getPlayerBoxes:function(a){var c,k,b=[],f;k=l();for(c=0;c<k;c++)f=h(c),f===a&&b.push(c);return b}}};dotBox=dotBox||{};
dotBox.lineState=function(a,b){function l(c,k){var b,d;if(e.isNullOrUndefined(c))throw Error("line is null or undefined");g(c.d1,"line.d1");g(c.d2,"line.d2");d=Math.abs(c.d1.x-c.d2.x);b=Math.abs(c.d1.y-c.d2.y);if(1<d)throw new RangeError("Move appears to be too long on x-axis.  Line must only connect adjacent points.");if(1<b)throw new RangeError("Move appears to be too long on y-axis.  Line must only connect adjacent points.");if(1<d+b)throw new RangeError("Movement appears to be diagonal this is not allowed.");var r;
e.line.isHLine(c)?(d=h,b=c.d1.y,r=Math.min(c.d1.x,c.d2.x),b=b*(a-1)+r):(d=f,b=Math.min(c.d1.y,c.d2.y),r=c.d1.x,b=b*a+r);e.isNullOrUndefined(k)||k&&(d[b]=!0);return d[b]}function g(c,k){if(e.isNullOrUndefined(c))throw Error(k+" is null or undefined.");if(0>c.x)throw new RangeError(k+".x must be > 0.");if(c.x>=a)throw new RangeError(k+".x must be < "+a);if(0>c.y)throw new RangeError(k+".y must be > 0.");if(c.y>=b)throw new RangeError(k+".y must be < "+b);}var e=dotBox.utility,h=[],f=[],d;d={connected:l,
isBoxClosed:function(b){var k;k=e.line.getLinesFromBox(b,a);for(b=0;4>b;b++)if(!l(k[b]))return!1;return!0},getAllLinesForDot:function(c){var k=[],f,h;f=function(){return{x:c.x,y:c.y}};h=function(a,b){k.push({d1:f(),d2:{x:a,y:b}})};0<c.y&&h(c.x,c.y-1);c.x<a-1&&h(c.x+1,c.y);c.y<b-1&&h(c.x,c.y+1);0<c.x&&h(c.x-1,c.y);return k},getOpenLinesForDot:function(a){return d.getAllLinesForDot(a).filter(function(a){return!d.connected(a)})},getTotalLineCount:function(){return f.length+h.length},getLineStatesForBox:function(b){var k=
[],f=[],h,e;b=dotBox.utility.line.getLinesFromBox(b,a);for(h=0;4>h;h++)e=b[h],d.connected(e)?f.push(e):k.push(e);return{open:k,closed:f}}};(function(a,b){var d,e,r;e=(a-1)*b;r=(b-1)*a;for(d=0;d<e;d++)h[d]=!1;for(d=0;d<r;d++)f[d]=!1})(a,b);return d};dotBox=dotBox||{};
dotBox.gameEngine=function(a){function b(){return l()?null:k}function l(){return m.areAllBoxesScored()}var g=dotBox.utility,e,h,f,d,c,k,n,m=null;(function(a){a||(a={});h=g.isNullOrUndefined(a.dotCountLength)?10:parseInt(a.dotCountLength,10);f=g.isNullOrUndefined(a.dotCountWidth)?10:parseInt(a.dotCountWidth,10);e=g.isNullOrUndefined(a.playerCount)?2:parseInt(a.playerCount,10);k=g.isNullOrUndefined(a.startPlayer)?0:parseInt(a.startPlayer,10);if(isNaN(h))throw new TypeError("dotCountLength is not a number.");if(isNaN(f))throw new TypeError("dotCountWidth is not a number.");
if(isNaN(e))throw new TypeError("playerCount is not a number.");if(isNaN(k))throw new TypeError("startPlayer is not a number.");if(3>h)throw new RangeError("dotCountLength must be three or more");if(3>f)throw new RangeError("dotCountWidth must be three or more");if(2>e)throw new RangeError("playerCount must two or more");if(0>k||k>=e)throw new RangeError("startPlayer must be between 0 and playerCount-1");d=h-1;c=f-1;m=g.isNullOrUndefined(a.boxState)?dotBox.boxState(h,f):a.boxState;n=g.isNullOrUndefined(a.lineState)?
dotBox.lineState(h,f):a.lineState})(a);return{getDotCountLength:function(){return h},getBoxCountLength:function(){return d},getDotCountWidth:function(){return f},getBoxCountWidth:function(){return c},getBoxCount:function(){return d*c},getPlayerCount:function(){return e},getCurrentPlayer:b,getCurrentScores:function(){return m.getCurrentScores(e)},isLineConnected:function(a){return n.connected(a)},connectLine:function(a){var c={},d;if(l())throw Error("Cannot make a move when the game is over.");if(n.connected(a))throw Error("This line is already connected.");
d=b();n.connected(a,!0);a=g.line.getBoxesFromLine(a,h,f).filter(n.isBoxClosed).filter(m.isBoxNotScored);a.forEach(function(a){m.scoreBox(a,d)});c.boxesScored=a;c.gameOver=l();0===c.boxesScored.length?(a=l()?null:k=k===e-1?0:k+1,c.nextPlayer=a):c.nextPlayer=b();return c},isGameOver:l,hasAnyOpenLines:function(a){if(void 0===a)throw Error("dot argument was not supplied.");if(null===a)throw Error("dot argument was null.");return 0<n.getOpenLinesForDot(a).length},canConnectDots:function(a,b){var k,c,f;
if(g.isNullOrUndefined(a))throw Error("dot1 argument was null or undefined.");if(g.isNullOrUndefined(b))throw Error("dot2 argument was null or undefined.");c=n.getOpenLinesForDot(a);for(k=0;k<c.length;k++)if(f=c[k].d2,g.areSameDot(f,b))return!0;return!1},getPlayerBoxes:function(){return m.getPlayerBoxes.apply(m,arguments)},getOpenLinesForDot:function(){return n.getOpenLinesForDot.apply(n,arguments)},getTotalLineCount:function(){return n.getTotalLineCount.apply(n,arguments)},isBoxScored:function(){return m.isBoxScored.apply(m,
arguments)},getLineStatesForBox:function(){return n.getLineStatesForBox.apply(n,arguments)}}};dotBox=dotBox||{};
dotBox.model=function(a,b){var l=dotBox.utility,g;return g={selectedDot:null,hoveredDot:null,isSelectedDot:function(a){return null!==g.selectedDot&&l.areSameDot(a,g.selectedDot)},isHoveredDot:function(a){return null!==g.hoveredDot&&l.areSameDot(a,g.hoveredDot)},getDotColCount:function(){return a.getDotCountLength()},canConnectDots:function(b){return null!==g.selectedDot&&a.canConnectDots(g.selectedDot,b)},getDotRowCount:function(){return a.getDotCountWidth()},hasAnyOpenLines:function(b){return a.hasAnyOpenLines(b)},getCurrentScores:function(){return a.getCurrentScores()},
getCurrentPlayer:function(){return a.getCurrentPlayer()},getPlayerBoxes:function(){return a.getPlayerBoxes.apply(a,arguments)},gameConfig:b,isQuickStarting:!1}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};dotBox.views.constants={P1_COLOR:"#A4E402",P2_COLOR:"#BF7AFF",PX_COLOR:"#5B5B5B",SCORE_TXT_COLOR:"#E7F8F2",BOARD_BACK_COLOR:"#272822"};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.viewContext=function(a,b,l){var g,e;function h(a){for(var c in a)a.hasOwnProperty(c)&&(a[c]=a[c]*b*l);return a}var f=dotBox.utility,d,c;if(f.isNullOrUndefined(a))throw Error("observer parameter is required.");if(f.isNullOrUndefined(b))throw Error("pixelRatio is required.");e=g=0;c=h({DOT_RADIUS:5,DOT_MARGIN:20,POINT_FONT_SIZE:13,SCORE_BOARD_HEIGHT:65});a.subscribe("view.reserveCanvasSize",function(a){f.isNullOrUndefined(a)||(f.isNullOrUndefined(a.height)||(g+=a.height),f.isNullOrUndefined(a.width)||
(e+=a.width))});return d={observer:a,pixelRatio:b,stage:null,boxShapes:{},pixelSizes:c,initCanvasStage:function(a){var c;c=0;for(var f=null,h,l;null===f;)h="dotBoxCanvas_"+c,l=$("#"+h),0===l.length&&(f=h),c+=1;c=f;a.append('<canvas id="'+c+'" width='+e+" height="+g+' style="width: '+1/b*e+"px; height: "+1/b*g+'px;"></canvas>');d.stage=new createjs.Stage(c)},scalePixel:function(a){return a*b*l},scaleAllPixelProps:h,setDrawColors:function(a){var b=a.fillColor;a=a.strokeColor;dotBox.utility.isNullOrUndefined(b)||
(this.fillStyle=b.toString());dotBox.utility.isNullOrUndefined(a)||(this.strokeStyle=a.toString())},width:function(){if(null===d.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return d.stage.canvas.width},height:function(){if(null===d.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return d.stage.canvas.height},getPlayerColor:function(a){switch(a){case 0:return dotBox.views.constants.P1_COLOR;case 1:return dotBox.views.constants.P2_COLOR;
default:return dotBox.views.constants.PX_COLOR}}}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.Color=function(){function a(a){var b,d,c;b=parseInt(a.slice(1,3),16);d=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);c=new e;c.red=b;c.green=d;c.blue=a;return c}function b(a){var b,d,c,k;a=a.trim();a=a.toLowerCase();a=a.slice(5,a.length-1);a=a.trim();c=a.split(",");if(4!==c.length)throw Error("Could not parse rgba() color string.");a=parseInt(c[0].trim(),10);b=parseInt(c[1].trim(),10);d=parseInt(c[2].trim(),10);c=parseFloat(c[3].trim());k=new e;k.red=a;k.green=b;k.blue=d;k.alpha=
c;return k}function l(a){var b,d,c;a=a.trim();a=a.toLowerCase();a=a.slice(4,a.length-1);a=a.trim();d=a.split(",");if(3!==d.length)throw Error("Could not parse rgb() color string.");a=parseInt(d[0].trim(),10);b=parseInt(d[1].trim(),10);d=parseInt(d[2].trim(),10);c=new e;c.red=a;c.green=b;c.blue=d;return c}function g(e){e=e.trim();if(0===e.lastIndexOf("#",0)&&7===e.length)return a(e);if(0===e.lastIndexOf("rgba(",0))return b(e);if(0===e.lastIndexOf("rgb(",0))return l(e);throw Error("Invalid arguments.");
}var e;e=function f(a){var b;if(!(this instanceof f))return f.apply(new f,arguments);this.green=this.blue=this.red=255;this.alpha=1;if(1===arguments.length)return b=a.toString(),g(b);if(4===arguments.length){var k=arguments,n,m,l;b=Math.round(parseFloat(k[0]));n=Math.round(parseFloat(k[1]));m=Math.round(parseFloat(k[2]));l=parseFloat(k[3]);k=new e;k.red=b;k.green=n;k.blue=m;k.alpha=l;return k}if(3===arguments.length)return m=arguments,b=Math.round(parseFloat(m[0])),n=Math.round(parseFloat(m[1])),
k=Math.round(parseFloat(m[2])),m=new e,m.red=b,m.green=n,m.blue=k,m;if(0!==arguments.length)throw Error(arguments.length+" number of arguments not supported.");};e.parseHexColorString=a;e.parseColorString=g;e.parseRgbaColorString=b;e.parseRgbColorString=l;e.prototype.toString=function(){var a,b,c;a=Math.round(this.red);b=Math.round(this.green);c=Math.round(this.blue);return"rgba("+[a,b,c,this.alpha].join()+")"};e.prototype.clone=function(){var a=new e;a.red=this.red;a.green=this.green;a.blue=this.blue;
a.alpha=this.alpha;return a};return e}();dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.board=function(a,b){function l(b){p.isNullOrUndefined(b)||a.observer.publish("dotRollOver",b)}function g(b){p.isNullOrUndefined(b)||a.observer.publish("dotRollOut",b)}function e(){B||h(this.dot)}function h(b){a.observer.publish("dotClick",b)}function f(){var a=F,c=t(2.5*s.DOT_RADIUS);p.areSameDot(a,c)||(B||(!p.isNullOrUndefined(c)&&b.hasAnyOpenLines(c)?d("pointer"):d("")),F=c,B||(g(a),l(c)))}function d(b){a.stage.canvas.style.cursor=b}function c(){a.stage.update()}function k(c){var k,
f;c instanceof createjs.Shape?(k=c,c=k.dot,f=!0):(k=n(c),f=!1);c=b.isSelectedDot(c)?H:b.isHoveredDot(c)&&b.canConnectDots(c)?C:b.isHoveredDot(c)?I:J;c=new G(c);f?(k.fillColor=c,k.graphics.beginFill(c).inject(a.setDrawColors,k).drawCircle(0,0,s.DOT_RADIUS).endFill()):createjs.Tween.get(k.fillColor,{override:!0}).to(c,250);return k}function n(a){return E[a.y][a.x]}function m(c,k,f){var d,e=n(c.d1),h=n(c.d2),g=!1,m=a.scalePixel(1),l=null,s;d=x(c);p.isNullOrUndefined(d)?(d=new createjs.Shape,u(c,d),g=
!0):d.graphics.clear();d.graphics.setStrokeStyle(m).beginStroke(k).moveTo(e.x,e.y).lineTo(h.x,h.y);s=b.isQuickStarting;g&&(D.isHLine(c)?(d.scaleX=0.1,d.x=e.x-0.1*e.x,l={scaleX:1,x:0}):(d.scaleY=0.1,d.y=e.y-0.1*e.y,l={scaleY:1,y:0}),d.on("click",r),a.stage.addChild(d),createjs.Tween.get(d,{override:!0}).to(l,300).call(function(){var b;s||f||(b=new createjs.Shape,b.graphics.setStrokeStyle(a.scalePixel(1)).beginStroke(z).drawCircle(0,0,a.pixelSizes.DOT_RADIUS),b.x=h.x,b.y=h.y,b.scaleX=0,b.scaleY=0,a.stage.addChild(b),
createjs.Tween.get(b).to({scaleX:1.5,scaleY:1.5},150).to({scaleX:5,scaleY:5,alpha:0},1E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(b)}))}))}function r(b){b=a.stage.getObjectsUnderPoint(b.stageX,b.stageY).filter(function(a){return!p.isNullOrUndefined(a.dot)});0<b.length&&e.apply(b[0])}function v(c,k){var d,f,e,h;b.isQuickStarting||(f=n(c.lines[0].d1),h=n(c.lines[0].d2),d=f.x+(h.x-f.x)/2,f=n(c.lines[1].d1),h=n(c.lines[1].d2),f=f.y+(h.y-f.y)/2,e=new createjs.Text("+"+k,s.POINT_FONT_SIZE+
"px Helvetica",A.SCORE_TXT_COLOR),e.x=d,e.y=f,e.textAlign="center",e.textBaseline="middle",e.alpha=0,a.stage.addChild(e),createjs.Tween.get(e,{override:!1}).wait(550).to({alpha:1},0).to({alpha:0,y:a.height()+a.scalePixel(50)},3E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(e)}),createjs.Tween.get(e,{override:!1}).wait(550).to({scaleX:1.5,scaleY:1.5},200,createjs.Ease.elasticInOut))}function u(a,b){var c,k;c=w(a);k=c.store[c.y];p.isNullOrUndefined(k)&&(k={},c.store[c.y]=k);k[c.x]=b}
function x(a){var b;a=w(a);if(!a.store.hasOwnProperty(a.y))return null;b=a.store[a.y];return b.hasOwnProperty(a.x)?b[a.x]:null}function w(a){var b,c;p.line.isHLine(a)?(c=K,b=a.d1.y,a=Math.min(a.d1.x,a.d2.x)):(c=L,b=Math.min(a.d1.y,a.d2.y),a=a.d1.x);return{x:a,y:b,store:c}}function q(a,b){var c;c=Math.floor((a-s.DOT_MARGIN/2)/(2*s.DOT_RADIUS+s.DOT_MARGIN));return 0>c||c>=b?null:c}function t(c){var k,f,d,e;k=a.stage.mouseX;f=a.stage.mouseY;if(!a.stage.mouseInBounds)return null;d=q(k,b.getDotColCount());
if(null===d)return null;e=q(f,b.getDotRowCount());if(null===e)return null;d={x:d,y:e};e=n(d);var h=e.y;k=Math.pow(e.x-k,2)+Math.pow(h-f,2);c=Math.pow(c,2);k<=c||(d=null);return d}var p=dotBox.utility,D=dotBox.utility.line,A=dotBox.views.constants,G=dotBox.views.Color;if(p.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(p.isNullOrUndefined(b))throw Error("model is null or undefined.");var s=a.pixelSizes,J="#53d2f1",I="#89E0F5",H="#fc1f70",C="#E20355",z="white",E,K={},L={},
y,F=null,B=!1;(function(){var c,k,d;c={height:0,width:0};k=2*b.getDotColCount()*s.DOT_RADIUS;d=(b.getDotColCount()+1)*s.DOT_MARGIN;c.width=k+d;k=2*b.getDotRowCount()*s.DOT_RADIUS;d=(b.getDotRowCount()+1)*s.DOT_MARGIN;c.height=k+d;a.observer.publish("view.reserveCanvasSize",c)})();a.observer.subscribe("startGame",function(){var d,h,g,m=b.getDotRowCount(),l=b.getDotColCount(),n;d=new createjs.Shape;d.graphics.beginFill(A.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height());a.stage.addChild(d);E=[];
for(h=0;h<m;h++)for(d=0;d<l;d++)0===d&&(n=[],E.push(n)),g=new createjs.Shape,g.dot={x:d,y:h},k(g),g.x=d*(s.DOT_MARGIN+2*s.DOT_RADIUS)+(s.DOT_MARGIN+s.DOT_RADIUS),g.y=h*(s.DOT_MARGIN+2*s.DOT_RADIUS)+(s.DOT_MARGIN+s.DOT_RADIUS),g.on("click",e),n.push(g),a.stage.addChild(g);a.stage.update();a:{m=20;y&&(clearInterval(y),y=null);if(null===m)m=20;else if(0>=m)break a;y=setInterval(f,1E3/Math.min(50,m))}createjs.Ticker.addEventListener("tick",c);createjs.Ticker.setFPS(60)});a.observer.subscribe("view.dotRollOver",
function(a){a=k(a);createjs.Tween.get(a,{override:!0}).to({scaleX:2,scaleY:2},150)});a.observer.subscribe("view.dotRollOut",function(a){a=k(a);createjs.Tween.get(a,{override:!0}).to({scaleX:1,scaleY:1},150)});a.observer.subscribe("view.dotSelectionChanged",function(a,b){var c;null!==a&&k(a);null!==b&&k(b);a!==b&&(c=n(null!==b?b:a),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150).call(function(){var a=t(s.DOT_RADIUS);p.isNullOrUndefined(a)&&d("")}))});a.observer.subscribe("view.lineConnected",
function(a,b){var c;k(a.d1);c=k(a.d2);createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150);m(a,z,b)});a.observer.subscribe("view.boxesScored",function(b,c){var d;for(d=0;d<b.length;d++){var k=b[d],f=c,e=void 0,h=void 0,g=e=void 0,m=void 0,l=void 0,s=void 0,g=void 0,p=a.scalePixel(10),u=a.scalePixel(1),s=a.getPlayerColor(f),l=new G(s);l.alpha=0.33;l=l.toString();h=n(k.lines[0].d1);e=n(k.lines[1].d2);g=e.x-h.x;m=e.y-h.y;e=new createjs.Shape;e.graphics.setStrokeStyle(u).beginStroke(s).beginFill(l).drawRect(h.x,
h.y,g,m);g=(g+p)/g;e.scaleX=g;e.scaleY=g;e.x=-1*(h.x*g-h.x)-p/2;e.y=-1*(h.y*g-h.y)-p/2;e.upperLeft={x:h.x,y:h.y};e.alpha=0;e.on("click",r);a.stage.addChild(e);a.boxShapes[k.box]=e;createjs.Tween.get(e,{override:!0}).wait(350).to({alpha:1},0).to({x:0,y:0,scaleX:1,scaleY:1},350)}v(b[0],b.length)});a.observer.subscribe("startRemoteTurn",function(a){d("wait");B=!0});a.observer.subscribe("endRemoteTurn",function(a,b){var c=p.getRandom(700,1250),k=p.getRandom(170,750),e=p.getRandom(500,750),f=p.getRandom(Math.floor(75),
750);setTimeout(function(){l(b.d1);setTimeout(function(){h(b.d1);g(b.d1);setTimeout(function(){l(b.d2);setTimeout(function(){B=!1;d(null);h(b.d2);g(b.d2)},f)},e)},k)},c)});a.observer.subscribe("stopGame",function(){createjs.Ticker.removeEventListener("tick",c);y&&(clearInterval(y),y=null)});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.score=function(a,b){function l(b,e){var h=new createjs.Container,g,l=a.scalePixel(1),p=a.scalePixel(2),u=a.scalePixel(9),C=a.scalePixel(6),z=a.scalePixel(13);g=new createjs.Shape;g.graphics.setStrokeStyle(l).beginStroke(v).beginFill(r).drawRoundRect(0,0,t.SCORE_BOX_W,e,p);h.addChild(g);g=new createjs.Text("0",t.SCORE_FONT_SIZE+"px Helvetica",f.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=C+e/2;g.textAlign="center";g.textBaseline="middle";h.addChild(g);c.push(g);g=new createjs.Shape;g.graphics.setStrokeStyle(l).beginFill(x).beginStroke(w).arc(t.SCORE_BOX_W/
2,e+z,t.SCORE_BOX_W/4,Math.PI+0.25*Math.PI,1.75*Math.PI);g.alpha=0;k.push(g);h.addChild(g);l=g=new createjs.Shape;p=Math.round(0.3*e);C=a.scalePixel(2);z=a.scalePixel(2);l.fillColor=new d(q);l.strokeColor=new d(q);l.graphics.setStrokeStyle(C).beginStroke(q).beginFill(q).inject(a.setDrawColors,l).drawRoundRect(0,0,t.SCORE_BOX_W,p,z).endFill();h.addChild(g);n.push(g);g=new createjs.Text(b,t.P_NAME_FONT_SIZE+"px Helvetica",f.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=u;g.textAlign="center";g.textBaseline=
"middle";m.push(g);h.addChild(g);return h}function g(a){var b,c,d,h,g;for(b=0;b<k.length;b++)c=k[b],b===a?(createjs.Tween.get(c,{override:!0}).to({alpha:1},250,createjs.Ease.sineIn),c=f.SCORE_TXT_COLOR):(createjs.Tween.get(c,{override:!0}).to({alpha:0},250,createjs.Ease.sineOut),c=u),g=n[b],d=e("fill",b,a),h=e("stroke",b,a),createjs.Tween.get(g.fillColor,{override:!0}).to(d,200),createjs.Tween.get(g.strokeColor,{override:!0}).to(h,200),m[b].color=c}function e(a,b,c){b===c?(b=0===b?new d(f.P1_COLOR):
new d(f.P2_COLOR),"fill"===a&&(b.alpha=0.33)):b=new d(q);return b}var h=dotBox.utility,f=dotBox.views.constants,d=dotBox.views.Color,c=[],k=[],n=[],m=[],r="#272822",v="#3b3d38",u="#a69b9d",x="#fc1f70",w="#E20355",q="#40403d",t=a.scaleAllPixelProps({SCORE_BOX_W:75,SCORE_FONT_SIZE:25,P_NAME_FONT_SIZE:10}),p=a.pixelSizes.SCORE_BOARD_HEIGHT;if(h.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(h.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.publish("view.reserveCanvasSize",
{height:p});a.observer.subscribe("startGame",function(){var d,e,f=a.scalePixel(10);e=a.scalePixel(5);var h=p-2*e;d=a.height()-p;e=d+e+1;c=[];k=[];n=[];m=[];var r,u=a.scalePixel(1),v=a.height(),q=a.width();r=new createjs.Shape;r.graphics.beginLinearGradientFill(["#5b5b5b","#545454"],[0,1],0,d,0,v).drawRect(0,d,q,v).endFill();r.graphics.setStrokeStyle(u).beginStroke("#323232").moveTo(0,d).lineTo(q,d).endStroke();r.graphics.setStrokeStyle(u).beginStroke("#7d7d7d").moveTo(0,d+u).lineTo(q,d+u).endStroke();
a.stage.addChild(r);d=l(b.gameConfig.playerNames[0],h);d.x=f;d.y=e;a.stage.addChild(d);d=l(b.gameConfig.playerNames[1],h);d.x=a.width()-f-t.SCORE_BOX_W;d.y=e;a.stage.addChild(d);g(b.getCurrentPlayer())});a.observer.subscribe("gameOver",function(a){g(a)});a.observer.subscribe("view.boxesScored",function(){var a,d;d=b.getCurrentScores();for(a=0;a<d.length;a++)c[a].text=d[a]});a.observer.subscribe("views.playerTurnChanged",function(){g(b.getCurrentPlayer())});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.gameOver=function(a,b){function l(b,c,e){var h,g,l,q,t,p=a.scalePixel(10),D=a.scalePixel(2),A;h=new createjs.Container;l=a.height()-n.SCORE_BOARD_HEIGHT;q=a.width();g=new createjs.Text(b,k+"px Helvetica",d.SCORE_TXT_COLOR);g.textAlign="center";g.textBaseline="middle";t=g.getBounds();b=t.height+2*p+2*D;p=t.width+2*p+2*D;t=new createjs.Shape;t.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,p,b);h.addChild(t);A=new f(c);A.alpha=0.2;t=new createjs.Shape;t.graphics.setStrokeStyle(D).beginStroke(c).beginFill(A.toString()).drawRect(0,
0,p,b);h.addChild(t);g.x=p/2;g.y=b/2;h.addChild(g);h.x=q/2;h.y=l/2;c=(q-p)/2;l=(l-b)/2;h.alpha=0;h.scaleX=0;h.scaleY=0;a.stage.addChild(h);createjs.Tween.get(h,{override:!0}).wait(e).to({alpha:1,scaleX:1,scaleY:1,x:c,y:l},1E3,createjs.Ease.quadIn).wait(2500).to({x:q+p/2},500,createjs.Ease.quadOut).call(function(){a.stage.removeChild(h)})}function g(b,c,d){var e,k,h=a.scalePixel(1);b=a.boxShapes[b];k=a.getPlayerColor(c);e=new f(k);e.alpha=0.33;e=e.toString();c=new createjs.Shape;c.graphics.setStrokeStyle(h).beginStroke(k).beginFill(e).drawRect(b.upperLeft.x,
b.upperLeft.y,d,d);c.upperLeft={x:b.upperLeft.x,y:b.upperLeft.y};return c}function e(d,k){var f,l,x,w,q,t,p;c||(f=b.getPlayerBoxes(d),0!==f.length&&(q=2*n.DOT_RADIUS+n.DOT_MARGIN,f=f[h.getRandom(0,f.length-1)],p=g(f,d,q),l=a.scalePixel(15),f=(q+l)/q,x=-1*(p.upperLeft.x*f-p.upperLeft.x)-l/2,l=-1*(p.upperLeft.y*f-p.upperLeft.y)-l/2,w=a.scalePixel(45),q=(q+w)/q,t=-1*(p.upperLeft.x*q-p.upperLeft.x)-w/2,w=-1*(p.upperLeft.y*q-p.upperLeft.y)-w/2,p.alpha=0,k.addChild(p),createjs.Tween.get(p,{override:!1}).wait(1E3).to({alpha:0.5},
0).to({alpha:1,scaleX:f,scaleY:f,x:x,y:l},500).to({alpha:0,scaleX:q,scaleY:q,x:t,y:w},1500,createjs.Ease.sineOut).call(function(){k.removeChild(p);e(d,k)})))}var h=dotBox.utility,f=dotBox.views.Color,d=dotBox.views.constants,c=!1,k=a.scalePixel(18),n=a.pixelSizes;if(h.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(h.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.subscribe("gameOver",function(c){var k,f,h,g;g=0===c?1:0;k=b.gameConfig.playerNames[c];
f=b.gameConfig.playerNames[g];h=a.getPlayerColor(c);g=a.getPlayerColor(g);var n,q;q=new createjs.Container;n=new createjs.Shape;n.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()-a.scalePixel(65));n.alpha=0.15;q.addChild(n);a.stage.addChild(q);createjs.Tween.get(n,{override:!0}).to({alpha:0.5},600,createjs.Ease.sineIn);e(c,q);l("=) "+k+" wins!",h,30);l("='(  Sorry "+f,g,4030)});a.observer.subscribe("stopGame",function(){c=!0});return{}};dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.utility=dotBox.ai.utility||{};
(function(a){function b(a,b){return 3<=b.getLineStatesForBox(a).open.length}function l(a){var b=[],d,c;c=function(c){for(var d;d=c.next();)a.isLineConnected(d)||b.push(d)};d=e.hLineIterator(a.getDotCountLength(),a.getDotCountWidth());c(d);d=e.vLineIterator(a.getDotCountLength(),a.getDotCountWidth());c(d);return b}var g=dotBox.utility,e=dotBox.utility.iterators;a.findCloseableBoxes=function(a){var b=[],d,c=a.getBoxCount(),e;for(d=0;d<c;d++)a.isBoxScored(d)||(e=a.getLineStatesForBox(d),1===e.open.length&&
b.push({boxIndex:d,openLine:e.open[0]}));return b};a.boxHasThreeOrMoreOpen=b;a.getAllOpenLines=l;a.findNonThirdSideLines=function(a){var e,d,c,k,n=a.getDotCountLength(),m=a.getDotCountWidth(),r=[],v;d=l(a);v=function(c){return b(c,a)};for(e=0;e<d.length;e++)k=d[e],c=g.line.getBoxesFromLine(k,n,m),c.every(v)&&r.push(k);return r}})(dotBox.ai.utility);dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AiPlayer=function AiPlayer(b,l){if(!(this instanceof AiPlayer))return AiPlayer.apply(new AiPlayer,arguments);this.playerIndex=b;this.gameEngine=l};
dotBox.ai.AiPlayer.prototype=function(){var a=dotBox.utility;return{getRandomDot:function(){var b,l;b=a.getRandom(0,this.gameEngine.getDotCountLength()-1);l=a.getRandom(0,this.gameEngine.getDotCountWidth()-1);return{x:b,y:l}},getRandomOpenLine:function(){var b=null;if(this.gameEngine.isGameOver())return null;for(;null===b;)b=this.getRandomDot(),b=this.gameEngine.getOpenLinesForDot(b),null!==b&&0===b.length&&(b=null);return a.getRandomItem(b)},move:function(){return this.getRandomOpenLine()},makeMove:function(a){var l=
this;if(void 0===a)return this.move();setTimeout(function(){a(l.move())},10)}}}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AvoidThirdSide=function(){var a=dotBox.utility,b=dotBox.ai.utility,l;l=function e(a,b){if(!(this instanceof e))return e.apply(new e,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(l,dotBox.ai.AiPlayer);l.prototype.move=function(){var e;e=b.findNonThirdSideLines(this.gameEngine);return 0<e.length?e=a.getRandomItem(e):l.uber.move.apply(this)};return l}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.SingleBoxCloser=function(){var a=dotBox.utility,b;b=function g(a,b){if(!(this instanceof g))return g.apply(new g,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(b,dotBox.ai.AvoidThirdSide);b.prototype.move=function(){var g;g=dotBox.ai.utility.findCloseableBoxes(this.gameEngine);return 0<g.length?(g=a.getRandomItem(g),g.openLine):b.uber.move.apply(this)};return b}();dotBox=dotBox||{};
dotBox.controller=function(a,b){function l(c,l){var m,r,v,u;v=f.getCurrentPlayer();r={d1:c,d2:l};m=f.connectLine(r);u=0<m.boxesScored.length;d.selectedDot=null;d.hoveredDot=null;a.publish("view.lineConnected",r,u);m=m.boxesScored;var x;if(0<m.length){u=[];for(r=0;r<m.length;r++)x=m[r],u.push({box:x,lines:h.line.getLinesFromBox(x,f.getDotCountLength())});a.publish("view.boxesScored",u,v)}f.isGameOver()?a.publish("gameOver",g()):(m=f.getCurrentPlayer(),null!==m&&m!==v&&a.publish("views.playerTurnChanged"),!d.isQuickStarting&&
b.useAi&&1===m&&e(m))}function g(){var a,b=0,c=0,e;e=d.getCurrentScores();for(a=0;a<e.length;a++)e[a]>=c&&(c=e[a],b=a);return b}function e(b){a.publish("startRemoteTurn",b);c.makeMove(function(c){a.publish("endRemoteTurn",b,c)})}var h=dotBox.utility,f,d=null,c;f=dotBox.gameEngine({dotCountLength:b.dotColCount,dotCountWidth:b.dotRowCount});(function(){var a=[];h.isNullOrUndefined(b.playerNames)&&(b.playerNames=[]);1>b.playerNames.length||h.isNullOrUndefined(b.playerNames[0])||0===b.playerNames[0].length?
a.push("PLAYER 1"):a.push(b.playerNames[0]);2>b.playerNames.length||h.isNullOrUndefined(b.playerNames[1])||0===b.playerNames[1].length?b.useAi?a.push("HAL9000"):a.push("PLAYER 2"):a.push(b.playerNames[1]);b.playerNames=a})();b.useAi&&(c=new dotBox.ai.SingleBoxCloser(1,f));d=dotBox.model(f,b);a.subscribe("dotRollOver",function(b){f.hasAnyOpenLines(b)&&(d.hoveredDot=b,a.publish("view.dotRollOver",b))});a.subscribe("dotRollOut",function(b){d.hoveredDot=null;a.publish("view.dotRollOut",b)});a.subscribe("dotClick",
function(b){var c=d.selectedDot;if(!f.hasAnyOpenLines(b))return null;d.isSelectedDot(b)?(d.selectedDot=null,a.publish("view.dotSelectionChanged",c,null)):null!==d.selectedDot&&d.canConnectDots(b)?l(c,b):(d.selectedDot=b,a.publish("view.dotSelectionChanged",c,b))});return{startGame:function(){a.publish("startGame",d);if(!h.isNullOrUndefined(b.preMovePercent)){var c=b.preMovePercent,g,m;if(0>c||1<c)throw Error("percent must be between 0 and 1");if(0!==c){g=f.getTotalLineCount();g=Math.floor(g*c);0<
g&&(d.isQuickStarting=!0);for(var r=new dotBox.ai.AvoidThirdSide(-1,f),c=0;c<g;c++)m=r.move(),l(m.d1,m.d2);d.isQuickStarting=!1;c=f.getCurrentPlayer();b.useAi&&1===c&&e(f.getCurrentPlayer())}}},model:d}};dotBox=dotBox||{};
dotBox.game=function(a,b){var l,g,e=[],h,f;l=new Observer;g=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth);g=dotBox.views.viewContext(l,g,b.uiScale);h=dotBox.controller(l,b);f=h.model;e.push(dotBox.views.board(g,f));e.push(dotBox.views.score(g,f));e.push(dotBox.views.gameOver(g,f));g.initCanvasStage(function(a){if(a instanceof jQuery)return $(a[0]);"string"===typeof a&&0!==a.lastIndexOf("#",0)&&(a="#"+a);return $(a)}(a));h.startGame();return{stopGame:function(){l.publish("stopGame")}}};
(function(a){a.fn.dotBox=function(a){return dotBox.game(this,a)}})(jQuery); //@ sourceMappingURL=./dotBox-min.js.map
