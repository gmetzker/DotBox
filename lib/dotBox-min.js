var Observer=function(){function a(a){var b,d,e=0;if(c(a))return e-1;for(d=a.length,b=0;d>b;b++)a[b].priority<0&&a[b].priority<e&&(e=a[b].priority);return e-1}function b(a,b){return b.priority-a.priority}function c(a){return void 0===a?!0:null===a}var d;return d=function e(){return this instanceof e?void(this._channelSubscribers={}):new e},d.prototype.subscribe=function(d,e,f){var g,h=this._channelSubscribers[d];c(h)&&(h=[]),c(f)&&(f=a(h)),g={priority:f,callback:e},h.push(g),h=h.sort(b),this._channelSubscribers[d]=h},d.prototype.unsubscribe=function(a,b){var d,e=this._channelSubscribers[a];if(!c(e)){for(d=0;d<e.length;d++)if(e[d].callback===b){e.splice(d,1);break}0===e.length&&delete this._channelSubscribers[a]}},d.prototype.publish=function(a){var b,d,e,f=null;if(0===arguments.length||c(a))throw new Error("channelId argument required.");if(arguments.length>1&&(f=Array.prototype.slice.call(arguments,1)),e=this._channelSubscribers[a],d={channelId:a,cancel:!1},c(e))return!0;for(b=0;b<e.length;b++)if(e[b].callback.apply(d,f),d.cancel)return!1;return!0},d}(),dotBox=dotBox||{};dotBox.utility=dotBox.utility||{},function(a){function b(a){return void 0===a?!0:null===a}a.isNullOrUndefined=b,a.areSameDot=function(a,c){return b(a)&&b(c)?!0:b(a)!==b(c)?!1:a.x===c.x&&a.y===c.y},a.getRandom=function(a,b){return a+Math.floor(Math.random()*(b-a+1))},a.getRandomItem=function(b){var c;return c=a.getRandom(0,b.length-1),b[c]},a.inherit=function(){var a=function(){};return function(b,c){a.prototype=c.prototype,b.prototype=new a,b.uber=c.prototype,b.prototype.constructor=b}}(),a.isCanvasSupported=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}}(dotBox.utility);var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{},dotBox.utility.line=dotBox.utility.line||{},function(a){function b(a){return Math.abs(a.d1.x-a.d2.x)>0}function c(a,c,d){function e(){return h.y*f+h.x}var f=c-1,g=[],h={};return b(a)?(h.y=a.d1.y,h.x=Math.min(a.d1.x,a.d2.x),0===a.d1.y?g.push(e()):a.d1.y===d-1?(h.y-=1,g.push(e())):(g.push(e()),h.y-=1,g.push(e()))):(h.x=a.d1.x,h.y=Math.min(a.d1.y,a.d2.y),0===a.d1.x?g.push(e()):a.d1.x===c-1?(h.x-=1,g.push(e())):(g.push(e()),h.x-=1,g.push(e()))),g}function d(a,b){var c,d,e=b-1,f=[];return c=a%e,d=(a-c)/e,f.push({d1:{x:c,y:d},d2:{x:c+1,y:d}}),f.push({d1:{x:c+1,y:d},d2:{x:c+1,y:d+1}}),f.push({d1:{x:c,y:d+1},d2:{x:c+1,y:d+1}}),f.push({d1:{x:c,y:d},d2:{x:c,y:d+1}}),f}a.isHLine=b,a.getBoxesFromLine=c,a.getLinesFromBox=d}(dotBox.utility.line);var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{},dotBox.utility.iterators=dotBox.utility.iterators||{},function(a){a.hLineIterator=function(a,b){function c(){return i?!1:{d1:{x:g,y:h},d2:{x:g+1,y:h}}}function d(){return g===a-2}function e(){return h===b-1}function f(){return i?null:e()&&d()?(i=!0,null):(d()?(h+=1,g=0):g+=1,c())}var g=-1,h=0,i=!1;return{next:f,current:c}},a.vLineIterator=function(a,b){function c(){return i?!1:{d1:{x:g,y:h},d2:{x:g,y:h+1}}}function d(){return g===a-1}function e(){return h===b-2}function f(){return i?null:e()&&d()?(i=!0,null):(d()?(h+=1,g=0):g+=1,c())}var g=-1,h=0,i=!1;return{next:f,current:c}}}(dotBox.utility.iterators);var dotBox=dotBox||{};dotBox.boxState=function(a,b){function c(a,b){var c,d=(a-1)*(b-1);for(m=[],c=0;d>c;c++)m[c]=null}function d(){return m.length}function e(a){var b=d();if(0>a)throw new RangeError("boxIndex must be greater or equal to 0.");if(a>=b)throw new RangeError("boxIndex must be less than the box count ("+b+").")}function f(a){return e(a),null!==m[a]}function g(a){return!f(a)}function h(a){return e(a),m[a]}function i(a,b){e(a),m[a]=b}function j(){var a=function(a){return null!==a};return m.every(a)}function k(a){var b,c,e,g=[];for(b=0;a>b;b++)g[b]=0;for(c=d(),b=0;c>b;b++)f(b)&&(e=h(b),g[e]+=1);return g}function l(a){var b,c,e,f=[];for(c=d(),b=0;c>b;b++)e=h(b),e===a&&f.push(b);return f}var m;return c(a,b),{getBoxCount:d,areAllBoxesScored:j,isBoxScored:f,isBoxNotScored:g,whichPlayerScoredBox:h,scoreBox:i,getCurrentScores:k,getPlayerBoxes:l}};var dotBox=dotBox||{};dotBox.lineState=function(a,b){function c(a,b){var c,d,e;for(d=(a-1)*b,e=(b-1)*a,c=0;d>c;c++)o[c]=!1;for(c=0;e>c;c++)p[c]=!1}function d(b){var c,d,e,f;return n.line.isHLine(b)?(f=o,c=b.d1.y,d=Math.min(b.d1.x,b.d2.x),e=c*(a-1)+d):(f=p,c=Math.min(b.d1.y,b.d2.y),d=b.d1.x,e=c*a+d),{index:e,stateArray:f}}function e(a,b){var c,e;return g(a),c=d(a),n.isNullOrUndefined(b)||b&&(c.stateArray[c.index]=!0),e=c.stateArray[c.index]}function f(c,d){if(n.isNullOrUndefined(c))throw new Error(d+" is null or undefined.");if(c.x<0)throw new RangeError(d+".x must be > 0.");if(c.x>=a)throw new RangeError(d+".x must be < "+a);if(c.y<0)throw new RangeError(d+".y must be > 0.");if(c.y>=b)throw new RangeError(d+".y must be < "+b)}function g(a){var b,c;if(n.isNullOrUndefined(a))throw new Error("line is null or undefined");if(f(a.d1,"line.d1"),f(a.d2,"line.d2"),b=Math.abs(a.d1.x-a.d2.x),c=Math.abs(a.d1.y-a.d2.y),b>1)throw new RangeError("Move appears to be too long on x-axis.  Line must only connect adjacent points.");if(c>1)throw new RangeError("Move appears to be too long on y-axis.  Line must only connect adjacent points.");if(b+c>1)throw new RangeError("Movement appears to be diagonal this is not allowed.")}function h(b){var c,d;for(d=n.line.getLinesFromBox(b,a),c=0;4>c;c++)if(!e(d[c]))return!1;return!0}function i(c){var d,e,f=[];return d=function(){return{x:c.x,y:c.y}},e=function(a,b){f.push({d1:d(),d2:{x:a,y:b}})},c.y>0&&e(c.x,c.y-1),c.x<a-1&&e(c.x+1,c.y),c.y<b-1&&e(c.x,c.y+1),c.x>0&&e(c.x-1,c.y),f}function j(a){var b,c;return b=m.getAllLinesForDot(a),c=b.filter(function(a){return!m.connected(a)})}function k(){return p.length+o.length}function l(b){var c,d,e,f=[],g=[];for(c=dotBox.utility.line.getLinesFromBox(b,a),d=0;4>d;d++)e=c[d],m.connected(e)?g.push(e):f.push(e);return{open:f,closed:g}}var m,n=dotBox.utility,o=[],p=[];return m={connected:e,isBoxClosed:h,getAllLinesForDot:i,getOpenLinesForDot:j,getTotalLineCount:k,getLineStatesForBox:l},c(a,b),m};var dotBox=dotBox||{};dotBox.gameEngine=function(a){function b(a){if(a||(a={}),y=I.isNullOrUndefined(a.dotCountLength)?F:parseInt(a.dotCountLength,10),z=I.isNullOrUndefined(a.dotCountWidth)?G:parseInt(a.dotCountWidth,10),x=I.isNullOrUndefined(a.playerCount)?E:parseInt(a.playerCount,10),C=I.isNullOrUndefined(a.startPlayer)?H:parseInt(a.startPlayer,10),isNaN(y))throw new TypeError("dotCountLength is not a number.");if(isNaN(z))throw new TypeError("dotCountWidth is not a number.");if(isNaN(x))throw new TypeError("playerCount is not a number.");if(isNaN(C))throw new TypeError("startPlayer is not a number.");if(3>y)throw new RangeError("dotCountLength must be three or more");if(3>z)throw new RangeError("dotCountWidth must be three or more");if(2>x)throw new RangeError("playerCount must two or more");if(0>C||C>=x)throw new RangeError("startPlayer must be between 0 and playerCount-1");A=y-1,B=z-1,c(a)}function c(a){J=I.isNullOrUndefined(a.boxState)?dotBox.boxState(y,z):a.boxState,D=I.isNullOrUndefined(a.lineState)?dotBox.lineState(y,z):a.lineState}function d(){return x}function e(){return m()?null:C}function f(){return m()?null:(C===x-1?C=0:C+=1,C)}function g(){return y}function h(){return A}function i(){return z}function j(){return B}function k(){return h()*j()}function l(a){return D.connected(a)}function m(){return J.areAllBoxesScored()}function n(a){if(D.connected(a))throw new Error("This line is already connected.")}function o(a){var b,c,d,g={};if(m())throw new Error("Cannot make a move when the game is over.");return n(a),d=e(),D.connected(a,!0),b=I.line.getBoxesFromLine(a,y,z),c=b.filter(D.isBoxClosed).filter(J.isBoxNotScored),c.forEach(function(a){J.scoreBox(a,d)}),g.boxesScored=c,g.gameOver=m(),g.nextPlayer=0===g.boxesScored.length?f():e(),g}function p(){return J.getCurrentScores(x)}function q(a){if(void 0===a)throw new Error("dot argument was not supplied.");if(null===a)throw new Error("dot argument was null.");var b;return b=D.getOpenLinesForDot(a),b.length>0}function r(a,b){var c,d,e;if(I.isNullOrUndefined(a))throw new Error("dot1 argument was null or undefined.");if(I.isNullOrUndefined(b))throw new Error("dot2 argument was null or undefined.");for(d=D.getOpenLinesForDot(a),c=0;c<d.length;c++)if(e=d[c].d2,I.areSameDot(e,b))return!0;return!1}function s(){return J.getPlayerBoxes.apply(J,arguments)}function t(){return D.getOpenLinesForDot.apply(D,arguments)}function u(){return D.getTotalLineCount.apply(D,arguments)}function v(){return J.isBoxScored.apply(J,arguments)}function w(){return D.getLineStatesForBox.apply(D,arguments)}var x,y,z,A,B,C,D,E=2,F=10,G=10,H=0,I=dotBox.utility,J=null;return b(a),{getDotCountLength:g,getBoxCountLength:h,getDotCountWidth:i,getBoxCountWidth:j,getBoxCount:k,getPlayerCount:d,getCurrentPlayer:e,getCurrentScores:p,isLineConnected:l,connectLine:o,isGameOver:m,hasAnyOpenLines:q,canConnectDots:r,getPlayerBoxes:s,getOpenLinesForDot:t,getTotalLineCount:u,isBoxScored:v,getLineStatesForBox:w}};var dotBox=dotBox||{};dotBox.model=function(a,b){function c(){return createjs.Touch.isSupported()}function d(){return a.getDotCountLength()}function e(){return a.getDotCountWidth()}function f(a){return null!==m.selectedDot&&n.areSameDot(a,m.selectedDot)}function g(a){return null!==m.hoveredDot&&n.areSameDot(a,m.hoveredDot)}function h(b){return null!==m.selectedDot&&a.canConnectDots(m.selectedDot,b)}function i(b){return a.hasAnyOpenLines(b)}function j(){return a.getCurrentScores()}function k(){return a.getCurrentPlayer()}function l(){return a.getPlayerBoxes.apply(a,arguments)}var m,n=dotBox.utility,o=!1;return m={selectedDot:null,hoveredDot:null,isSelectedDot:f,isHoveredDot:g,getDotColCount:d,canConnectDots:h,getDotRowCount:e,hasAnyOpenLines:i,getCurrentScores:j,getCurrentPlayer:k,getPlayerBoxes:l,gameConfig:b,isQuickStarting:o,isTouchSupported:c}};var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.constants={P1_COLOR:"#A4E402",P2_COLOR:"#BF7AFF",PX_COLOR:"#5B5B5B",SCORE_TXT_COLOR:"#E7F8F2",BOARD_BACK_COLOR:"#272822",FONT:"'Open Sans', Helvetica, Arial, sans-serif"};var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.viewContext=function(a,b,c){function d(){if(null===o.stage)throw new Error("stage has not been initialized; call initCanvasStage first.");return o.stage.canvas.width}function e(){if(null===o.stage)throw new Error("stage has not been initialized; call initCanvasStage first.");return o.stage.canvas.height}function f(a){return a*b*c}function g(a){var d;for(d in a)a.hasOwnProperty(d)&&(a[d]=a[d]*b*c);return a}function h(a){var b=a.fillColor,c=a.strokeColor;dotBox.utility.isNullOrUndefined(b)||(this.fillStyle=b.toString()),dotBox.utility.isNullOrUndefined(c)||(this.strokeStyle=c.toString())}function i(a){r.isNullOrUndefined(a)||(r.isNullOrUndefined(a.height)||(p.height+=a.height),r.isNullOrUndefined(a.width)||(p.width+=a.width))}function j(){for(var a,b,c="dotBoxCanvas_",d=0,e=null;null===e;)a=c+d,b=$("#"+a),0===b.length&&(e=a),d+=1;return e}function k(a){var c,d,e,f;return c=j(),e=p.width*(1/b),f=p.height*(1/b),d='<canvas id="'+c+'" width='+p.width+" height="+p.height+' style="width: '+e+"px; height: "+f+'px;"></canvas>',a.append(d),c}function l(a){o.stage=new createjs.Stage(a)}function m(a){var b;b=k(a),l(b)}function n(a){switch(a){case 0:return dotBox.views.constants.P1_COLOR;case 1:return dotBox.views.constants.P2_COLOR;default:return dotBox.views.constants.PX_COLOR}}var o,p,q,r=dotBox.utility,s={};if(r.isNullOrUndefined(a))throw new Error("observer parameter is required.");if(r.isNullOrUndefined(b))throw new Error("pixelRatio is required.");return p={height:0,width:0},q=g({DOT_RADIUS:5,DOT_MARGIN:20,POINT_FONT_SIZE:13,SCORE_BOARD_HEIGHT:65}),a.subscribe("view.reserveCanvasSize",i),o={observer:a,pixelRatio:b,stage:null,boxShapes:s,pixelSizes:q,initCanvasStage:m,scalePixel:f,scaleAllPixelProps:g,setDrawColors:h,width:d,height:e,getPlayerColor:n}};var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.Color=function a(){function b(b){var c,d,e,f;return c=parseInt(b.slice(1,3),16),d=parseInt(b.slice(3,5),16),e=parseInt(b.slice(5,7),16),f=new a,f.red=c,f.green=d,f.blue=e,f}function c(b){var c,d,e,f,g,h;if(b=b.trim(),b=b.toLowerCase(),b=b.slice(5,b.length-1),b=b.trim(),h=b.split(","),4!==h.length)throw new Error("Could not parse rgba() color string.");return c=parseInt(h[0].trim(),10),d=parseInt(h[1].trim(),10),e=parseInt(h[2].trim(),10),f=parseFloat(h[3].trim()),g=new a,g.red=c,g.green=d,g.blue=e,g.alpha=f,g}function d(b){var c,d,e,f,g;if(b=b.trim(),b=b.toLowerCase(),b=b.slice(4,b.length-1),b=b.trim(),g=b.split(","),3!==g.length)throw new Error("Could not parse rgb() color string.");return c=parseInt(g[0].trim(),10),d=parseInt(g[1].trim(),10),e=parseInt(g[2].trim(),10),f=new a,f.red=c,f.green=d,f.blue=e,f}function e(b){var c,d,e,f,g;return d=Math.round(parseFloat(b[0])),e=Math.round(parseFloat(b[1])),f=Math.round(parseFloat(b[2])),g=parseFloat(b[3]),c=new a,c.red=d,c.green=e,c.blue=f,c.alpha=g,c}function f(b){var c,d,e,f;return d=Math.round(parseFloat(b[0])),e=Math.round(parseFloat(b[1])),f=Math.round(parseFloat(b[2])),c=new a,c.red=d,c.green=e,c.blue=f,c}function g(a){if(a=a.trim(),0===a.lastIndexOf("#",0)&&7===a.length)return b(a);if(0===a.lastIndexOf("rgba(",0))return c(a);if(0===a.lastIndexOf("rgb(",0))return d(a);throw new Error("Invalid arguments.")}var a;return a=function h(a){var b;if(!(this instanceof h))return h.apply(new h,arguments);if(this.red=255,this.blue=255,this.green=255,this.alpha=1,1===arguments.length)return b=a.toString(),g(b);if(4===arguments.length)return e(arguments);if(3===arguments.length)return f(arguments);if(0!==arguments.length)throw new Error(arguments.length+" number of arguments not supported.")},a.parseHexColorString=b,a.parseColorString=g,a.parseRgbaColorString=c,a.parseRgbColorString=d,a.prototype.toString=function(){var a,b,c;return a=Math.round(this.red),b=Math.round(this.green),c=Math.round(this.blue),"rgba("+[a,b,c,this.alpha].join()+")"},a.prototype.clone=function(){var b=new a;return b.red=this.red,b.green=this.green,b.blue=this.blue,b.alpha=this.alpha,b},a}();var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.board=function(a,b){function c(){var c,d,e;c={height:0,width:0},d=2*b.getDotColCount()*S.DOT_RADIUS,e=(b.getDotColCount()+1)*S.DOT_MARGIN,c.width=d+e,d=2*b.getDotRowCount()*S.DOT_RADIUS,e=(b.getDotRowCount()+1)*S.DOT_MARGIN,c.height=d+e,a.observer.publish("view.reserveCanvasSize",c)}function d(){a.observer.subscribe("startGame",e),a.observer.subscribe("view.dotRollOver",v),a.observer.subscribe("view.dotRollOut",w),a.observer.subscribe("view.dotSelectionChanged",x),a.observer.subscribe("view.lineConnected",y),a.observer.subscribe("view.boxesScored",B),a.observer.subscribe("startRemoteTurn",K),a.observer.subscribe("endRemoteTurn",L),a.observer.subscribe("stopGame",f)}function e(){i(),n()}function f(){createjs.Ticker.removeEventListener("tick",r),createjs.Touch.disable(a.stage),R&&(clearInterval(R),R=null)}function g(){var b;b=new createjs.Shape,b.graphics.beginFill(O.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()),b.on("click",h),a.stage.addChild(b)}function h(){var a=J(2.5*S.DOT_RADIUS);a&&!_&&m(a)}function i(){var c,d,e,f,h=b.getDotRowCount(),i=b.getDotColCount();for(g(),Q=[],d=0;h>d;d++)for(c=0;i>c;c++)0===c&&(f=[],Q.push(f)),e=new createjs.Shape,e.dot={x:c,y:d},t(e),e.x=c*(S.DOT_MARGIN+2*S.DOT_RADIUS)+(S.DOT_MARGIN+S.DOT_RADIUS),e.y=d*(S.DOT_MARGIN+2*S.DOT_RADIUS)+(S.DOT_MARGIN+S.DOT_RADIUS),e.on("click",l),f.push(e),a.stage.addChild(e);a.stage.update()}function j(b){M.isNullOrUndefined(b)||a.observer.publish("dotRollOver",b)}function k(b){M.isNullOrUndefined(b)||a.observer.publish("dotRollOut",b)}function l(){_||m(this.dot)}function m(b){a.observer.publish("dotClick",b)}function n(){b.isTouchSupported()||o(20),createjs.Ticker.addEventListener("tick",r),createjs.Ticker.setFPS(30),createjs.Touch.enable(a.stage,!0)}function o(a){if(R&&(clearInterval(R),R=null),null===a)a=20;else if(0>=a)return;R=setInterval(p,1e3/Math.min(50,a))}function p(){var a=$,c=J(2.5*S.DOT_RADIUS);M.areSameDot(a,c)||(_||q(!M.isNullOrUndefined(c)&&b.hasAnyOpenLines(c)?"pointer":""),$=c,_||(k(a),j(c)))}function q(b){a.stage.canvas.style.cursor=b}function r(){createjs.Tween.hasActiveTweens()&&a.stage.update()}function s(a){var c,d;return c=b.isSelectedDot(a)?V:b.isHoveredDot(a)&&b.canConnectDots(a)?W:b.isHoveredDot(a)?U:T,d=new P(c)}function t(b){var c,d,e;return b instanceof createjs.Shape?(c=b,b=c.dot,e=!0):(c=u(b),e=!1),d=s(b),e?(c.fillColor=d,c.graphics.beginFill(d).inject(a.setDrawColors,c).drawCircle(0,0,S.DOT_RADIUS).endFill()):createjs.Tween.get(c.fillColor,{override:!0}).to(d,250),c}function u(a){return Q[a.y][a.x]}function v(a){var b=t(a);createjs.Tween.get(b,{override:!0}).to({scaleX:2,scaleY:2},150)}function w(a){var b=t(a);createjs.Tween.get(b,{override:!0}).to({scaleX:1,scaleY:1},150)}function x(a,b){var c;null!==a&&t(a),null!==b&&t(b),a!==b&&(c=u(null!==b?b:a),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150).call(function(){var a=J(S.DOT_RADIUS);M.isNullOrUndefined(a)&&q("")}))}function y(a,b){var c;t(a.d1),c=t(a.d2),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150),z(a,X,b)}function z(c,d,e){var f,g,h,i=u(c.d1),j=u(c.d2),k=!1,l=a.scalePixel(1),m=null;f=F(c),M.isNullOrUndefined(f)?(f=new createjs.Shape,E(c,f),k=!0):f.graphics.clear(),f.graphics.setStrokeStyle(l).beginStroke(d).moveTo(i.x,i.y).lineTo(j.x,j.y),h=b.isQuickStarting,k&&(g=.1,N.isHLine(c)?(f.scaleX=g,f.x=i.x-i.x*g,m={scaleX:1,x:0}):(f.scaleY=g,f.y=i.y-i.y*g,m={scaleY:1,y:0}),f.on("click",A),a.stage.addChild(f),createjs.Tween.get(f,{override:!0}).to(m,300).call(function(){var b;h||e||(b=new createjs.Shape,b.graphics.setStrokeStyle(a.scalePixel(1)).beginStroke(X).drawCircle(0,0,a.pixelSizes.DOT_RADIUS),b.x=j.x,b.y=j.y,b.scaleX=0,b.scaleY=0,a.stage.addChild(b),createjs.Tween.get(b).to({scaleX:1.5,scaleY:1.5},150).to({scaleX:5,scaleY:5,alpha:0},1e3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(b)}))}))}function A(b){var c,d,e;c=a.stage.getObjectsUnderPoint(b.stageX,b.stageY),e=function(a){return!M.isNullOrUndefined(a.dot)},d=c.filter(e),d.length>0&&l.apply(d[0])}function B(a,b){var c;for(c=0;c<a.length;c++)C(a[c],b);D(a[0],a.length)}function C(b,c){var d,e,f,g,h,i,j,k,l=a.scalePixel(10),m=a.scalePixel(1);j=a.getPlayerColor(c),i=new P(j),i.alpha=.33,i=i.toString(),e=u(b.lines[0].d1),f=u(b.lines[1].d2),g=f.x-e.x,h=f.y-e.y,d=new createjs.Shape,d.graphics.setStrokeStyle(m).beginStroke(j).beginFill(i).drawRect(e.x,e.y,g,h),k=(g+l)/g,d.scaleX=k,d.scaleY=k,d.x=-1*(e.x*k-e.x)-l/2,d.y=-1*(e.y*k-e.y)-l/2,d.upperLeft={x:e.x,y:e.y},d.alpha=0,d.on("click",A),a.stage.addChild(d),a.boxShapes[b.box]=d,createjs.Tween.get(d,{override:!0}).wait(350).to({alpha:1},0).to({x:0,y:0,scaleX:1,scaleY:1},350)}function D(c,d){var e,f,g,h,i;b.isQuickStarting||(h=u(c.lines[0].d1),i=u(c.lines[0].d2),e=h.x+(i.x-h.x)/2,h=u(c.lines[1].d1),i=u(c.lines[1].d2),f=h.y+(i.y-h.y)/2,g=new createjs.Text("+"+d,S.POINT_FONT_SIZE+"px "+O.FONT,O.SCORE_TXT_COLOR),g.x=e,g.y=f,g.textAlign="center",g.textBaseline="middle",g.alpha=0,a.stage.addChild(g),createjs.Tween.get(g,{override:!1}).wait(550).to({alpha:1},0).to({alpha:0,y:a.height()+a.scalePixel(50)},3e3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(g)}),createjs.Tween.get(g,{override:!1}).wait(550).to({scaleX:1.5,scaleY:1.5},200,createjs.Ease.elasticInOut))}function E(a,b){var c,d;c=G(a),d=c.store[c.y],M.isNullOrUndefined(d)&&(d={},c.store[c.y]=d),d[c.x]=b}function F(a){var b,c,d;return b=G(a),b.store.hasOwnProperty(b.y)?(c=b.store[b.y],c.hasOwnProperty(b.x)?d=c[b.x]:null):null}function G(a){var b,c,d;return M.line.isHLine(a)?(d=Y,c=a.d1.y,b=Math.min(a.d1.x,a.d2.x)):(d=Z,c=Math.min(a.d1.y,a.d2.y),b=a.d1.x),{x:b,y:c,store:d}}function H(a,b){var c,d;return d=2*S.DOT_RADIUS+S.DOT_MARGIN,c=Math.floor((a-S.DOT_MARGIN/2)/d),0>c||c>=b?null:c}function I(a,b,c){var d,e;return d=Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2),e=Math.pow(c,2),e>=d}function J(c){var d,e,f,g,h;return h={x:a.stage.mouseX,y:a.stage.mouseY},a.stage.mouseInBounds?(d=H(h.x,b.getDotColCount()),null===d?null:(e=H(h.y,b.getDotRowCount()),null===e?null:(f={x:d,y:e},g=u(f),I(h,{x:g.x,y:g.y},c)||(f=null),f))):null}function K(){q("wait"),_=!0}function L(a,b){var c=150,d=M.getRandom(700,1250),e=M.getRandom(c+20,750),f=M.getRandom(500,750),g=M.getRandom(Math.floor(c/2),750);setTimeout(function(){j(b.d1),setTimeout(function(){m(b.d1),k(b.d1),setTimeout(function(){j(b.d2),setTimeout(function(){_=!1,q(null),m(b.d2),k(b.d2)},g)},f)},e)},d)}var M=dotBox.utility,N=dotBox.utility.line,O=dotBox.views.constants,P=dotBox.views.Color;if(M.isNullOrUndefined(a))throw new Error("viewContext is null or undefined.");if(M.isNullOrUndefined(b))throw new Error("model is null or undefined.");var Q,R,S=a.pixelSizes,T="#53d2f1",U="#89E0F5",V="#fc1f70",W="#E20355",X="white",Y={},Z={},$=null,_=!1;return c(),d(),{}};var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.score=function(a,b){function c(){a.observer.publish("view.reserveCanvasSize",{height:I})}function d(){a.observer.subscribe("startGame",e),a.observer.subscribe("gameOver",o),a.observer.subscribe("view.boxesScored",f),a.observer.subscribe("views.playerTurnChanged",g)}function e(){h()}function f(){var a,c;for(c=b.getCurrentScores(),a=0;a<c.length;a++)t[a].text=c[a]}function g(){k()}function h(){var c,d,e,f=a.scalePixel(10),g=a.scalePixel(5),h=I-2*g;d=a.height()-I,e=d+g+1,t=[],u=[],v=[],w=[],i(d),c=j(b.gameConfig.playerNames[0],h),c.x=f,c.y=e,a.stage.addChild(c),c=j(b.gameConfig.playerNames[1],h),c.x=a.width()-f-H.SCORE_BOX_W,c.y=e,a.stage.addChild(c),k()}function i(b){var c,d=a.scalePixel(1),e=a.height(),f=a.width();c=new createjs.Shape,c.graphics.beginLinearGradientFill([x,y],[0,1],0,b,0,e).drawRect(0,b,f,e).endFill(),c.graphics.setStrokeStyle(d).beginStroke(A).moveTo(0,b).lineTo(f,b).endStroke(),c.graphics.setStrokeStyle(d).beginStroke(z).moveTo(0,b+d).lineTo(f,b+d).endStroke(),a.stage.addChild(c)}function j(b,c){var d,e=new createjs.Container,f=a.scalePixel(1),g=a.scalePixel(2),h=a.scalePixel(9),i=a.scalePixel(6),j=a.scalePixel(13);return d=new createjs.Shape,d.graphics.setStrokeStyle(f).beginStroke(C).beginFill(B).drawRoundRect(0,0,H.SCORE_BOX_W,c,g),e.addChild(d),d=new createjs.Text("0",H.SCORE_FONT_SIZE+"px "+q.FONT,q.SCORE_TXT_COLOR),d.x=H.SCORE_BOX_W/2,d.y=i+c/2,d.textAlign="center",d.textBaseline="middle",e.addChild(d),t.push(d),d=new createjs.Shape,d.graphics.setStrokeStyle(f).beginFill(E).beginStroke(F).arc(H.SCORE_BOX_W/2,c+j,H.SCORE_BOX_W/4,Math.PI+.25*Math.PI,1.75*Math.PI),d.alpha=0,u.push(d),e.addChild(d),d=new createjs.Shape,n(d,c),e.addChild(d),v.push(d),d=new createjs.Text(b,H.P_NAME_FONT_SIZE+"px "+q.FONT,q.SCORE_TXT_COLOR),d.x=H.SCORE_BOX_W/2,d.y=h,d.textAlign="center",d.textBaseline="middle",w.push(d),e.addChild(d),e}function k(){l(b.getCurrentPlayer())}function l(a){var b,c,d,e,f,g;for(b=0;b<u.length;b++)c=u[b],b===a?(createjs.Tween.get(c,{override:!0}).to({alpha:1},250,createjs.Ease.sineIn),d=q.SCORE_TXT_COLOR):(createjs.Tween.get(c,{override:!0}).to({alpha:0},250,createjs.Ease.sineOut),d=D),g=v[b],e=m("fill",b,a),f=m("stroke",b,a),createjs.Tween.get(g.fillColor,{override:!0}).to(e,200),createjs.Tween.get(g.strokeColor,{override:!0}).to(f,200),w[b].color=d}function m(a,b,c){var d,e=b===c;return e?(d=new r(0===b?q.P1_COLOR:q.P2_COLOR),"fill"===a&&(d.alpha=.33)):d=new r(G),d}function n(b,c){var d=Math.round(.3*c),e=a.scalePixel(2),f=a.scalePixel(2);b.fillColor=new r(G),b.strokeColor=new r(G),b.graphics.setStrokeStyle(e).beginStroke(G).beginFill(G).inject(a.setDrawColors,b).drawRoundRect(0,0,H.SCORE_BOX_W,d,f).endFill()}function o(a){l(a)}var p=dotBox.utility,q=dotBox.views.constants,r=dotBox.views.Color,s={},t=[],u=[],v=[],w=[],x="#5b5b5b",y="#545454",z="#7d7d7d",A="#323232",B="#272822",C="#3b3d38",D="#a69b9d",E="#fc1f70",F="#E20355",G="#40403d",H=a.scaleAllPixelProps({SCORE_BOX_W:75,SCORE_FONT_SIZE:25,P_NAME_FONT_SIZE:10}),I=a.pixelSizes.SCORE_BOARD_HEIGHT;if(p.isNullOrUndefined(a))throw new Error("viewContext is null or undefined.");if(p.isNullOrUndefined(b))throw new Error("model is null or undefined.");return c(),d(),s};var dotBox=dotBox||{};dotBox.views=dotBox.views||{},dotBox.views.gameOver=function(a,b){function c(c){var d,g,i,j,k,l;k=0===c?1:0,d=b.gameConfig.playerNames[c],g=b.gameConfig.playerNames[k],i=a.getPlayerColor(c),j=a.getPlayerColor(k),l=e(),h(c,l),f("=) "+d+" wins!",i,30),f("='(  Sorry "+g,j,4030)}function d(){m=!0}function e(){var b,c;return c=new createjs.Container,b=new createjs.Shape,b.graphics.beginFill(k.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()-a.scalePixel(65)),b.alpha=.15,c.addChild(b),a.stage.addChild(c),createjs.Tween.get(b,{override:!0}).to({alpha:.5},600,createjs.Ease.sineIn),c}function f(b,c,d){var e,f,g,h,i,l,m,p,q,r,s,t=a.scalePixel(10),u=a.scalePixel(2);e=new createjs.Container,g=a.height()-o.SCORE_BOARD_HEIGHT,h=a.width(),f=new createjs.Text(b,n+"px "+k.FONT,k.SCORE_TXT_COLOR),f.textAlign="center",f.textBaseline="middle",i=f.getBounds(),p=i.height+2*t+2*u,q=i.width+2*t+2*u,l=new createjs.Shape,l.graphics.beginFill(k.BOARD_BACK_COLOR).drawRect(0,0,q,p),e.addChild(l),m=new j(c),m.alpha=.2,l=new createjs.Shape,l.graphics.setStrokeStyle(u).beginStroke(c).beginFill(m.toString()).drawRect(0,0,q,p),e.addChild(l),f.x=q/2,f.y=p/2,e.addChild(f),e.x=h/2,e.y=g/2,r=(h-q)/2,s=(g-p)/2,e.alpha=0,e.scaleX=0,e.scaleY=0,a.stage.addChild(e),createjs.Tween.get(e,{override:!0}).wait(d).to({alpha:1,scaleX:1,scaleY:1,x:r,y:s},1e3,createjs.Ease.quadIn).wait(2500).to({x:h+q/2},500,createjs.Ease.quadOut).call(function(){a.stage.removeChild(e)})}function g(b,c,d){var e,f,g,h,i=a.scalePixel(1);return h=a.boxShapes[b],g=a.getPlayerColor(c),f=new j(g),f.alpha=.33,f=f.toString(),e=new createjs.Shape,e.graphics.setStrokeStyle(i).beginStroke(g).beginFill(f).drawRect(h.upperLeft.x,h.upperLeft.y,d,d),e.upperLeft={x:h.upperLeft.x,y:h.upperLeft.y},e}function h(c,d){var e,f,j,k,l={},n={};m||(e=b.getPlayerBoxes(c),0!==e.length&&(k=2*o.DOT_RADIUS+o.DOT_MARGIN,j=e[i.getRandom(0,e.length-1)],f=g(j,c,k),l.sizeDiff=a.scalePixel(15),l.scale=(k+l.sizeDiff)/k,l.x=-1*(f.upperLeft.x*l.scale-f.upperLeft.x)-l.sizeDiff/2,l.y=-1*(f.upperLeft.y*l.scale-f.upperLeft.y)-l.sizeDiff/2,n.sizeDiff=a.scalePixel(45),n.scale=(k+n.sizeDiff)/k,n.x=-1*(f.upperLeft.x*n.scale-f.upperLeft.x)-n.sizeDiff/2,n.y=-1*(f.upperLeft.y*n.scale-f.upperLeft.y)-n.sizeDiff/2,f.alpha=0,d.addChild(f),createjs.Tween.get(f,{override:!1}).wait(1e3).to({alpha:.5},0).to({alpha:1,scaleX:l.scale,scaleY:l.scale,x:l.x,y:l.y},500).to({alpha:0,scaleX:n.scale,scaleY:n.scale,x:n.x,y:n.y},1500,createjs.Ease.sineOut).call(function(){d.removeChild(f),h(c,d)})))}var i=dotBox.utility,j=dotBox.views.Color,k=dotBox.views.constants,l={},m=!1,n=a.scalePixel(18),o=a.pixelSizes;if(i.isNullOrUndefined(a))throw new Error("viewContext is null or undefined.");if(i.isNullOrUndefined(b))throw new Error("model is null or undefined.");return a.observer.subscribe("gameOver",c),a.observer.subscribe("stopGame",d),l};var dotBox=dotBox||{};dotBox.ai=dotBox.ai||{},dotBox.ai.utility=dotBox.ai.utility||{},function(a){function b(a){var b,c,d=[],e=a.getBoxCount();for(b=0;e>b;b++)a.isBoxScored(b)||(c=a.getLineStatesForBox(b),1===c.open.length&&d.push({boxIndex:b,openLine:c.open[0]}));return d}function c(a,b){var c;return c=b.getLineStatesForBox(a),c.open.length>=3}function d(a){var b,c,d=[];return c=function(b){for(var c;c=b.next();)a.isLineConnected(c)||d.push(c)},b=g.hLineIterator(a.getDotCountLength(),a.getDotCountWidth()),c(b),b=g.vLineIterator(a.getDotCountLength(),a.getDotCountWidth()),c(b),d}function e(a){var b,e,g,h,i,j=a.getDotCountLength(),k=a.getDotCountWidth(),l=[];for(e=d(a),i=function(b){return c(b,a)},b=0;b<e.length;b++)h=e[b],g=f.line.getBoxesFromLine(h,j,k),g.every(i)&&l.push(h);return l}var f=dotBox.utility,g=dotBox.utility.iterators;a.findCloseableBoxes=b,a.boxHasThreeOrMoreOpen=c,a.getAllOpenLines=d,a.findNonThirdSideLines=e}(dotBox.ai.utility);var dotBox=dotBox||{};dotBox.ai=dotBox.ai||{},dotBox.ai.AiPlayer=function b(a,c){return this instanceof b?(this.playerIndex=a,void(this.gameEngine=c)):b.apply(new b,arguments)},dotBox.ai.AiPlayer.prototype=function(){function a(){var a,b;return a=e.getRandom(0,this.gameEngine.getDotCountLength()-1),b=e.getRandom(0,this.gameEngine.getDotCountWidth()-1),{x:a,y:b}}function b(){var a,b,c=null;if(this.gameEngine.isGameOver())return null;for(;null===c;)b=this.getRandomDot(),c=this.gameEngine.getOpenLinesForDot(b),null!==c&&0===c.length&&(c=null);return a=e.getRandomItem(c)}function c(){var a;return a=this.getRandomOpenLine()}function d(a){var b=this;return void 0===a?this.move():void setTimeout(function(){a(b.move())},10)}var e=dotBox.utility;return{getRandomDot:a,getRandomOpenLine:b,move:c,makeMove:d}}();var dotBox=dotBox||{};dotBox.ai=dotBox.ai||{},dotBox.ai.AvoidThirdSide=function(){var a,b=dotBox.utility,c=dotBox.ai.utility;return a=function d(a,b){return this instanceof d?(this.playerIndex=a,void(this.gameEngine=b)):d.apply(new d,arguments)},b.inherit(a,dotBox.ai.AiPlayer),a.prototype.move=function(){var d,e;return d=c.findNonThirdSideLines(this.gameEngine),d.length>0?e=b.getRandomItem(d):a.uber.move.apply(this)},a}();var dotBox=dotBox||{};dotBox.ai=dotBox.ai||{},dotBox.ai.SingleBoxCloser=function(){var a,b=dotBox.utility;return a=function c(a,b){return this instanceof c?(this.playerIndex=a,void(this.gameEngine=b)):c.apply(new c,arguments)},b.inherit(a,dotBox.ai.AvoidThirdSide),a.prototype.move=function(){var c,d;return c=dotBox.ai.utility.findCloseableBoxes(this.gameEngine),c.length>0?(d=b.getRandomItem(c),d.openLine):a.uber.move.apply(this)},a}();var dotBox=dotBox||{};dotBox.controller=function(a,b){function c(){q=dotBox.gameEngine({dotCountLength:b.dotColCount,dotCountWidth:b.dotRowCount}),m(),b.useAi&&(r=new dotBox.ai.SingleBoxCloser(1,q)),t=dotBox.model(q,b),e()}function d(){a.publish("startGame",t),s.isNullOrUndefined(b.preMovePercent)||l(b.preMovePercent)}function e(){a.subscribe("dotRollOver",f),a.subscribe("dotRollOut",g),a.subscribe("dotClick",i)}function f(b){q.hasAnyOpenLines(b)&&(t.hoveredDot=b,a.publish("view.dotRollOver",b))}function g(b){t.hoveredDot=null,a.publish("view.dotRollOut",b)}function h(b,c){var d,e,f,g,h;f=q.getCurrentPlayer(),e={d1:b,d2:c},d=q.connectLine(e),h=d.boxesScored.length>0,t.selectedDot=null,t.hoveredDot=null,a.publish("view.lineConnected",e,h),k(d.boxesScored,f),q.isGameOver()?a.publish("gameOver",j()):(g=q.getCurrentPlayer(),null!==g&&g!==f&&a.publish("views.playerTurnChanged"),!t.isQuickStarting&&n(g)&&o(g))}function i(b){var c=t.selectedDot;return q.hasAnyOpenLines(b)?void(t.isSelectedDot(b)?(t.selectedDot=null,a.publish("view.dotSelectionChanged",c,null)):null!==t.selectedDot&&t.canConnectDots(b)?h(c,b):(t.selectedDot=b,a.publish("view.dotSelectionChanged",c,b))):null}function j(){var a,b,c=0,d=0;for(b=t.getCurrentScores(),a=0;a<b.length;a++)b[a]>=d&&(d=b[a],c=a);return c}function k(b,c){var d,e,f;if(b.length>0){for(e=[],d=0;d<b.length;d++)f=b[d],e.push({box:f,lines:s.line.getLinesFromBox(f,q.getDotCountLength())});a.publish("view.boxesScored",e,c)}}function l(a){var b,c,d,e;if(0>a||a>1)throw new Error("percent must be between 0 and 1");if(0!==a){c=q.getTotalLineCount(),d=Math.floor(c*a),d>0&&(t.isQuickStarting=!0);var f=new dotBox.ai.AvoidThirdSide(-1,q);for(b=0;d>b;b++)e=f.move(),h(e.d1,e.d2);t.isQuickStarting=!1,n(q.getCurrentPlayer())&&o(q.getCurrentPlayer())}}function m(){var a=[];s.isNullOrUndefined(b.playerNames)&&(b.playerNames=[]),a.push(b.playerNames.length<1||s.isNullOrUndefined(b.playerNames[0])||0===b.playerNames[0].length?"PLAYER 1":b.playerNames[0]),a.push(b.playerNames.length<2||s.isNullOrUndefined(b.playerNames[1])||0===b.playerNames[1].length?b.useAi?"HAL9000":"PLAYER 2":b.playerNames[1]),b.playerNames=a}function n(a){return b.useAi?1===a:!1}function o(b){a.publish("startRemoteTurn",b),r.makeMove(function(c){a.publish("endRemoteTurn",b,c)
})}var p,q,r,s=dotBox.utility,t=null;return c(),p={startGame:d,model:t}};var dotBox=dotBox||{};dotBox.game=function(a,b){function c(a){return a instanceof jQuery?$(a[0]):("string"==typeof a&&0!==a.lastIndexOf("#",0)&&(a="#"+a),$(a))}function d(){e.publish("stopGame")}var e,f,g,h,i,j,k=[];return e=new Observer,i=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth),f=dotBox.views.viewContext(e,i,b.uiScale),g=dotBox.controller(e,b),h=g.model,k.push(dotBox.views.board(f,h)),k.push(dotBox.views.score(f,h)),k.push(dotBox.views.gameOver(f,h)),f.initCanvasStage(c(a)),g.startGame(),j={stopGame:d}},function(a){a.fn.dotBox=function(a){return dotBox.game(this,a)}}(jQuery);var dotBox=dotBox||{};dotBox.viewModel=function(){function a(a){return void 0===a||null===a?!1:0===a.length||a.length>10?!1:!0}var b={playerMode:ko.observable("pvc"),playerName1:ko.observable("PLAYER 1"),playerName2Custom:ko.observable("PLAYER 2"),dotCols:ko.observable(6),dotRows:ko.observable(6),quickGame:ko.observable(!0),fillPercentCustom:ko.observable(30),uiScale:ko.observable(1.5),game:null};return b.useAi=ko.computed(function(){return"pvc"===b.playerMode()}),b.playerName2=ko.computed({read:function(){return b.useAi()?"HAL9000":b.playerName2Custom()},write:function(a){b.useAi()||b.playerName2Custom(a)}}),b.fillPercent=ko.computed({read:function(){return b.quickGame()?b.fillPercentCustom():0},write:function(a){b.quickGame()&&b.fillPercentCustom(a)}}),b.toGameConfig=function(){var a={dotColCount:b.dotCols(),dotRowCount:b.dotRows(),useAi:b.useAi(),preMovePercent:b.fillPercent()/100,playerNames:[b.playerName1(),b.playerName2()],uiScale:b.uiScale()};return a},b.newGame=function(){if(!b.isValid())return $("#globalError").removeClass("hidden"),!1;$("#globalError").addClass("hidden");var a=$("#canvasContainer"),c=b.toGameConfig();return null!==b.game&&b.game.stopGame(),a.empty(),b.game=a.dotBox(c),!0},b.isP1NameValid=ko.computed(function(){return a(b.playerName1())}),b.isP2NameValid=ko.computed(function(){return a(b.playerName2())}),b.isDotColsValid=ko.computed(function(){return b.dotCols()<6||b.dotCols()>20?!1:!0}),b.isDotRowsValid=ko.computed(function(){return b.dotRows()<3||b.dotRows()>20?!1:!0}),b.isFillPercentValid=ko.computed(function(){return b.fillPercentCustom()<1||b.fillPercentCustom()>100?!1:!0}),b.isValid=ko.computed(function(){return b.isP1NameValid()?b.isP2NameValid()?b.isDotColsValid()?b.isDotRowsValid()?b.isFillPercentValid()?!0:!1:!1:!1:!1:!1}),b}();var dotBox=dotBox||{};dotBox.ko=dotBox.ko||{},dotBox.ko.addCustomBindings=function(){ko.bindingHandlers.slider={init:function(a,b,c){var d=c().sliderOptions||{};$(a).slider(d),ko.utils.registerEventHandler(a,"slidechange",function(a,c){var d=b();d(c.value)}),ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")}),ko.utils.registerEventHandler(a,"slide",function(a,c){var d=b();d(c.value)})},update:function(a,b){var c=ko.utils.unwrapObservable(b());isNaN(c)&&(c=0),$(a).slider("value",c)}}},$(document).ready(function(){return $(".alert .close").on("click",function(){$(this).parent().addClass("hidden")}),dotBox.utility.isCanvasSupported()?($("#newGameBtn").on("click",function(){dotBox.viewModel.newGame()&&$("html, body").animate({scrollTop:$("#canvasContainer").offset().top-50},300)}),dotBox.ko.addCustomBindings(),dotBox.viewModel.dotCols($(window).width()>510?10:6),ko.applyBindings(dotBox.viewModel),void dotBox.viewModel.newGame()):($("#canvasContainer").addClass("hidden"),$("#mainContainer").addClass("hidden"),void $("#failContainer").removeClass("hidden"))});
//# sourceMappingURL=dotBox-min.map