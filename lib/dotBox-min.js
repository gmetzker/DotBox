var Observer=function(){function a(a,b){return b.priority-a.priority}function b(a){return void 0===a?!0:null===a}var g;g=function h(){if(!(this instanceof h))return new h;this._channelSubscribers={}};g.prototype.subscribe=function(h,e,f){var d=this._channelSubscribers[h];b(d)&&(d=[]);if(b(f)){f=d;var c,k,m=0;if(!b(f))for(k=f.length,c=0;c<k;c++)0>f[c].priority&&f[c].priority<m&&(m=f[c].priority);f=m-1}d.push({priority:f,callback:e});d=d.sort(a);this._channelSubscribers[h]=d};g.prototype.unsubscribe=
function(a,e){var f,d=this._channelSubscribers[a];if(!b(d)){for(f=0;f<d.length;f++)if(d[f].callback===e){d.splice(f,1);break}0===d.length&&delete this._channelSubscribers[a]}};g.prototype.publish=function(a,e,f,d){var c,k,m,g=null;if(0===arguments.length||b(a))throw Error("channelId argument required.");1<arguments.length&&(g=Array.prototype.slice.call(arguments,1));m=this._channelSubscribers[a];k={channelId:a,cancel:!1};if(b(m))return!0;for(c=0;c<m.length;c++)if(m[c].callback.apply(k,g),k.cancel)return!1;
return!0};return g}();var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};
(function(a){function b(a){return void 0===a?!0:null===a}a.isNullOrUndefined=b;a.areSameDot=function(a,l){return b(a)&&b(l)?!0:b(a)!==b(l)?!1:a.x===l.x&&a.y===l.y};a.getRandom=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};a.getRandomItem=function(b){var l;l=a.getRandom(0,b.length-1);return b[l]};a.inherit=function(){var a=function(){};return function(b,h){a.prototype=h.prototype;b.prototype=new a;b.uber=h.prototype;b.prototype.constructor=b}}()})(dotBox.utility);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.line=dotBox.utility.line||{};
(function(a){function b(a){return 0<Math.abs(a.d1.x-a.d2.x)}a.isHLine=b;a.getBoxesFromLine=function(a,l,h){var e=l-1,f=[],d,c;b(a)?(d=a.d1.y,c=Math.min(a.d1.x,a.d2.x),0!==a.d1.y&&(a.d1.y!==h-1&&f.push(d*e+c),d-=1)):(c=a.d1.x,d=Math.min(a.d1.y,a.d2.y),0!==a.d1.x&&(a.d1.x!==l-1&&f.push(d*e+c),c-=1));f.push(d*e+c);return f};a.getLinesFromBox=function(a,b){var h=b-1,e=[],f;f=a%h;h=(a-f)/h;e.push({d1:{x:f,y:h},d2:{x:f+1,y:h}});e.push({d1:{x:f+1,y:h},d2:{x:f+1,y:h+1}});e.push({d1:{x:f,y:h+1},d2:{x:f+1,
y:h+1}});e.push({d1:{x:f,y:h},d2:{x:f,y:h+1}});return e}})(dotBox.utility.line);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.iterators=dotBox.utility.iterators||{};
(function(a){a.hLineIterator=function(a,g){function l(){return f?!1:{d1:{x:h,y:e},d2:{x:h+1,y:e}}}var h=-1,e=0,f=!1;return{next:function(){if(f)return null;if(e===g-1&&h===a-2)return f=!0,null;h===a-2?(e+=1,h=0):h+=1;return l()},current:l}};a.vLineIterator=function(a,g){function l(){return f?!1:{d1:{x:h,y:e},d2:{x:h,y:e+1}}}var h=-1,e=0,f=!1;return{next:function(){if(f)return null;if(e===g-2&&h===a-1)return f=!0,null;h===a-1?(e+=1,h=0):h+=1;return l()},current:l}}})(dotBox.utility.iterators);dotBox=dotBox||{};
dotBox.boxState=function(a,b){function g(){return f.length}function l(a){var c=g();if(0>a)throw new RangeError("boxIndex must be greater or equal to 0.");if(a>=c)throw new RangeError("boxIndex must be less than the box count ("+c+").");}function h(a){l(a);return null!==f[a]}function e(a){l(a);return f[a]}var f;(function(a,c){var k,b=(a-1)*(c-1);f=[];for(k=0;k<b;k++)f[k]=null})(a,b);return{getBoxCount:g,areAllBoxesScored:function(){return f.every(function(a){return null!==a})},isBoxScored:h,isBoxNotScored:function(a){return!h(a)},
whichPlayerScoredBox:e,scoreBox:function(a,c){l(a);f[a]=c},getCurrentScores:function(a){var c,k=[],f;for(c=0;c<a;c++)k[c]=0;a=g();for(c=0;c<a;c++)h(c)&&(f=e(c),k[f]+=1);return k},getPlayerBoxes:function(a){var c,k,f=[],b;k=g();for(c=0;c<k;c++)b=e(c),b===a&&f.push(c);return f}}};dotBox=dotBox||{};
dotBox.lineState=function(a,b){function g(c,k){var b,d;if(h.isNullOrUndefined(c))throw Error("line is null or undefined");l(c.d1,"line.d1");l(c.d2,"line.d2");d=Math.abs(c.d1.x-c.d2.x);b=Math.abs(c.d1.y-c.d2.y);if(1<d)throw new RangeError("Move appears to be too long on x-axis.  Line must only connect adjacent points.");if(1<b)throw new RangeError("Move appears to be too long on y-axis.  Line must only connect adjacent points.");if(1<d+b)throw new RangeError("Movement appears to be diagonal this is not allowed.");var q;
h.line.isHLine(c)?(d=e,b=c.d1.y,q=Math.min(c.d1.x,c.d2.x),b=b*(a-1)+q):(d=f,b=Math.min(c.d1.y,c.d2.y),q=c.d1.x,b=b*a+q);h.isNullOrUndefined(k)||k&&(d[b]=!0);return d[b]}function l(c,k){if(h.isNullOrUndefined(c))throw Error(k+" is null or undefined.");if(0>c.x)throw new RangeError(k+".x must be > 0.");if(c.x>=a)throw new RangeError(k+".x must be < "+a);if(0>c.y)throw new RangeError(k+".y must be > 0.");if(c.y>=b)throw new RangeError(k+".y must be < "+b);}var h=dotBox.utility,e=[],f=[],d;d={connected:g,
isBoxClosed:function(c){var k;k=h.line.getLinesFromBox(c,a);for(c=0;4>c;c++)if(!g(k[c]))return!1;return!0},getAllLinesForDot:function(c){var k=[],f,e;f=function(){return{x:c.x,y:c.y}};e=function(a,c){k.push({d1:f(),d2:{x:a,y:c}})};0<c.y&&e(c.x,c.y-1);c.x<a-1&&e(c.x+1,c.y);c.y<b-1&&e(c.x,c.y+1);0<c.x&&e(c.x-1,c.y);return k},getOpenLinesForDot:function(a){return d.getAllLinesForDot(a).filter(function(a){return!d.connected(a)})},getTotalLineCount:function(){return f.length+e.length},getLineStatesForBox:function(c){var k=
[],b=[],f,e;c=dotBox.utility.line.getLinesFromBox(c,a);for(f=0;4>f;f++)e=c[f],d.connected(e)?b.push(e):k.push(e);return{open:k,closed:b}}};(function(a,b){var h,d,q;d=(a-1)*b;q=(b-1)*a;for(h=0;h<d;h++)e[h]=!1;for(h=0;h<q;h++)f[h]=!1})(a,b);return d};dotBox=dotBox||{};
dotBox.gameEngine=function(a){function b(){return g()?null:k}function g(){return n.areAllBoxesScored()}var l=dotBox.utility,h,e,f,d,c,k,m,n=null;(function(a){a||(a={});e=l.isNullOrUndefined(a.dotCountLength)?10:parseInt(a.dotCountLength,10);f=l.isNullOrUndefined(a.dotCountWidth)?10:parseInt(a.dotCountWidth,10);h=l.isNullOrUndefined(a.playerCount)?2:parseInt(a.playerCount,10);k=l.isNullOrUndefined(a.startPlayer)?0:parseInt(a.startPlayer,10);if(isNaN(e))throw new TypeError("dotCountLength is not a number.");if(isNaN(f))throw new TypeError("dotCountWidth is not a number.");
if(isNaN(h))throw new TypeError("playerCount is not a number.");if(isNaN(k))throw new TypeError("startPlayer is not a number.");if(3>e)throw new RangeError("dotCountLength must be three or more");if(3>f)throw new RangeError("dotCountWidth must be three or more");if(2>h)throw new RangeError("playerCount must two or more");if(0>k||k>=h)throw new RangeError("startPlayer must be between 0 and playerCount-1");d=e-1;c=f-1;n=l.isNullOrUndefined(a.boxState)?dotBox.boxState(e,f):a.boxState;m=l.isNullOrUndefined(a.lineState)?
dotBox.lineState(e,f):a.lineState})(a);return{getDotCountLength:function(){return e},getBoxCountLength:function(){return d},getDotCountWidth:function(){return f},getBoxCountWidth:function(){return c},getBoxCount:function(){return d*c},getPlayerCount:function(){return h},getCurrentPlayer:b,getCurrentScores:function(){return n.getCurrentScores(h)},isLineConnected:function(a){return m.connected(a)},connectLine:function(a){var c={},d;if(g())throw Error("Cannot make a move when the game is over.");if(m.connected(a))throw Error("This line is already connected.");
d=b();m.connected(a,!0);a=l.line.getBoxesFromLine(a,e,f).filter(m.isBoxClosed).filter(n.isBoxNotScored);a.forEach(function(a){n.scoreBox(a,d)});c.boxesScored=a;c.gameOver=g();0===c.boxesScored.length?(a=g()?null:k=k===h-1?0:k+1,c.nextPlayer=a):c.nextPlayer=b();return c},isGameOver:g,hasAnyOpenLines:function(a){if(void 0===a)throw Error("dot argument was not supplied.");if(null===a)throw Error("dot argument was null.");return 0<m.getOpenLinesForDot(a).length},canConnectDots:function(a,c){var b,f,k;
if(l.isNullOrUndefined(a))throw Error("dot1 argument was null or undefined.");if(l.isNullOrUndefined(c))throw Error("dot2 argument was null or undefined.");f=m.getOpenLinesForDot(a);for(b=0;b<f.length;b++)if(k=f[b].d2,l.areSameDot(k,c))return!0;return!1},getPlayerBoxes:function(){return n.getPlayerBoxes.apply(n,arguments)},getOpenLinesForDot:function(){return m.getOpenLinesForDot.apply(m,arguments)},getTotalLineCount:function(){return m.getTotalLineCount.apply(m,arguments)},isBoxScored:function(){return n.isBoxScored.apply(n,
arguments)},getLineStatesForBox:function(){return m.getLineStatesForBox.apply(m,arguments)}}};dotBox=dotBox||{};
dotBox.model=function(a,b){var g=dotBox.utility,l;return l={selectedDot:null,hoveredDot:null,isSelectedDot:function(a){return null!==l.selectedDot&&g.areSameDot(a,l.selectedDot)},isHoveredDot:function(a){return null!==l.hoveredDot&&g.areSameDot(a,l.hoveredDot)},getDotColCount:function(){return a.getDotCountLength()},canConnectDots:function(b){return null!==l.selectedDot&&a.canConnectDots(l.selectedDot,b)},getDotRowCount:function(){return a.getDotCountWidth()},hasAnyOpenLines:function(b){return a.hasAnyOpenLines(b)},getCurrentScores:function(){return a.getCurrentScores()},
getCurrentPlayer:function(){return a.getCurrentPlayer()},getPlayerBoxes:function(){return a.getPlayerBoxes.apply(a,arguments)},gameConfig:b,isQuickStarting:!1}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};dotBox.views.constants={P1_COLOR:"#A4E402",P2_COLOR:"#BF7AFF",PX_COLOR:"#5B5B5B",SCORE_TXT_COLOR:"#E7F8F2",BOARD_BACK_COLOR:"#272822"};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.viewContext=function(a,b){var g,l;function h(a){for(var f in a)a.hasOwnProperty(f)&&(a[f]*=b);return a}var e=dotBox.utility,f,d;if(e.isNullOrUndefined(a))throw Error("observer parameter is required.");if(e.isNullOrUndefined(b))throw Error("pixelRatio is required.");l=g=0;d=h({DOT_RADIUS:5,DOT_MARGIN:20,POINT_FONT_SIZE:13,SCORE_BOARD_HEIGHT:65});a.subscribe("view.reserveCanvasSize",function(a){e.isNullOrUndefined(a)||(e.isNullOrUndefined(a.height)||(g+=a.height),e.isNullOrUndefined(a.width)||
(l+=a.width))});return f={observer:a,pixelRatio:b,stage:null,boxShapes:{},pixelSizes:d,initCanvasStage:function(a){var k;k=0;for(var e=null,d,h;null===e;)d="dotBoxCanvas_"+k,h=$("#"+d),0===h.length&&(e=d),k+=1;k=e;a.append('<canvas id="'+k+'" width='+l+" height="+g+' style="width: '+1/b*l+"px; height: "+1/b*g+'px;"></canvas>');f.stage=new createjs.Stage(k)},scalePixel:function(a){return a*b},scaleAllPixelProps:h,setDrawColors:function(a){var b=a.fillColor;a=a.strokeColor;dotBox.utility.isNullOrUndefined(b)||
(this.fillStyle=b.toString());dotBox.utility.isNullOrUndefined(a)||(this.strokeStyle=a.toString())},width:function(){if(null===f.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return f.stage.canvas.width},height:function(){if(null===f.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return f.stage.canvas.height},getPlayerColor:function(a){switch(a){case 0:return dotBox.views.constants.P1_COLOR;case 1:return dotBox.views.constants.P2_COLOR;
default:return dotBox.views.constants.PX_COLOR}}}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.Color=function(){function a(a){var b,d,c;b=parseInt(a.slice(1,3),16);d=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);c=new h;c.red=b;c.green=d;c.blue=a;return c}function b(a){var b,d,c,k;a=a.trim();a=a.toLowerCase();a=a.slice(5,a.length-1);a=a.trim();c=a.split(",");if(4!==c.length)throw Error("Could not parse rgba() color string.");a=parseInt(c[0].trim(),10);b=parseInt(c[1].trim(),10);d=parseInt(c[2].trim(),10);c=parseFloat(c[3].trim());k=new h;k.red=a;k.green=b;k.blue=d;k.alpha=
c;return k}function g(a){var b,d,c;a=a.trim();a=a.toLowerCase();a=a.slice(4,a.length-1);a=a.trim();d=a.split(",");if(3!==d.length)throw Error("Could not parse rgb() color string.");a=parseInt(d[0].trim(),10);b=parseInt(d[1].trim(),10);d=parseInt(d[2].trim(),10);c=new h;c.red=a;c.green=b;c.blue=d;return c}function l(e){e=e.trim();if(0===e.lastIndexOf("#",0)&&7===e.length)return a(e);if(0===e.lastIndexOf("rgba(",0))return b(e);if(0===e.lastIndexOf("rgb(",0))return g(e);throw Error("Invalid arguments.");
}var h;h=function f(a){var b;if(!(this instanceof f))return f.apply(new f,arguments);this.green=this.blue=this.red=255;this.alpha=1;if(1===arguments.length)return b=a.toString(),l(b);if(4===arguments.length){var k=arguments,m,g,q;b=Math.round(parseFloat(k[0]));m=Math.round(parseFloat(k[1]));g=Math.round(parseFloat(k[2]));q=parseFloat(k[3]);k=new h;k.red=b;k.green=m;k.blue=g;k.alpha=q;return k}if(3===arguments.length)return g=arguments,b=Math.round(parseFloat(g[0])),m=Math.round(parseFloat(g[1])),
k=Math.round(parseFloat(g[2])),g=new h,g.red=b,g.green=m,g.blue=k,g;if(0!==arguments.length)throw Error(arguments.length+" number of arguments not supported.");};h.parseHexColorString=a;h.parseColorString=l;h.parseRgbaColorString=b;h.parseRgbColorString=g;h.prototype.toString=function(){var a,b,c;a=Math.round(this.red);b=Math.round(this.green);c=Math.round(this.blue);return"rgba("+[a,b,c,this.alpha].join()+")"};h.prototype.clone=function(){var a=new h;a.red=this.red;a.green=this.green;a.blue=this.blue;
a.alpha=this.alpha;return a};return h}();dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.board=function(a,b){function g(b){u.isNullOrUndefined(b)||a.observer.publish("dotRollOver",b)}function l(b){u.isNullOrUndefined(b)||a.observer.publish("dotRollOut",b)}function h(){A||e(this.dot)}function e(b){a.observer.publish("dotClick",b)}function f(){var a=E,c=p(2.5*t.DOT_RADIUS);u.areSameDot(a,c)||(A||(!u.isNullOrUndefined(c)&&b.hasAnyOpenLines(c)?d("pointer"):d("")),E=c,A||(l(a),g(c)))}function d(b){a.stage.canvas.style.cursor=b}function c(){a.stage.update()}function k(c){var k,
f;c instanceof createjs.Shape?(k=c,c=k.dot,f=!0):(k=m(c),f=!1);c=b.isSelectedDot(c)?H:b.isHoveredDot(c)&&b.canConnectDots(c)?B:b.isHoveredDot(c)?I:J;c=new F(c);f?(k.fillColor=c,k.graphics.beginFill(c).inject(a.setDrawColors,k).drawCircle(0,0,t.DOT_RADIUS).endFill()):createjs.Tween.get(k.fillColor,{override:!0}).to(c,250);return k}function m(a){return D[a.y][a.x]}function n(c,k,f){var e,d=m(c.d1),h=m(c.d2),g=!1,l=a.scalePixel(1),n=null,t;e=r(c);u.isNullOrUndefined(e)?(e=new createjs.Shape,w(c,e),g=
!0):e.graphics.clear();e.graphics.setStrokeStyle(l).beginStroke(k).moveTo(d.x,d.y).lineTo(h.x,h.y);t=b.isQuickStarting;g&&(y.isHLine(c)?(e.scaleX=0.1,e.x=d.x-0.1*d.x,n={scaleX:1,x:0}):(e.scaleY=0.1,e.y=d.y-0.1*d.y,n={scaleY:1,y:0}),e.on("click",q),a.stage.addChild(e),createjs.Tween.get(e,{override:!0}).to(n,300).call(function(){var b;t||f||(b=new createjs.Shape,b.graphics.setStrokeStyle(a.scalePixel(1)).beginStroke(z).drawCircle(0,0,a.pixelSizes.DOT_RADIUS),b.x=h.x,b.y=h.y,b.scaleX=0,b.scaleY=0,a.stage.addChild(b),
createjs.Tween.get(b).to({scaleX:1.5,scaleY:1.5},150).to({scaleX:5,scaleY:5,alpha:0},1E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(b)}))}))}function q(b){b=a.stage.getObjectsUnderPoint(b.stageX,b.stageY).filter(function(a){return!u.isNullOrUndefined(a.dot)});0<b.length&&h.apply(b[0])}function x(c,k){var f,e,d,h;b.isQuickStarting||(e=m(c.lines[0].d1),h=m(c.lines[0].d2),f=e.x+(h.x-e.x)/2,e=m(c.lines[1].d1),h=m(c.lines[1].d2),e=e.y+(h.y-e.y)/2,d=new createjs.Text("+"+k,t.POINT_FONT_SIZE+
"px Helvetica",G.SCORE_TXT_COLOR),d.x=f,d.y=e,d.textAlign="center",d.textBaseline="middle",d.alpha=0,a.stage.addChild(d),createjs.Tween.get(d,{override:!1}).wait(550).to({alpha:1},0).to({alpha:0,y:a.height()+a.scalePixel(50)},3E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(d)}),createjs.Tween.get(d,{override:!1}).wait(550).to({scaleX:1.5,scaleY:1.5},200,createjs.Ease.elasticInOut))}function w(a,b){var c,k;c=s(a);k=c.store[c.y];u.isNullOrUndefined(k)&&(k={},c.store[c.y]=k);k[c.x]=b}
function r(a){var b;a=s(a);if(!a.store.hasOwnProperty(a.y))return null;b=a.store[a.y];return b.hasOwnProperty(a.x)?b[a.x]:null}function s(a){var b,c;u.line.isHLine(a)?(c=K,b=a.d1.y,a=Math.min(a.d1.x,a.d2.x)):(c=L,b=Math.min(a.d1.y,a.d2.y),a=a.d1.x);return{x:a,y:b,store:c}}function v(a,b){var c;c=Math.floor((a-t.DOT_MARGIN/2)/(2*t.DOT_RADIUS+t.DOT_MARGIN));return 0>c||c>=b?null:c}function p(c){var k,f,e,d;k=a.stage.mouseX;f=a.stage.mouseY;if(!a.stage.mouseInBounds)return null;e=v(k,b.getDotColCount());
if(null===e)return null;d=v(f,b.getDotRowCount());if(null===d)return null;e={x:e,y:d};d=m(e);var h=d.y;k=Math.pow(d.x-k,2)+Math.pow(h-f,2);c=Math.pow(c,2);k<=c||(e=null);return e}var u=dotBox.utility,y=dotBox.utility.line,G=dotBox.views.constants,F=dotBox.views.Color;if(u.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(u.isNullOrUndefined(b))throw Error("model is null or undefined.");var t=a.pixelSizes,J="#53d2f1",I="#89E0F5",H="#fc1f70",B="#E20355",z="white",D,K={},L={},
C,E=null,A=!1;(function(){var c,k,f;c={height:0,width:0};k=2*b.getDotColCount()*t.DOT_RADIUS;f=(b.getDotColCount()+1)*t.DOT_MARGIN;c.width=k+f;k=2*b.getDotRowCount()*t.DOT_RADIUS;f=(b.getDotRowCount()+1)*t.DOT_MARGIN;c.height=k+f;a.observer.publish("view.reserveCanvasSize",c)})();a.observer.subscribe("startGame",function(){var e,d,g,m=b.getDotRowCount(),l=b.getDotColCount(),n;e=new createjs.Shape;e.graphics.beginFill(G.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height());a.stage.addChild(e);D=[];
for(d=0;d<m;d++)for(e=0;e<l;e++)0===e&&(n=[],D.push(n)),g=new createjs.Shape,g.dot={x:e,y:d},k(g),g.x=e*(t.DOT_MARGIN+2*t.DOT_RADIUS)+(t.DOT_MARGIN+t.DOT_RADIUS),g.y=d*(t.DOT_MARGIN+2*t.DOT_RADIUS)+(t.DOT_MARGIN+t.DOT_RADIUS),g.on("click",h),n.push(g),a.stage.addChild(g);a.stage.update();a:{m=20;C&&(clearInterval(C),C=null);if(null===m)m=20;else if(0>=m)break a;C=setInterval(f,1E3/Math.min(50,m))}createjs.Ticker.addEventListener("tick",c);createjs.Ticker.setFPS(60)});a.observer.subscribe("view.dotRollOver",
function(a){a=k(a);createjs.Tween.get(a,{override:!0}).to({scaleX:2,scaleY:2},150)});a.observer.subscribe("view.dotRollOut",function(a){a=k(a);createjs.Tween.get(a,{override:!0}).to({scaleX:1,scaleY:1},150)});a.observer.subscribe("view.dotSelectionChanged",function(a,b){var c;null!==a&&k(a);null!==b&&k(b);a!==b&&(c=m(null!==b?b:a),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150).call(function(){var a=p(t.DOT_RADIUS);u.isNullOrUndefined(a)&&d("")}))});a.observer.subscribe("view.lineConnected",
function(a,b){var c;k(a.d1);c=k(a.d2);createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150);n(a,z,b)});a.observer.subscribe("view.boxesScored",function(b,c){var k;for(k=0;k<b.length;k++){var f=b[k],e=c,d=void 0,h=void 0,g=d=void 0,l=void 0,n=void 0,t=void 0,g=void 0,y=a.scalePixel(10),p=a.scalePixel(1),t=a.getPlayerColor(e),n=new F(t);n.alpha=0.33;n=n.toString();h=m(f.lines[0].d1);d=m(f.lines[1].d2);g=d.x-h.x;l=d.y-h.y;d=new createjs.Shape;d.graphics.setStrokeStyle(p).beginStroke(t).beginFill(n).drawRect(h.x,
h.y,g,l);g=(g+y)/g;d.scaleX=g;d.scaleY=g;d.x=-1*(h.x*g-h.x)-y/2;d.y=-1*(h.y*g-h.y)-y/2;d.upperLeft={x:h.x,y:h.y};d.alpha=0;d.on("click",q);a.stage.addChild(d);a.boxShapes[f.box]=d;createjs.Tween.get(d,{override:!0}).wait(350).to({alpha:1},0).to({x:0,y:0,scaleX:1,scaleY:1},350)}x(b[0],b.length)});a.observer.subscribe("startRemoteTurn",function(a){d("wait");A=!0});a.observer.subscribe("endRemoteTurn",function(a,b){var c=u.getRandom(700,1250),k=u.getRandom(170,750),f=u.getRandom(500,750),h=u.getRandom(Math.floor(75),
750);setTimeout(function(){g(b.d1);setTimeout(function(){e(b.d1);l(b.d1);setTimeout(function(){g(b.d2);setTimeout(function(){A=!1;d(null);e(b.d2);l(b.d2)},h)},f)},k)},c)});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.score=function(a,b){function g(b,e){var h=new createjs.Container,g,l=a.scalePixel(1),w=a.scalePixel(2),u=a.scalePixel(9),B=a.scalePixel(6),z=a.scalePixel(13);g=new createjs.Shape;g.graphics.setStrokeStyle(l).beginStroke(x).beginFill(q).drawRoundRect(0,0,p.SCORE_BOX_W,e,w);h.addChild(g);g=new createjs.Text("0",p.SCORE_FONT_SIZE+"px Helvetica",f.SCORE_TXT_COLOR);g.x=p.SCORE_BOX_W/2;g.y=B+e/2;g.textAlign="center";g.textBaseline="middle";h.addChild(g);c.push(g);g=new createjs.Shape;g.graphics.setStrokeStyle(l).beginFill(r).beginStroke(s).arc(p.SCORE_BOX_W/
2,e+z,p.SCORE_BOX_W/4,Math.PI+0.25*Math.PI,1.75*Math.PI);g.alpha=0;k.push(g);h.addChild(g);l=g=new createjs.Shape;w=Math.round(0.3*e);B=a.scalePixel(2);z=a.scalePixel(2);l.fillColor=new d(v);l.strokeColor=new d(v);l.graphics.setStrokeStyle(B).beginStroke(v).beginFill(v).inject(a.setDrawColors,l).drawRoundRect(0,0,p.SCORE_BOX_W,w,z).endFill();h.addChild(g);m.push(g);g=new createjs.Text(b,p.P_NAME_FONT_SIZE+"px Helvetica",f.SCORE_TXT_COLOR);g.x=p.SCORE_BOX_W/2;g.y=u;g.textAlign="center";g.textBaseline=
"middle";n.push(g);h.addChild(g);return h}function l(a){var b,c,e,d,g;for(b=0;b<k.length;b++)c=k[b],b===a?(createjs.Tween.get(c,{override:!0}).to({alpha:1},250,createjs.Ease.sineIn),c=f.SCORE_TXT_COLOR):(createjs.Tween.get(c,{override:!0}).to({alpha:0},250,createjs.Ease.sineOut),c=w),g=m[b],e=h("fill",b,a),d=h("stroke",b,a),createjs.Tween.get(g.fillColor,{override:!0}).to(e,200),createjs.Tween.get(g.strokeColor,{override:!0}).to(d,200),n[b].color=c}function h(a,b,c){b===c?(b=0===b?new d(f.P1_COLOR):
new d(f.P2_COLOR),"fill"===a&&(b.alpha=0.33)):b=new d(v);return b}var e=dotBox.utility,f=dotBox.views.constants,d=dotBox.views.Color,c=[],k=[],m=[],n=[],q="#272822",x="#3b3d38",w="#a69b9d",r="#fc1f70",s="#E20355",v="#40403d",p=a.scaleAllPixelProps({SCORE_BOX_W:75,SCORE_FONT_SIZE:25,P_NAME_FONT_SIZE:10}),u=a.pixelSizes.SCORE_BOARD_HEIGHT;if(e.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(e.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.publish("view.reserveCanvasSize",
{height:u});a.observer.subscribe("startGame",function(){var e,f,d=a.scalePixel(10);f=a.scalePixel(5);var h=u-2*f;e=a.height()-u;f=e+f+1;c=[];k=[];m=[];n=[];var q,x=a.scalePixel(1),w=a.height(),r=a.width();q=new createjs.Shape;q.graphics.beginLinearGradientFill(["#5b5b5b","#545454"],[0,1],0,e,0,w).drawRect(0,e,r,w).endFill();q.graphics.setStrokeStyle(x).beginStroke("#323232").moveTo(0,e).lineTo(r,e).endStroke();q.graphics.setStrokeStyle(x).beginStroke("#7d7d7d").moveTo(0,e+x).lineTo(r,e+x).endStroke();
a.stage.addChild(q);e=g(b.gameConfig.playerNames[0],h);e.x=d;e.y=f;a.stage.addChild(e);e=g(b.gameConfig.playerNames[1],h);e.x=a.width()-d-p.SCORE_BOX_W;e.y=f;a.stage.addChild(e);l(b.getCurrentPlayer())});a.observer.subscribe("gameOver",function(a){l(a)});a.observer.subscribe("view.boxesScored",function(){var a,e;e=b.getCurrentScores();for(a=0;a<e.length;a++)c[a].text=e[a]});a.observer.subscribe("views.playerTurnChanged",function(){l(b.getCurrentPlayer())});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.gameOver=function(a,b){function g(b,e,h){var g,l,r,s,v,p=a.scalePixel(10),u=a.scalePixel(2),y;g=new createjs.Container;r=a.height()-k.SCORE_BOARD_HEIGHT;s=a.width();l=new createjs.Text(b,c+"px Helvetica",d.SCORE_TXT_COLOR);l.textAlign="center";l.textBaseline="middle";v=l.getBounds();b=v.height+2*p+2*u;p=v.width+2*p+2*u;v=new createjs.Shape;v.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,p,b);g.addChild(v);y=new f(e);y.alpha=0.2;v=new createjs.Shape;v.graphics.setStrokeStyle(u).beginStroke(e).beginFill(y.toString()).drawRect(0,
0,p,b);g.addChild(v);l.x=p/2;l.y=b/2;g.addChild(l);g.x=s/2;g.y=r/2;e=(s-p)/2;r=(r-b)/2;g.alpha=0;g.scaleX=0;g.scaleY=0;a.stage.addChild(g);createjs.Tween.get(g,{override:!0}).wait(h).to({alpha:1,scaleX:1,scaleY:1,x:e,y:r},1E3,createjs.Ease.quadIn).wait(2500).to({x:s+p/2},500,createjs.Ease.quadOut).call(function(){a.stage.removeChild(g)})}function l(b,c,e){var k,d,h=a.scalePixel(1);b=a.boxShapes[b];d=a.getPlayerColor(c);k=new f(d);k.alpha=0.33;k=k.toString();c=new createjs.Shape;c.graphics.setStrokeStyle(h).beginStroke(d).beginFill(k).drawRect(b.upperLeft.x,
b.upperLeft.y,e,e);c.upperLeft={x:b.upperLeft.x,y:b.upperLeft.y};return c}function h(c,f){var d,g,w,r,s,v,p;d=b.getPlayerBoxes(c);0!==d.length&&(s=2*k.DOT_RADIUS+k.DOT_MARGIN,d=d[e.getRandom(0,d.length-1)],p=l(d,c,s),g=a.scalePixel(15),d=(s+g)/s,w=-1*(p.upperLeft.x*d-p.upperLeft.x)-g/2,g=-1*(p.upperLeft.y*d-p.upperLeft.y)-g/2,r=a.scalePixel(45),s=(s+r)/s,v=-1*(p.upperLeft.x*s-p.upperLeft.x)-r/2,r=-1*(p.upperLeft.y*s-p.upperLeft.y)-r/2,p.alpha=0,f.addChild(p),createjs.Tween.get(p,{override:!1}).wait(1E3).to({alpha:0.5},
0).to({alpha:1,scaleX:d,scaleY:d,x:w,y:g},500).to({alpha:0,scaleX:s,scaleY:s,x:v,y:r},1500,createjs.Ease.sineOut).call(function(){f.removeChild(p);h(c,f)}))}var e=dotBox.utility,f=dotBox.views.Color,d=dotBox.views.constants,c=a.scalePixel(18),k=a.pixelSizes;if(e.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(e.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.subscribe("gameOver",function(c){var e,k,f,l;l=0===c?1:0;e=b.gameConfig.playerNames[c];k=
b.gameConfig.playerNames[l];f=a.getPlayerColor(c);l=a.getPlayerColor(l);var r,s;s=new createjs.Container;r=new createjs.Shape;r.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()-a.scalePixel(65));r.alpha=0.15;s.addChild(r);a.stage.addChild(s);createjs.Tween.get(r,{override:!0}).to({alpha:0.5},600,createjs.Ease.sineIn).call();h(c,s);g("=) "+e+" wins!",f,30);g("='(  Sorry "+k,l,4030)});return{}};dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.utility=dotBox.ai.utility||{};
(function(a){function b(a,b){return 3<=b.getLineStatesForBox(a).open.length}function g(a){var b=[],d,c;c=function(c){for(var d;d=c.next();)a.isLineConnected(d)||b.push(d)};d=h.hLineIterator(a.getDotCountLength(),a.getDotCountWidth());c(d);d=h.vLineIterator(a.getDotCountLength(),a.getDotCountWidth());c(d);return b}var l=dotBox.utility,h=dotBox.utility.iterators;a.findCloseableBoxes=function(a){var b=[],d,c=a.getBoxCount(),k;for(d=0;d<c;d++)a.isBoxScored(d)||(k=a.getLineStatesForBox(d),1===k.open.length&&
b.push({boxIndex:d,openLine:k.open[0]}));return b};a.boxHasThreeOrMoreOpen=b;a.getAllOpenLines=g;a.findNonThirdSideLines=function(a){var f,d,c,k,h=a.getDotCountLength(),n=a.getDotCountWidth(),q=[],x;d=g(a);x=function(c){return b(c,a)};for(f=0;f<d.length;f++)k=d[f],c=l.line.getBoxesFromLine(k,h,n),c.every(x)&&q.push(k);return q}})(dotBox.ai.utility);dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AiPlayer=function AiPlayer(b,g){if(!(this instanceof AiPlayer))return AiPlayer.apply(new AiPlayer,arguments);this.playerIndex=b;this.gameEngine=g};
dotBox.ai.AiPlayer.prototype=function(){var a=dotBox.utility;return{getRandomDot:function(){var b,g;b=a.getRandom(0,this.gameEngine.getDotCountLength()-1);g=a.getRandom(0,this.gameEngine.getDotCountWidth()-1);return{x:b,y:g}},getRandomOpenLine:function(){var b=null;if(this.gameEngine.isGameOver())return null;for(;null===b;)b=this.getRandomDot(),b=this.gameEngine.getOpenLinesForDot(b),null!==b&&0===b.length&&(b=null);return a.getRandomItem(b)},move:function(){return this.getRandomOpenLine()},makeMove:function(a){var g=
this;if(void 0===a)return this.move();setTimeout(function(){a(g.move())},10)}}}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AvoidThirdSide=function(){var a=dotBox.utility,b=dotBox.ai.utility,g;g=function h(a,b){if(!(this instanceof h))return h.apply(new h,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(g,dotBox.ai.AiPlayer);g.prototype.move=function(){var h;h=b.findNonThirdSideLines(this.gameEngine);return 0<h.length?h=a.getRandomItem(h):g.uber.move.apply(this)};return g}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.SingleBoxCloser=function(){var a=dotBox.utility,b;b=function l(a,b){if(!(this instanceof l))return l.apply(new l,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(b,dotBox.ai.AvoidThirdSide);b.prototype.move=function(){var l;l=dotBox.ai.utility.findCloseableBoxes(this.gameEngine);return 0<l.length?(l=a.getRandomItem(l),l.openLine):b.uber.move.apply(this)};return b}();dotBox=dotBox||{};
dotBox.controller=function(a,b){function g(c,g){var n,q,x,w;x=f.getCurrentPlayer();q={d1:c,d2:g};n=f.connectLine(q);w=0<n.boxesScored.length;d.selectedDot=null;d.hoveredDot=null;a.publish("view.lineConnected",q,w);n=n.boxesScored;var r;if(0<n.length){w=[];for(q=0;q<n.length;q++)r=n[q],w.push({box:r,lines:e.line.getLinesFromBox(r,f.getDotCountLength())});a.publish("view.boxesScored",w,x)}f.isGameOver()?a.publish("gameOver",l()):(n=f.getCurrentPlayer(),null!==n&&n!==x&&a.publish("views.playerTurnChanged"),!d.isQuickStarting&&
b.useAi&&1===n&&h(n))}function l(){var a,b=0,c=0,e;e=d.getCurrentScores();for(a=0;a<e.length;a++)e[a]>=c&&(c=e[a],b=a);return b}function h(b){a.publish("startRemoteTurn",b);c.makeMove(function(c){a.publish("endRemoteTurn",b,c)})}var e=dotBox.utility,f,d=null,c;f=dotBox.gameEngine({dotCountLength:b.dotColCount,dotCountWidth:b.dotRowCount});(function(){var a=[];e.isNullOrUndefined(b.playerNames)&&(b.playerNames=[]);1>b.playerNames.length||e.isNullOrUndefined(b.playerNames[0])||0===b.playerNames[0].length?
a.push("PLAYER 1"):a.push(b.playerNames[0]);2>b.playerNames.length||e.isNullOrUndefined(b.playerNames[1])||0===b.playerNames[1].length?b.useAi?a.push("HAL9000"):a.push("PLAYER 2"):a.push(b.playerNames[1]);b.playerNames=a})();b.useAi&&(c=new dotBox.ai.SingleBoxCloser(1,f));d=dotBox.model(f,b);a.subscribe("dotRollOver",function(b){f.hasAnyOpenLines(b)&&(d.hoveredDot=b,a.publish("view.dotRollOver",b))});a.subscribe("dotRollOut",function(b){d.hoveredDot=null;a.publish("view.dotRollOut",b)});a.subscribe("dotClick",
function(b){var c=d.selectedDot;if(!f.hasAnyOpenLines(b))return null;d.isSelectedDot(b)?(d.selectedDot=null,a.publish("view.dotSelectionChanged",c,null)):null!==d.selectedDot&&d.canConnectDots(b)?g(c,b):(d.selectedDot=b,a.publish("view.dotSelectionChanged",c,b))});return{startGame:function(){a.publish("startGame",d);if(!e.isNullOrUndefined(b.preMovePercent)){var c=b.preMovePercent,l,n;if(0>c||1<c)throw Error("percent must be between 0 and 1");if(0!==c){l=f.getTotalLineCount();l=Math.floor(l*c);0<
l&&(d.isQuickStarting=!0);for(var q=new dotBox.ai.AvoidThirdSide(-1,f),c=0;c<l;c++)n=q.move(),g(n.d1,n.d2);d.isQuickStarting=!1;c=f.getCurrentPlayer();b.useAi&&1===c&&h(f.getCurrentPlayer())}}},model:d}};dotBox=dotBox||{};dotBox.game=function(a,b){var g,l,h=[],e;g=new Observer;l=dotBox.views.viewContext(g,window.devicePixelRatio,2);g=dotBox.controller(g,b);e=g.model;h.push(dotBox.views.board(l,e));h.push(dotBox.views.score(l,e));h.push(dotBox.views.gameOver(l,e));l.initCanvasStage(function(a){if(a instanceof jQuery)return $(a[0]);"string"===typeof a&&0!==a.lastIndexOf("#",0)&&(a="#"+a);return $(a)}(a));g.startGame()};(function(a){a.fn.dotBox=function(a){dotBox.game(this,a);return this}})(jQuery); //@ sourceMappingURL=./dotBox-min.js.map
