var Observer=function(){function a(a,b){return b.priority-a.priority}function b(a){return void 0===a?!0:null===a}var f;f=function e(){if(!(this instanceof e))return new e;this._channelSubscribers={}};f.prototype.subscribe=function(e,g,c){var d=this._channelSubscribers[e];b(d)&&(d=[]);if(b(c)){c=d;var l,h,f=0;if(!b(c))for(h=c.length,l=0;l<h;l++)0>c[l].priority&&c[l].priority<f&&(f=c[l].priority);c=f-1}d.push({priority:c,callback:g});d=d.sort(a);this._channelSubscribers[e]=d};f.prototype.unsubscribe=
function(a,g){var c,d=this._channelSubscribers[a];if(!b(d)){for(c=0;c<d.length;c++)if(d[c].callback===g){d.splice(c,1);break}0===d.length&&delete this._channelSubscribers[a]}};f.prototype.publish=function(a,g,c,d){var l,h,f,m=null;if(0===arguments.length||b(a))throw Error("channelId argument required.");1<arguments.length&&(m=Array.prototype.slice.call(arguments,1));f=this._channelSubscribers[a];h={channelId:a,cancel:!1};if(b(f))return!0;for(l=0;l<f.length;l++)if(f[l].callback.apply(h,m),h.cancel)return!1;
return!0};return f}();var dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};
(function(a){function b(a){return void 0===a?!0:null===a}a.isNullOrUndefined=b;a.areSameDot=function(a,k){return b(a)&&b(k)?!0:b(a)!==b(k)?!1:a.x===k.x&&a.y===k.y};a.getRandom=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};a.getRandomItem=function(b){var k;k=a.getRandom(0,b.length-1);return b[k]};a.inherit=function(){var a=function(){};return function(b,e){a.prototype=e.prototype;b.prototype=new a;b.uber=e.prototype;b.prototype.constructor=b}}();a.isCanvasSupported=function(){var a=document.createElement("canvas");
return!(!a.getContext||!a.getContext("2d"))}})(dotBox.utility);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.line=dotBox.utility.line||{};
(function(a){function b(a){return 0<Math.abs(a.d1.x-a.d2.x)}a.isHLine=b;a.getBoxesFromLine=function(a,k,e){var g=k-1,c=[],d,l;b(a)?(d=a.d1.y,l=Math.min(a.d1.x,a.d2.x),0!==a.d1.y&&(a.d1.y!==e-1&&c.push(d*g+l),d-=1)):(l=a.d1.x,d=Math.min(a.d1.y,a.d2.y),0!==a.d1.x&&(a.d1.x!==k-1&&c.push(d*g+l),l-=1));c.push(d*g+l);return c};a.getLinesFromBox=function(a,b){var e=b-1,g=[],c;c=a%e;e=(a-c)/e;g.push({d1:{x:c,y:e},d2:{x:c+1,y:e}});g.push({d1:{x:c+1,y:e},d2:{x:c+1,y:e+1}});g.push({d1:{x:c,y:e+1},d2:{x:c+1,
y:e+1}});g.push({d1:{x:c,y:e},d2:{x:c,y:e+1}});return g}})(dotBox.utility.line);dotBox=dotBox||{};dotBox.utility=dotBox.utility||{};dotBox.utility.iterators=dotBox.utility.iterators||{};
(function(a){a.hLineIterator=function(a,f){function k(){return c?!1:{d1:{x:e,y:g},d2:{x:e+1,y:g}}}var e=-1,g=0,c=!1;return{next:function(){if(c)return null;if(g===f-1&&e===a-2)return c=!0,null;e===a-2?(g+=1,e=0):e+=1;return k()},current:k}};a.vLineIterator=function(a,f){function k(){return c?!1:{d1:{x:e,y:g},d2:{x:e,y:g+1}}}var e=-1,g=0,c=!1;return{next:function(){if(c)return null;if(g===f-2&&e===a-1)return c=!0,null;e===a-1?(g+=1,e=0):e+=1;return k()},current:k}}})(dotBox.utility.iterators);dotBox=dotBox||{};
dotBox.boxState=function(a,b){function f(){return c.length}function k(a){var b=f();if(0>a)throw new RangeError("boxIndex must be greater or equal to 0.");if(a>=b)throw new RangeError("boxIndex must be less than the box count ("+b+").");}function e(a){k(a);return null!==c[a]}function g(a){k(a);return c[a]}var c;(function(a,b){var h,g=(a-1)*(b-1);c=[];for(h=0;h<g;h++)c[h]=null})(a,b);return{getBoxCount:f,areAllBoxesScored:function(){return c.every(function(a){return null!==a})},isBoxScored:e,isBoxNotScored:function(a){return!e(a)},
whichPlayerScoredBox:g,scoreBox:function(a,b){k(a);c[a]=b},getCurrentScores:function(a){var b,h=[],c;for(b=0;b<a;b++)h[b]=0;a=f();for(b=0;b<a;b++)e(b)&&(c=g(b),h[c]+=1);return h},getPlayerBoxes:function(a){var b,h,c=[],e;h=f();for(b=0;b<h;b++)e=g(b),e===a&&c.push(b);return c}}};dotBox=dotBox||{};
dotBox.lineState=function(a,b){function f(b,h){var d,m;if(e.isNullOrUndefined(b))throw Error("line is null or undefined");k(b.d1,"line.d1");k(b.d2,"line.d2");m=Math.abs(b.d1.x-b.d2.x);d=Math.abs(b.d1.y-b.d2.y);if(1<m)throw new RangeError("Move appears to be too long on x-axis.  Line must only connect adjacent points.");if(1<d)throw new RangeError("Move appears to be too long on y-axis.  Line must only connect adjacent points.");if(1<m+d)throw new RangeError("Movement appears to be diagonal this is not allowed.");var r;
e.line.isHLine(b)?(m=g,d=b.d1.y,r=Math.min(b.d1.x,b.d2.x),d=d*(a-1)+r):(m=c,d=Math.min(b.d1.y,b.d2.y),r=b.d1.x,d=d*a+r);e.isNullOrUndefined(h)||h&&(m[d]=!0);return m[d]}function k(c,h){if(e.isNullOrUndefined(c))throw Error(h+" is null or undefined.");if(0>c.x)throw new RangeError(h+".x must be > 0.");if(c.x>=a)throw new RangeError(h+".x must be < "+a);if(0>c.y)throw new RangeError(h+".y must be > 0.");if(c.y>=b)throw new RangeError(h+".y must be < "+b);}var e=dotBox.utility,g=[],c=[],d;d={connected:f,
isBoxClosed:function(b){var h;h=e.line.getLinesFromBox(b,a);for(b=0;4>b;b++)if(!f(h[b]))return!1;return!0},getAllLinesForDot:function(c){var h=[],g,d;g=function(){return{x:c.x,y:c.y}};d=function(a,b){h.push({d1:g(),d2:{x:a,y:b}})};0<c.y&&d(c.x,c.y-1);c.x<a-1&&d(c.x+1,c.y);c.y<b-1&&d(c.x,c.y+1);0<c.x&&d(c.x-1,c.y);return h},getOpenLinesForDot:function(a){return d.getAllLinesForDot(a).filter(function(a){return!d.connected(a)})},getTotalLineCount:function(){return c.length+g.length},getLineStatesForBox:function(b){var c=
[],g=[],e,f;b=dotBox.utility.line.getLinesFromBox(b,a);for(e=0;4>e;e++)f=b[e],d.connected(f)?g.push(f):c.push(f);return{open:c,closed:g}}};(function(a,b){var d,e,f;e=(a-1)*b;f=(b-1)*a;for(d=0;d<e;d++)g[d]=!1;for(d=0;d<f;d++)c[d]=!1})(a,b);return d};dotBox=dotBox||{};
dotBox.gameEngine=function(a){function b(){return f()?null:h}function f(){return m.areAllBoxesScored()}var k=dotBox.utility,e,g,c,d,l,h,p,m=null;(function(a){a||(a={});g=k.isNullOrUndefined(a.dotCountLength)?10:parseInt(a.dotCountLength,10);c=k.isNullOrUndefined(a.dotCountWidth)?10:parseInt(a.dotCountWidth,10);e=k.isNullOrUndefined(a.playerCount)?2:parseInt(a.playerCount,10);h=k.isNullOrUndefined(a.startPlayer)?0:parseInt(a.startPlayer,10);if(isNaN(g))throw new TypeError("dotCountLength is not a number.");if(isNaN(c))throw new TypeError("dotCountWidth is not a number.");
if(isNaN(e))throw new TypeError("playerCount is not a number.");if(isNaN(h))throw new TypeError("startPlayer is not a number.");if(3>g)throw new RangeError("dotCountLength must be three or more");if(3>c)throw new RangeError("dotCountWidth must be three or more");if(2>e)throw new RangeError("playerCount must two or more");if(0>h||h>=e)throw new RangeError("startPlayer must be between 0 and playerCount-1");d=g-1;l=c-1;m=k.isNullOrUndefined(a.boxState)?dotBox.boxState(g,c):a.boxState;p=k.isNullOrUndefined(a.lineState)?
dotBox.lineState(g,c):a.lineState})(a);return{getDotCountLength:function(){return g},getBoxCountLength:function(){return d},getDotCountWidth:function(){return c},getBoxCountWidth:function(){return l},getBoxCount:function(){return d*l},getPlayerCount:function(){return e},getCurrentPlayer:b,getCurrentScores:function(){return m.getCurrentScores(e)},isLineConnected:function(a){return p.connected(a)},connectLine:function(a){var d={},l;if(f())throw Error("Cannot make a move when the game is over.");if(p.connected(a))throw Error("This line is already connected.");
l=b();p.connected(a,!0);a=k.line.getBoxesFromLine(a,g,c).filter(p.isBoxClosed).filter(m.isBoxNotScored);a.forEach(function(a){m.scoreBox(a,l)});d.boxesScored=a;d.gameOver=f();0===d.boxesScored.length?(a=f()?null:h=h===e-1?0:h+1,d.nextPlayer=a):d.nextPlayer=b();return d},isGameOver:f,hasAnyOpenLines:function(a){if(void 0===a)throw Error("dot argument was not supplied.");if(null===a)throw Error("dot argument was null.");return 0<p.getOpenLinesForDot(a).length},canConnectDots:function(a,b){var c,h,d;
if(k.isNullOrUndefined(a))throw Error("dot1 argument was null or undefined.");if(k.isNullOrUndefined(b))throw Error("dot2 argument was null or undefined.");h=p.getOpenLinesForDot(a);for(c=0;c<h.length;c++)if(d=h[c].d2,k.areSameDot(d,b))return!0;return!1},getPlayerBoxes:function(){return m.getPlayerBoxes.apply(m,arguments)},getOpenLinesForDot:function(){return p.getOpenLinesForDot.apply(p,arguments)},getTotalLineCount:function(){return p.getTotalLineCount.apply(p,arguments)},isBoxScored:function(){return m.isBoxScored.apply(m,
arguments)},getLineStatesForBox:function(){return p.getLineStatesForBox.apply(p,arguments)}}};dotBox=dotBox||{};
dotBox.model=function(a,b){var f=dotBox.utility,k;return k={selectedDot:null,hoveredDot:null,isSelectedDot:function(a){return null!==k.selectedDot&&f.areSameDot(a,k.selectedDot)},isHoveredDot:function(a){return null!==k.hoveredDot&&f.areSameDot(a,k.hoveredDot)},getDotColCount:function(){return a.getDotCountLength()},canConnectDots:function(b){return null!==k.selectedDot&&a.canConnectDots(k.selectedDot,b)},getDotRowCount:function(){return a.getDotCountWidth()},hasAnyOpenLines:function(b){return a.hasAnyOpenLines(b)},getCurrentScores:function(){return a.getCurrentScores()},
getCurrentPlayer:function(){return a.getCurrentPlayer()},getPlayerBoxes:function(){return a.getPlayerBoxes.apply(a,arguments)},gameConfig:b,isQuickStarting:!1}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};dotBox.views.constants={P1_COLOR:"#A4E402",P2_COLOR:"#BF7AFF",PX_COLOR:"#5B5B5B",SCORE_TXT_COLOR:"#E7F8F2",BOARD_BACK_COLOR:"#272822"};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.viewContext=function(a,b,f){var k,e;function g(a){for(var c in a)a.hasOwnProperty(c)&&(a[c]=a[c]*b*f);return a}var c=dotBox.utility,d,l;if(c.isNullOrUndefined(a))throw Error("observer parameter is required.");if(c.isNullOrUndefined(b))throw Error("pixelRatio is required.");e=k=0;l=g({DOT_RADIUS:5,DOT_MARGIN:20,POINT_FONT_SIZE:13,SCORE_BOARD_HEIGHT:65});a.subscribe("view.reserveCanvasSize",function(a){c.isNullOrUndefined(a)||(c.isNullOrUndefined(a.height)||(k+=a.height),c.isNullOrUndefined(a.width)||
(e+=a.width))});return d={observer:a,pixelRatio:b,stage:null,boxShapes:{},pixelSizes:l,initCanvasStage:function(a){var c;c=0;for(var g=null,f,l;null===g;)f="dotBoxCanvas_"+c,l=$("#"+f),0===l.length&&(g=f),c+=1;c=g;a.append('<canvas id="'+c+'" width='+e+" height="+k+' style="width: '+1/b*e+"px; height: "+1/b*k+'px;"></canvas>');d.stage=new createjs.Stage(c)},scalePixel:function(a){return a*b*f},scaleAllPixelProps:g,setDrawColors:function(a){var b=a.fillColor;a=a.strokeColor;dotBox.utility.isNullOrUndefined(b)||
(this.fillStyle=b.toString());dotBox.utility.isNullOrUndefined(a)||(this.strokeStyle=a.toString())},width:function(){if(null===d.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return d.stage.canvas.width},height:function(){if(null===d.stage)throw Error("stage has not been initialized; call initCanvasStage first.");return d.stage.canvas.height},getPlayerColor:function(a){switch(a){case 0:return dotBox.views.constants.P1_COLOR;case 1:return dotBox.views.constants.P2_COLOR;
default:return dotBox.views.constants.PX_COLOR}}}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.Color=function(){function a(a){var b,d,f;b=parseInt(a.slice(1,3),16);d=parseInt(a.slice(3,5),16);a=parseInt(a.slice(5,7),16);f=new e;f.red=b;f.green=d;f.blue=a;return f}function b(a){var b,d,f,h;a=a.trim();a=a.toLowerCase();a=a.slice(5,a.length-1);a=a.trim();f=a.split(",");if(4!==f.length)throw Error("Could not parse rgba() color string.");a=parseInt(f[0].trim(),10);b=parseInt(f[1].trim(),10);d=parseInt(f[2].trim(),10);f=parseFloat(f[3].trim());h=new e;h.red=a;h.green=b;h.blue=d;h.alpha=
f;return h}function f(a){var b,d,f;a=a.trim();a=a.toLowerCase();a=a.slice(4,a.length-1);a=a.trim();d=a.split(",");if(3!==d.length)throw Error("Could not parse rgb() color string.");a=parseInt(d[0].trim(),10);b=parseInt(d[1].trim(),10);d=parseInt(d[2].trim(),10);f=new e;f.red=a;f.green=b;f.blue=d;return f}function k(e){e=e.trim();if(0===e.lastIndexOf("#",0)&&7===e.length)return a(e);if(0===e.lastIndexOf("rgba(",0))return b(e);if(0===e.lastIndexOf("rgb(",0))return f(e);throw Error("Invalid arguments.");
}var e;e=function c(a){var b;if(!(this instanceof c))return c.apply(new c,arguments);this.green=this.blue=this.red=255;this.alpha=1;if(1===arguments.length)return b=a.toString(),k(b);if(4===arguments.length){var h=arguments,f,m,r;b=Math.round(parseFloat(h[0]));f=Math.round(parseFloat(h[1]));m=Math.round(parseFloat(h[2]));r=parseFloat(h[3]);h=new e;h.red=b;h.green=f;h.blue=m;h.alpha=r;return h}if(3===arguments.length)return m=arguments,b=Math.round(parseFloat(m[0])),f=Math.round(parseFloat(m[1])),
h=Math.round(parseFloat(m[2])),m=new e,m.red=b,m.green=f,m.blue=h,m;if(0!==arguments.length)throw Error(arguments.length+" number of arguments not supported.");};e.parseHexColorString=a;e.parseColorString=k;e.parseRgbaColorString=b;e.parseRgbColorString=f;e.prototype.toString=function(){var a,b,f;a=Math.round(this.red);b=Math.round(this.green);f=Math.round(this.blue);return"rgba("+[a,b,f,this.alpha].join()+")"};e.prototype.clone=function(){var a=new e;a.red=this.red;a.green=this.green;a.blue=this.blue;
a.alpha=this.alpha;return a};return e}();dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.board=function(a,b){function f(b){n.isNullOrUndefined(b)||a.observer.publish("dotRollOver",b)}function k(b){n.isNullOrUndefined(b)||a.observer.publish("dotRollOut",b)}function e(){B||g(this.dot)}function g(b){a.observer.publish("dotClick",b)}function c(){var a=F,c=t(2.5*s.DOT_RADIUS);n.areSameDot(a,c)||(B||(!n.isNullOrUndefined(c)&&b.hasAnyOpenLines(c)?d("pointer"):d("")),F=c,B||(k(a),f(c)))}function d(b){a.stage.canvas.style.cursor=b}function l(){a.stage.update()}function h(c){var d,
f;c instanceof createjs.Shape?(d=c,c=d.dot,f=!0):(d=p(c),f=!1);c=b.isSelectedDot(c)?H:b.isHoveredDot(c)&&b.canConnectDots(c)?C:b.isHoveredDot(c)?I:J;c=new G(c);f?(d.fillColor=c,d.graphics.beginFill(c).inject(a.setDrawColors,d).drawCircle(0,0,s.DOT_RADIUS).endFill()):createjs.Tween.get(d.fillColor,{override:!0}).to(c,250);return d}function p(a){return E[a.y][a.x]}function m(c,d,f){var h,e=p(c.d1),g=p(c.d2),k=!1,m=a.scalePixel(1),l=null,s;h=x(c);n.isNullOrUndefined(h)?(h=new createjs.Shape,u(c,h),k=
!0):h.graphics.clear();h.graphics.setStrokeStyle(m).beginStroke(d).moveTo(e.x,e.y).lineTo(g.x,g.y);s=b.isQuickStarting;k&&(D.isHLine(c)?(h.scaleX=0.1,h.x=e.x-0.1*e.x,l={scaleX:1,x:0}):(h.scaleY=0.1,h.y=e.y-0.1*e.y,l={scaleY:1,y:0}),h.on("click",r),a.stage.addChild(h),createjs.Tween.get(h,{override:!0}).to(l,300).call(function(){var b;s||f||(b=new createjs.Shape,b.graphics.setStrokeStyle(a.scalePixel(1)).beginStroke(z).drawCircle(0,0,a.pixelSizes.DOT_RADIUS),b.x=g.x,b.y=g.y,b.scaleX=0,b.scaleY=0,a.stage.addChild(b),
createjs.Tween.get(b).to({scaleX:1.5,scaleY:1.5},150).to({scaleX:5,scaleY:5,alpha:0},1E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(b)}))}))}function r(b){b=a.stage.getObjectsUnderPoint(b.stageX,b.stageY).filter(function(a){return!n.isNullOrUndefined(a.dot)});0<b.length&&e.apply(b[0])}function v(c,d){var h,f,e,g;b.isQuickStarting||(f=p(c.lines[0].d1),g=p(c.lines[0].d2),h=f.x+(g.x-f.x)/2,f=p(c.lines[1].d1),g=p(c.lines[1].d2),f=f.y+(g.y-f.y)/2,e=new createjs.Text("+"+d,s.POINT_FONT_SIZE+
"px Helvetica",A.SCORE_TXT_COLOR),e.x=h,e.y=f,e.textAlign="center",e.textBaseline="middle",e.alpha=0,a.stage.addChild(e),createjs.Tween.get(e,{override:!1}).wait(550).to({alpha:1},0).to({alpha:0,y:a.height()+a.scalePixel(50)},3E3,createjs.Ease.sineOut).call(function(){a.stage.removeChild(e)}),createjs.Tween.get(e,{override:!1}).wait(550).to({scaleX:1.5,scaleY:1.5},200,createjs.Ease.elasticInOut))}function u(a,b){var c,d;c=w(a);d=c.store[c.y];n.isNullOrUndefined(d)&&(d={},c.store[c.y]=d);d[c.x]=b}
function x(a){var b;a=w(a);if(!a.store.hasOwnProperty(a.y))return null;b=a.store[a.y];return b.hasOwnProperty(a.x)?b[a.x]:null}function w(a){var b,c;n.line.isHLine(a)?(c=K,b=a.d1.y,a=Math.min(a.d1.x,a.d2.x)):(c=L,b=Math.min(a.d1.y,a.d2.y),a=a.d1.x);return{x:a,y:b,store:c}}function q(a,b){var c;c=Math.floor((a-s.DOT_MARGIN/2)/(2*s.DOT_RADIUS+s.DOT_MARGIN));return 0>c||c>=b?null:c}function t(c){var d,f,h,e;d=a.stage.mouseX;f=a.stage.mouseY;if(!a.stage.mouseInBounds)return null;h=q(d,b.getDotColCount());
if(null===h)return null;e=q(f,b.getDotRowCount());if(null===e)return null;h={x:h,y:e};e=p(h);var g=e.y;d=Math.pow(e.x-d,2)+Math.pow(g-f,2);c=Math.pow(c,2);d<=c||(h=null);return h}var n=dotBox.utility,D=dotBox.utility.line,A=dotBox.views.constants,G=dotBox.views.Color;if(n.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(n.isNullOrUndefined(b))throw Error("model is null or undefined.");var s=a.pixelSizes,J="#53d2f1",I="#89E0F5",H="#fc1f70",C="#E20355",z="white",E,K={},L={},
y,F=null,B=!1;(function(){var c,d,h;c={height:0,width:0};d=2*b.getDotColCount()*s.DOT_RADIUS;h=(b.getDotColCount()+1)*s.DOT_MARGIN;c.width=d+h;d=2*b.getDotRowCount()*s.DOT_RADIUS;h=(b.getDotRowCount()+1)*s.DOT_MARGIN;c.height=d+h;a.observer.publish("view.reserveCanvasSize",c)})();a.observer.subscribe("startGame",function(){var d,f,g,k=b.getDotRowCount(),m=b.getDotColCount(),p;d=new createjs.Shape;d.graphics.beginFill(A.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height());a.stage.addChild(d);E=[];
for(f=0;f<k;f++)for(d=0;d<m;d++)0===d&&(p=[],E.push(p)),g=new createjs.Shape,g.dot={x:d,y:f},h(g),g.x=d*(s.DOT_MARGIN+2*s.DOT_RADIUS)+(s.DOT_MARGIN+s.DOT_RADIUS),g.y=f*(s.DOT_MARGIN+2*s.DOT_RADIUS)+(s.DOT_MARGIN+s.DOT_RADIUS),g.on("click",e),p.push(g),a.stage.addChild(g);a.stage.update();a:{k=20;y&&(clearInterval(y),y=null);if(null===k)k=20;else if(0>=k)break a;y=setInterval(c,1E3/Math.min(50,k))}createjs.Ticker.addEventListener("tick",l);createjs.Ticker.setFPS(60)});a.observer.subscribe("view.dotRollOver",
function(a){a=h(a);createjs.Tween.get(a,{override:!0}).to({scaleX:2,scaleY:2},150)});a.observer.subscribe("view.dotRollOut",function(a){a=h(a);createjs.Tween.get(a,{override:!0}).to({scaleX:1,scaleY:1},150)});a.observer.subscribe("view.dotSelectionChanged",function(a,b){var c;null!==a&&h(a);null!==b&&h(b);a!==b&&(c=p(null!==b?b:a),createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150).call(function(){var a=t(s.DOT_RADIUS);n.isNullOrUndefined(a)&&d("")}))});a.observer.subscribe("view.lineConnected",
function(a,b){var c;h(a.d1);c=h(a.d2);createjs.Tween.get(c,{override:!0}).to({scaleX:1,scaleY:1},150);m(a,z,b)});a.observer.subscribe("view.boxesScored",function(b,c){var d;for(d=0;d<b.length;d++){var h=b[d],f=c,e=void 0,g=void 0,k=e=void 0,m=void 0,l=void 0,s=void 0,k=void 0,n=a.scalePixel(10),u=a.scalePixel(1),s=a.getPlayerColor(f),l=new G(s);l.alpha=0.33;l=l.toString();g=p(h.lines[0].d1);e=p(h.lines[1].d2);k=e.x-g.x;m=e.y-g.y;e=new createjs.Shape;e.graphics.setStrokeStyle(u).beginStroke(s).beginFill(l).drawRect(g.x,
g.y,k,m);k=(k+n)/k;e.scaleX=k;e.scaleY=k;e.x=-1*(g.x*k-g.x)-n/2;e.y=-1*(g.y*k-g.y)-n/2;e.upperLeft={x:g.x,y:g.y};e.alpha=0;e.on("click",r);a.stage.addChild(e);a.boxShapes[h.box]=e;createjs.Tween.get(e,{override:!0}).wait(350).to({alpha:1},0).to({x:0,y:0,scaleX:1,scaleY:1},350)}v(b[0],b.length)});a.observer.subscribe("startRemoteTurn",function(a){d("wait");B=!0});a.observer.subscribe("endRemoteTurn",function(a,b){var c=n.getRandom(700,1250),e=n.getRandom(170,750),h=n.getRandom(500,750),m=n.getRandom(Math.floor(75),
750);setTimeout(function(){f(b.d1);setTimeout(function(){g(b.d1);k(b.d1);setTimeout(function(){f(b.d2);setTimeout(function(){B=!1;d(null);g(b.d2);k(b.d2)},m)},h)},e)},c)});a.observer.subscribe("stopGame",function(){createjs.Ticker.removeEventListener("tick",l);y&&(clearInterval(y),y=null)});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.score=function(a,b){function f(b,e){var f=new createjs.Container,g,k=a.scalePixel(1),n=a.scalePixel(2),u=a.scalePixel(9),C=a.scalePixel(6),z=a.scalePixel(13);g=new createjs.Shape;g.graphics.setStrokeStyle(k).beginStroke(v).beginFill(r).drawRoundRect(0,0,t.SCORE_BOX_W,e,n);f.addChild(g);g=new createjs.Text("0",t.SCORE_FONT_SIZE+"px Helvetica",c.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=C+e/2;g.textAlign="center";g.textBaseline="middle";f.addChild(g);l.push(g);g=new createjs.Shape;g.graphics.setStrokeStyle(k).beginFill(x).beginStroke(w).arc(t.SCORE_BOX_W/
2,e+z,t.SCORE_BOX_W/4,Math.PI+0.25*Math.PI,1.75*Math.PI);g.alpha=0;h.push(g);f.addChild(g);k=g=new createjs.Shape;n=Math.round(0.3*e);C=a.scalePixel(2);z=a.scalePixel(2);k.fillColor=new d(q);k.strokeColor=new d(q);k.graphics.setStrokeStyle(C).beginStroke(q).beginFill(q).inject(a.setDrawColors,k).drawRoundRect(0,0,t.SCORE_BOX_W,n,z).endFill();f.addChild(g);p.push(g);g=new createjs.Text(b,t.P_NAME_FONT_SIZE+"px Helvetica",c.SCORE_TXT_COLOR);g.x=t.SCORE_BOX_W/2;g.y=u;g.textAlign="center";g.textBaseline=
"middle";m.push(g);f.addChild(g);return f}function k(a){var b,d,f,g,k;for(b=0;b<h.length;b++)d=h[b],b===a?(createjs.Tween.get(d,{override:!0}).to({alpha:1},250,createjs.Ease.sineIn),d=c.SCORE_TXT_COLOR):(createjs.Tween.get(d,{override:!0}).to({alpha:0},250,createjs.Ease.sineOut),d=u),k=p[b],f=e("fill",b,a),g=e("stroke",b,a),createjs.Tween.get(k.fillColor,{override:!0}).to(f,200),createjs.Tween.get(k.strokeColor,{override:!0}).to(g,200),m[b].color=d}function e(a,b,e){b===e?(b=0===b?new d(c.P1_COLOR):
new d(c.P2_COLOR),"fill"===a&&(b.alpha=0.33)):b=new d(q);return b}var g=dotBox.utility,c=dotBox.views.constants,d=dotBox.views.Color,l=[],h=[],p=[],m=[],r="#272822",v="#3b3d38",u="#a69b9d",x="#fc1f70",w="#E20355",q="#40403d",t=a.scaleAllPixelProps({SCORE_BOX_W:75,SCORE_FONT_SIZE:25,P_NAME_FONT_SIZE:10}),n=a.pixelSizes.SCORE_BOARD_HEIGHT;if(g.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(g.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.publish("view.reserveCanvasSize",
{height:n});a.observer.subscribe("startGame",function(){var c,d,e=a.scalePixel(10);d=a.scalePixel(5);var g=n-2*d;c=a.height()-n;d=c+d+1;l=[];h=[];p=[];m=[];var r,u=a.scalePixel(1),v=a.height(),q=a.width();r=new createjs.Shape;r.graphics.beginLinearGradientFill(["#5b5b5b","#545454"],[0,1],0,c,0,v).drawRect(0,c,q,v).endFill();r.graphics.setStrokeStyle(u).beginStroke("#323232").moveTo(0,c).lineTo(q,c).endStroke();r.graphics.setStrokeStyle(u).beginStroke("#7d7d7d").moveTo(0,c+u).lineTo(q,c+u).endStroke();
a.stage.addChild(r);c=f(b.gameConfig.playerNames[0],g);c.x=e;c.y=d;a.stage.addChild(c);c=f(b.gameConfig.playerNames[1],g);c.x=a.width()-e-t.SCORE_BOX_W;c.y=d;a.stage.addChild(c);k(b.getCurrentPlayer())});a.observer.subscribe("gameOver",function(a){k(a)});a.observer.subscribe("view.boxesScored",function(){var a,c;c=b.getCurrentScores();for(a=0;a<c.length;a++)l[a].text=c[a]});a.observer.subscribe("views.playerTurnChanged",function(){k(b.getCurrentPlayer())});return{}};dotBox=dotBox||{};dotBox.views=dotBox.views||{};
dotBox.views.gameOver=function(a,b){function f(b,e,f){var g,k,l,q,t,n=a.scalePixel(10),D=a.scalePixel(2),A;g=new createjs.Container;l=a.height()-p.SCORE_BOARD_HEIGHT;q=a.width();k=new createjs.Text(b,h+"px Helvetica",d.SCORE_TXT_COLOR);k.textAlign="center";k.textBaseline="middle";t=k.getBounds();b=t.height+2*n+2*D;n=t.width+2*n+2*D;t=new createjs.Shape;t.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,n,b);g.addChild(t);A=new c(e);A.alpha=0.2;t=new createjs.Shape;t.graphics.setStrokeStyle(D).beginStroke(e).beginFill(A.toString()).drawRect(0,
0,n,b);g.addChild(t);k.x=n/2;k.y=b/2;g.addChild(k);g.x=q/2;g.y=l/2;e=(q-n)/2;l=(l-b)/2;g.alpha=0;g.scaleX=0;g.scaleY=0;a.stage.addChild(g);createjs.Tween.get(g,{override:!0}).wait(f).to({alpha:1,scaleX:1,scaleY:1,x:e,y:l},1E3,createjs.Ease.quadIn).wait(2500).to({x:q+n/2},500,createjs.Ease.quadOut).call(function(){a.stage.removeChild(g)})}function k(b,d,e){var g,f,h=a.scalePixel(1);b=a.boxShapes[b];f=a.getPlayerColor(d);g=new c(f);g.alpha=0.33;g=g.toString();d=new createjs.Shape;d.graphics.setStrokeStyle(h).beginStroke(f).beginFill(g).drawRect(b.upperLeft.x,
b.upperLeft.y,e,e);d.upperLeft={x:b.upperLeft.x,y:b.upperLeft.y};return d}function e(c,d){var f,h,x,w,q,t,n;l||(f=b.getPlayerBoxes(c),0!==f.length&&(q=2*p.DOT_RADIUS+p.DOT_MARGIN,f=f[g.getRandom(0,f.length-1)],n=k(f,c,q),h=a.scalePixel(15),f=(q+h)/q,x=-1*(n.upperLeft.x*f-n.upperLeft.x)-h/2,h=-1*(n.upperLeft.y*f-n.upperLeft.y)-h/2,w=a.scalePixel(45),q=(q+w)/q,t=-1*(n.upperLeft.x*q-n.upperLeft.x)-w/2,w=-1*(n.upperLeft.y*q-n.upperLeft.y)-w/2,n.alpha=0,d.addChild(n),createjs.Tween.get(n,{override:!1}).wait(1E3).to({alpha:0.5},
0).to({alpha:1,scaleX:f,scaleY:f,x:x,y:h},500).to({alpha:0,scaleX:q,scaleY:q,x:t,y:w},1500,createjs.Ease.sineOut).call(function(){d.removeChild(n);e(c,d)})))}var g=dotBox.utility,c=dotBox.views.Color,d=dotBox.views.constants,l=!1,h=a.scalePixel(18),p=a.pixelSizes;if(g.isNullOrUndefined(a))throw Error("viewContext is null or undefined.");if(g.isNullOrUndefined(b))throw Error("model is null or undefined.");a.observer.subscribe("gameOver",function(c){var g,h,k,l;l=0===c?1:0;g=b.gameConfig.playerNames[c];
h=b.gameConfig.playerNames[l];k=a.getPlayerColor(c);l=a.getPlayerColor(l);var p,q;q=new createjs.Container;p=new createjs.Shape;p.graphics.beginFill(d.BOARD_BACK_COLOR).drawRect(0,0,a.width(),a.height()-a.scalePixel(65));p.alpha=0.15;q.addChild(p);a.stage.addChild(q);createjs.Tween.get(p,{override:!0}).to({alpha:0.5},600,createjs.Ease.sineIn);e(c,q);f("=) "+g+" wins!",k,30);f("='(  Sorry "+h,l,4030)});a.observer.subscribe("stopGame",function(){l=!0});return{}};dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.utility=dotBox.ai.utility||{};
(function(a){function b(a,b){return 3<=b.getLineStatesForBox(a).open.length}function f(a){var b=[],d,f;f=function(d){for(var f;f=d.next();)a.isLineConnected(f)||b.push(f)};d=e.hLineIterator(a.getDotCountLength(),a.getDotCountWidth());f(d);d=e.vLineIterator(a.getDotCountLength(),a.getDotCountWidth());f(d);return b}var k=dotBox.utility,e=dotBox.utility.iterators;a.findCloseableBoxes=function(a){var b=[],d,f=a.getBoxCount(),e;for(d=0;d<f;d++)a.isBoxScored(d)||(e=a.getLineStatesForBox(d),1===e.open.length&&
b.push({boxIndex:d,openLine:e.open[0]}));return b};a.boxHasThreeOrMoreOpen=b;a.getAllOpenLines=f;a.findNonThirdSideLines=function(a){var c,d,e,h,p=a.getDotCountLength(),m=a.getDotCountWidth(),r=[],v;d=f(a);v=function(c){return b(c,a)};for(c=0;c<d.length;c++)h=d[c],e=k.line.getBoxesFromLine(h,p,m),e.every(v)&&r.push(h);return r}})(dotBox.ai.utility);dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AiPlayer=function AiPlayer(b,f){if(!(this instanceof AiPlayer))return AiPlayer.apply(new AiPlayer,arguments);this.playerIndex=b;this.gameEngine=f};
dotBox.ai.AiPlayer.prototype=function(){var a=dotBox.utility;return{getRandomDot:function(){var b,f;b=a.getRandom(0,this.gameEngine.getDotCountLength()-1);f=a.getRandom(0,this.gameEngine.getDotCountWidth()-1);return{x:b,y:f}},getRandomOpenLine:function(){var b=null;if(this.gameEngine.isGameOver())return null;for(;null===b;)b=this.getRandomDot(),b=this.gameEngine.getOpenLinesForDot(b),null!==b&&0===b.length&&(b=null);return a.getRandomItem(b)},move:function(){return this.getRandomOpenLine()},makeMove:function(a){var f=
this;if(void 0===a)return this.move();setTimeout(function(){a(f.move())},10)}}}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.AvoidThirdSide=function(){var a=dotBox.utility,b=dotBox.ai.utility,f;f=function e(a,b){if(!(this instanceof e))return e.apply(new e,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(f,dotBox.ai.AiPlayer);f.prototype.move=function(){var e;e=b.findNonThirdSideLines(this.gameEngine);return 0<e.length?e=a.getRandomItem(e):f.uber.move.apply(this)};return f}();dotBox=dotBox||{};dotBox.ai=dotBox.ai||{};dotBox.ai.SingleBoxCloser=function(){var a=dotBox.utility,b;b=function k(a,b){if(!(this instanceof k))return k.apply(new k,arguments);this.playerIndex=a;this.gameEngine=b};a.inherit(b,dotBox.ai.AvoidThirdSide);b.prototype.move=function(){var k;k=dotBox.ai.utility.findCloseableBoxes(this.gameEngine);return 0<k.length?(k=a.getRandomItem(k),k.openLine):b.uber.move.apply(this)};return b}();dotBox=dotBox||{};
dotBox.controller=function(a,b){function f(f,l){var m,r,v,u;v=c.getCurrentPlayer();r={d1:f,d2:l};m=c.connectLine(r);u=0<m.boxesScored.length;d.selectedDot=null;d.hoveredDot=null;a.publish("view.lineConnected",r,u);m=m.boxesScored;var x;if(0<m.length){u=[];for(r=0;r<m.length;r++)x=m[r],u.push({box:x,lines:g.line.getLinesFromBox(x,c.getDotCountLength())});a.publish("view.boxesScored",u,v)}c.isGameOver()?a.publish("gameOver",k()):(m=c.getCurrentPlayer(),null!==m&&m!==v&&a.publish("views.playerTurnChanged"),!d.isQuickStarting&&
b.useAi&&1===m&&e(m))}function k(){var a,b=0,c=0,f;f=d.getCurrentScores();for(a=0;a<f.length;a++)f[a]>=c&&(c=f[a],b=a);return b}function e(b){a.publish("startRemoteTurn",b);l.makeMove(function(c){a.publish("endRemoteTurn",b,c)})}var g=dotBox.utility,c,d=null,l;c=dotBox.gameEngine({dotCountLength:b.dotColCount,dotCountWidth:b.dotRowCount});(function(){var a=[];g.isNullOrUndefined(b.playerNames)&&(b.playerNames=[]);1>b.playerNames.length||g.isNullOrUndefined(b.playerNames[0])||0===b.playerNames[0].length?
a.push("PLAYER 1"):a.push(b.playerNames[0]);2>b.playerNames.length||g.isNullOrUndefined(b.playerNames[1])||0===b.playerNames[1].length?b.useAi?a.push("HAL9000"):a.push("PLAYER 2"):a.push(b.playerNames[1]);b.playerNames=a})();b.useAi&&(l=new dotBox.ai.SingleBoxCloser(1,c));d=dotBox.model(c,b);a.subscribe("dotRollOver",function(b){c.hasAnyOpenLines(b)&&(d.hoveredDot=b,a.publish("view.dotRollOver",b))});a.subscribe("dotRollOut",function(b){d.hoveredDot=null;a.publish("view.dotRollOut",b)});a.subscribe("dotClick",
function(b){var e=d.selectedDot;if(!c.hasAnyOpenLines(b))return null;d.isSelectedDot(b)?(d.selectedDot=null,a.publish("view.dotSelectionChanged",e,null)):null!==d.selectedDot&&d.canConnectDots(b)?f(e,b):(d.selectedDot=b,a.publish("view.dotSelectionChanged",e,b))});return{startGame:function(){a.publish("startGame",d);if(!g.isNullOrUndefined(b.preMovePercent)){var h=b.preMovePercent,k,l;if(0>h||1<h)throw Error("percent must be between 0 and 1");if(0!==h){k=c.getTotalLineCount();k=Math.floor(k*h);0<
k&&(d.isQuickStarting=!0);for(var r=new dotBox.ai.AvoidThirdSide(-1,c),h=0;h<k;h++)l=r.move(),f(l.d1,l.d2);d.isQuickStarting=!1;h=c.getCurrentPlayer();b.useAi&&1===h&&e(c.getCurrentPlayer())}}},model:d}};dotBox=dotBox||{};
dotBox.game=function(a,b){var f,k,e=[],g,c;f=new Observer;k=window.devicePixelRatio||Math.round(window.screen.availWidth/document.documentElement.clientWidth);k=dotBox.views.viewContext(f,k,b.uiScale);g=dotBox.controller(f,b);c=g.model;e.push(dotBox.views.board(k,c));e.push(dotBox.views.score(k,c));e.push(dotBox.views.gameOver(k,c));k.initCanvasStage(function(a){if(a instanceof jQuery)return $(a[0]);"string"===typeof a&&0!==a.lastIndexOf("#",0)&&(a="#"+a);return $(a)}(a));g.startGame();return{stopGame:function(){f.publish("stopGame")}}};
(function(a){a.fn.dotBox=function(a){return dotBox.game(this,a)}})(jQuery);dotBox=dotBox||{};
dotBox.viewModel=function(){function a(a){return void 0===a||null===a||0===a.length||10<a.length?!1:!0}var b={playerMode:ko.observable("pvc"),playerName1:ko.observable("PLAYER 1"),playerName2Custom:ko.observable("PLAYER 2"),dotCols:ko.observable(10),dotRows:ko.observable(6),quickGame:ko.observable(!0),fillPercentCustom:ko.observable(30),uiScale:ko.observable(1.25),game:null};b.useAi=ko.computed(function(){return"pvc"===b.playerMode()});b.playerName2=ko.computed({read:function(){return b.useAi()?"HAL9000":
b.playerName2Custom()},write:function(a){b.useAi()||b.playerName2Custom(a)}});b.fillPercent=ko.computed({read:function(){return b.quickGame()?b.fillPercentCustom():0},write:function(a){b.quickGame()&&b.fillPercentCustom(a)}});b.toGameConfig=function(){return{dotColCount:b.dotCols(),dotRowCount:b.dotRows(),useAi:b.useAi(),preMovePercent:b.fillPercent()/100,playerNames:[b.playerName1(),b.playerName2()],uiScale:b.uiScale()}};b.newGame=function(){if(b.isValid()){$("#globalError").addClass("hidden");var a=
$("#canvasContainer"),k=b.toGameConfig();null!==b.game&&b.game.stopGame();a.empty();b.game=a.dotBox(k)}else $("#globalError").removeClass("hidden")};b.isP1NameValid=ko.computed(function(){return a(b.playerName1())});b.isP2NameValid=ko.computed(function(){return a(b.playerName2())});b.isDotColsValid=ko.computed(function(){return 6>b.dotCols()||20<b.dotCols()?!1:!0});b.isDotRowsValid=ko.computed(function(){return 3>b.dotRows()||20<b.dotRows()?!1:!0});b.isFillPercentValid=ko.computed(function(){return 1>
b.fillPercentCustom()||100<b.fillPercentCustom()?!1:!0});b.isValid=ko.computed(function(){return b.isP1NameValid()&&b.isP2NameValid()&&b.isDotColsValid()&&b.isDotRowsValid()&&b.isFillPercentValid()?!0:!1});return b}();dotBox=dotBox||{};dotBox.ko=dotBox.ko||{};dotBox.ko.addCustomBindings=function(){ko.bindingHandlers.slider={init:function(a,b,f){f=f().sliderOptions||{};$(a).slider(f);ko.utils.registerEventHandler(a,"slidechange",function(a,e){b()(e.value)});ko.utils.domNodeDisposal.addDisposeCallback(a,function(){$(a).slider("destroy")});ko.utils.registerEventHandler(a,"slide",function(a,e){b()(e.value)})},update:function(a,b){var f=ko.utils.unwrapObservable(b());isNaN(f)&&(f=0);$(a).slider("value",f)}}};$(document).ready(function(){$(".alert .close").on("click",function(){$(this).parent().addClass("hidden")});dotBox.utility.isCanvasSupported()?($("#newGameBtn").on("click",function(){dotBox.viewModel.newGame();$("html, body").animate({scrollTop:$("#canvasContainer").offset().top-50},300)}),dotBox.ko.addCustomBindings(),ko.applyBindings(dotBox.viewModel),dotBox.viewModel.newGame()):($("#mainContainer").addClass("hidden"),$("#failContainer").removeClass("hidden"))}); //@ sourceMappingURL=./dotBox-min.js.map
